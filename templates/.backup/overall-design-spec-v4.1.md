**XXX版本总体设计说明书**

(内部文档,不得复制)

![](media/image2.png){width="2.575in" height="0.9416666666666667in"}

深信服科技有限公司

+------+------------------+------+----------+
| 拟制 | zbc\@sangfor.com | 日期 | 20100505 |
|      |                  |      |          |
|      | yjz\@sangfor.com |      |          |
+------+------------------+------+----------+
| 审核 | gdz\@sangfor.com | 日期 | 20100505 |
+------+------------------+------+----------+
| 批准 | yjz\@sangfor.com | 日期 | 20100507 |
+------+------------------+------+----------+

**修订记录**

+-----------------+-----------------+-----------------+-----------------+
| 修订版本号      | 作者            | 日期            | 简要说明        |
+-----------------+-----------------+-----------------+-----------------+
| *V1.6*          | *Chenbo*        | *20190612*      | *增加SDL安全、API接口规 |
|                 |                 |                 | 范、方案选型打分表* |
+-----------------+-----------------+-----------------+-----------------+
| *V1.7*          | *Yangjianhui*   | *20200610*      | *总设任务书章节增加**中台项 |
|                 |                 |                 | 目额外要求**，使模板适用于中 |
|                 |                 |                 | 台项目*         |
+-----------------+-----------------+-----------------+-----------------+
| *V1.8*          | *Liyaosheng*    | *20200714*      | 1.  *引入黑鸭扫描器，替代 |
|                 |                 |                 | SCA，进行预使用组件的漏洞扫 |
|                 |                 |                 | 描以及合规性检测* |
|                 |                 |                 |                 |
|                 |                 |                 |                 |
|                 |                 |                 | 2.  *新增威胁建模与安全设 |
|                 |                 |                 | 计文档，设计需要对模块开展威胁 |
|                 |                 |                 | 建模与安全设计* |
+-----------------+-----------------+-----------------+-----------------+
| *V1.9*          | *Liyaosheng*    | *20200805*      | *1、新增系统可靠性、韧性、隐 |
|                 |                 |                 | 私设计的定义及目标* |
+-----------------+-----------------+-----------------+-----------------+
| *V2.0*          | *Zbc*           | *20201015*      | *增加技术规范计划定义章节，定 |
|                 |                 |                 | 义本版本需要在技术规范方面执行 |
|                 |                 |                 | 的工作内容*     |
+-----------------+-----------------+-----------------+-----------------+
| *V2.1*          | *Zbc*           | *20210329*      | *增加依赖环境解耦设计，以及可 |
|                 |                 |                 | 调试、可测试设计* |
+-----------------+-----------------+-----------------+-----------------+
| *V2.2*          | *Lyl*           | *20210531*      | *1、替换威胁建模旧文档，添加 |
|                 |                 |                 | 威胁建模模板链接；* |
|                 |                 |                 |                 |
|                 |                 |                 |                 |
|                 |                 |                 | *2、工具接口人更新（雷琼更新 |
|                 |                 |                 | 为张笑尘）*     |
|                 |                 |                 |                 |
|                 |                 |                 | *3、《版本总体设计说明书》改 |
|                 |                 |                 | 为《版本设计策略说明书》* |
+-----------------+-----------------+-----------------+-----------------+
| *V2.3*          | *Zbc、cj*       | *20210625*      | *根据可信入围结果对可靠/可用 |
|                 |                 |                 | 、安全、隐私、韧性等相关的要求 |
|                 |                 |                 | 给出分析指导并明确分析要求，完 |
|                 |                 |                 | 善了 原5.7 （现5.4）  |
|                 |                 |                 |  删除了原5.2-5.4  删 |
|                 |                 |                 | 除的内容并入到了现5.4。另细 |
|                 |                 |                 | 化了韧性设计章节，增加了"软件 |
|                 |                 |                 | 质量及效能改进设计"章节。* |
+-----------------+-----------------+-----------------+-----------------+
| *V2.4*          | *Longhao*       | *20220920*      | *增加章节1.2，1.6* |
|                 |                 |                 |                 |
|                 |                 |                 |                 |
|                 |                 |                 | *删除章节       |
|                 |                 |                 | 2.2版本规划，2.4性能性能 |
|                 |                 |                 | 指标（相关内容移动到1.5总设 |
|                 |                 |                 | 任务书内：性能要求，资源开销要 |
|                 |                 |                 | 求）*           |
|                 |                 |                 |                 |
|                 |                 |                 | *4.2软件总体架构调整，增加 |
|                 |                 |                 | 4+1视图要求，增加模块设计策 |
|                 |                 |                 | 略要求*         |
|                 |                 |                 |                 |
|                 |                 |                 | *4.5模块设计章节调整，增加 |
|                 |                 |                 | 模块职责及边界描述以及模块风险 |
|                 |                 |                 | 识别及对策小节，去掉接口设计章 |
|                 |                 |                 | 节（放到概要设计阶段来做）* |
|                 |                 |                 |                 |
|                 |                 |                 |                 |
|                 |                 |                 | *增加5.7可见性设计章节* |
+-----------------+-----------------+-----------------+-----------------+
| *V2.5*          | *Xuying*        | *20221206*      | *增加是否使用中台的章节* |
+-----------------+-----------------+-----------------+-----------------+
| *V2.6*          | *Xuying*        | *20230922*      | *增加可服务性设计相关内容* |
+-----------------+-----------------+-----------------+-----------------+
| *V2.7*          | *Tanyongjie&xuy | *20231103*      | *增加专利的要求的相关章节* |
|                 | ing*            |                 |                 |
+-----------------+-----------------+-----------------+-----------------+
| *V3.2*          | *Xuying&huangzh | *20231204*      | *修改总设上TMG评审条件* |
|                 | eng*            |                 |                 |
+-----------------+-----------------+-----------------+-----------------+
| *V2.9*          | *Tanyongjie*    | *20240311*      | *模板线上化*    |
+-----------------+-----------------+-----------------+-----------------+
| *V3.2*          | *陈杰79521*     | *20240808*      | *1）1.5节中的稳定性修改为 |
|                 |                 |                 | 可靠性，可维护性修改为可服务性 |
|                 | *谭永杰81778*   |                 | ，相关的要求描述也随之修改* |
|                 |                 |                 |                 |
|                 |                 |                 |                 |
|                 |                 |                 | *2）5.1的业务出错处理是没 |
|                 |                 |                 | 有必要的，和5.4的可靠性重复 |
|                 |                 |                 | ，而且目前也缺少可测试性章节， |
|                 |                 |                 | 为了减少结构上的变化，此处修改 |
|                 |                 |                 | 为可测试性设计* |
|                 |                 |                 |                 |
|                 |                 |                 | *3）5.2的可服务性设计中的 |
|                 |                 |                 | 指导做了刷新，新增了三级目录* |
|                 |                 |                 |                 |
|                 |                 |                 |                 |
|                 |                 |                 | *4）5.4         |
|                 |                 |                 | 整体优化结构以及对应的描述* |
|                 |                 |                 |                 |
|                 |                 |                 |                 |
|                 |                 |                 | *5）5.5增加了一个特别说明 |
|                 |                 |                 | *               |
|                 |                 |                 |                 |
|                 |                 |                 | *6）删除专利相关章节* |
+-----------------+-----------------+-----------------+-----------------+
| *V3.2*          | *谭永杰81778*   | *20250522*      | 1.  *优化DFX特性设计章 |
|                 |                 |                 | 节，和概要设计的DFX维度保持 |
|                 | *吴义和11582*   |                 | 一致，使总体设计考虑的DFX特 |
|                 |                 |                 | 性设计能有相应的模块概要设计进 |
|                 |                 |                 | 行承接。*       |
|                 |                 |                 |                 |
|                 |                 |                 | <!-- -->        |
|                 |                 |                 |                 |
|                 |                 |                 | a.  *可服务性改为可运维性 |
|                 |                 |                 | ，并修改相应描述；* |
|                 |                 |                 |                 |
|                 |                 |                 |                 |
|                 |                 |                 | b.  *可见性调整为可调试性 |
|                 |                 |                 | ，并修改相应描述；* |
|                 |                 |                 |                 |
|                 |                 |                 |                 |
|                 |                 |                 | c.  *可重用性改为可复用性 |
|                 |                 |                 | ；*             |
|                 |                 |                 |                 |
|                 |                 |                 | d.  *韧性合入可靠性章节。 |
|                 |                 |                 | *               |
|                 |                 |                 |                 |
|                 |                 |                 | *2）更新安全性内容。* |
|                 |                 |                 |                 |
|                 |                 |                 |                 |
|                 |                 |                 | *a.             |
|                 |                 |                 | 新增安全兜底机制合入要求，最佳 |
|                 |                 |                 | 实践等；\       |
|                 |                 |                 | b.              |
|                 |                 |                 | 明确了不满足时，处置要求和方法 |
|                 |                 |                 | ；*             |
|                 |                 |                 |                 |
|                 |                 |                 | *c.             |
|                 |                 |                 | 刷新了第三方开源组件的工具替换 |
|                 |                 |                 | ，由黑鸭替换为Mend。* |
+-----------------+-----------------+-----------------+-----------------+
| *V3.2*          | *谭永杰81778*   | *20250630*      | *1）中台复用需求增加中台确认 |
|                 |                 |                 | 人约束*         |
+-----------------+-----------------+-----------------+-----------------+
| *V4.0*          | *陈楚明24308*   | *20250830*      | 1.  *"产品介绍"更改为" |
|                 |                 |                 | 技术需求设计"；* |
|                 |                 |                 |                 |
|                 |                 |                 |                 |
|                 |                 |                 | 2.  *增加"设计目标"章节 |
|                 |                 |                 | ；*             |
|                 |                 |                 |                 |
|                 |                 |                 | 3.  *"引言"章节部分内容 |
|                 |                 |                 | 调整至"技术需求设计"和"设计 |
|                 |                 |                 | 目标"章节；*    |
|                 |                 |                 |                 |
|                 |                 |                 | 4.  *"托管云"章节内容云 |
|                 |                 |                 | 掉，合入"1.1.1.2解决方 |
|                 |                 |                 | 案长期演进架构需求分析"；* |
|                 |                 |                 |                 |
|                 |                 |                 |                 |
|                 |                 |                 | 5.  *"方案选型"章节调整 |
|                 |                 |                 | 到"技术需求设计"章节中。* |
+-----------------+-----------------+-----------------+-----------------+
| *V4.1*          | *陈楚明24308*   | *20250912*      | 1.  *增加1.1.1.1业 |
|                 |                 |                 | 务场景需求分析章节* |
|                 |                 |                 |                 |
|                 |                 |                 |                 |
|                 |                 |                 | 2.  *更新文档所有链接，由 |
|                 |                 |                 | docs切换到wiki* |
+-----------------+-----------------+-----------------+-----------------+

目录

0\. 引言 9

[0.1. 目的 9](\l)

[0.2. 适用范围和评审要求 10](\l)

[0.2.1. 适用范围 10](\l)

[0.2.2. 评审要求 11](\l)

[0.3. 定义和缩写 11](\l)

[0.4. 参考和引用 11](\l)

[0.5. 产品名称、型号、代号 11](\l)

[*1.* 技术需求设计 11](\l)

[1.1. 架构技术需求设计 12](\l)

[1.1.1. 架构需求分析 12](\l)

[1.1.2. 架构领先性需求分析 14](\l)

[1.1.3. 架构预期目标 15](\l)

[1.1.4. 架构方案设计 17](\l)

[1.1.5. 预研及中台复用结论 17](\l)

[1.1.6. 架构方案选型 18](\l)

[1.2. 特性技术需求设计 21](\l)

[1.2.1. 特性需求分析 21](\l)

[1.2.2. 特性预期目标 21](\l)

[1.2.3. 特性方案设计 22](\l)

[1.2.4. 预研及中台复用结论 23](\l)

[1.2.5. 特性技术方案选型 23](\l)

[2. 设计目标 26](\l)

[2.1. 设计目标细化 26](\l)

[*2.1.1.* 目标细化分析 26](\l)

[*2.1.2.* 目标细化结论 26](\l)

[2.2. 中台技术要求 28](\l)

[3. 硬件方案 29](\l)

[3.1. 基本硬件构成 29](\l)

[3.2. 专用芯片说明 29](\l)

[4. 软件方案 29](\l)

[4.1. 软件总体架构 29](\l)

[4.2. 系统主流程 31](\l)

[4.2.1. 系统流程1 31](\l)

[4.2.2. 系统流程2... 32](\l)

[4.2.3. 系统初始化流程 32](\l)

[4.2.4. 系统退出流程 32](\l)

[4.3. 系统其它流程 32](\l)

[4.3.1. 系统流程1 33](\l)

[4.3.2. 系统流程2... 33](\l)

[4.4. 数据结构 34](\l)

[4.5. 模块设计 34](\l)

[4.5.1. 模块名１ 34](\l)

[4.5.2. 模块名２ 34](\l)

[5. 关键特性设计 34](\l)

[5.1. 安全性设计 35](\l)

[5.1.1. 安全兜底机制合入 35](\l)

[5.1.2. 威胁建模分析 35](\l)

[5.1.3. 安全设计 36](\l)

[5.1.4. 预使用组件版本安全情况 36](\l)

[5.2. 可靠性设计 37](\l)

[5.2.1. 能力目标定义 37](\l)

[5.2.2. 故障场景分析 39](\l)

[5.2.3. 业界竞争分析 39](\l)

[5.2.4. 实现方案设计 39](\l)

[5.2.5. 韧性设计 40](\l)

[5.3. 可测试性设计 41](\l)

[5.4. 可调试性设计 42](\l)

[5.5. 可运维性设计 42](\l)

[5.5.1. 可运维性目标定义 42](\l)

[5.5.2. 可运维性设计方案 42](\l)

[5.6. 可扩展性设计 42](\l)

[5.7. 可复用性设计 43](\l)

[5.7.1. 技术规范落地计划 43](\l)

[5.7.2. 本版本可采用的公用代码 43](\l)

[5.7.3. 本版本可产出的公用代码 43](\l)

[5.7.4. 设计文档更新约定 43](\l)

[5.8. 系统隐私设计 44](\l)

[5.9. 软件质量及效能改进设计 44](\l)

[6. 总结 44](\l)

[6.1. 与上一个版本的设计变化 44](\l)

[6.1.1. 设计变化项1 44](\l)

[6.1.2. 设计变化项2... 45](\l)

[6.2. 风险问题保证 45](\l)

[6.3. 尚未解决的问题 45](\l)

[7. 变更控制 45](\l)

[7.1. 变更列表 46](\l)

**此文档中所有章节不得为空，如不涉及需写明不涉及&原因。**

0.  引言
    ====

    1.  目的
        ----

*简要介绍该说明书的目的，和使用该规格书的对象(如项目技术经理等)。模板每一章节都要有对应设计，如有不涉及也要写清楚原因*

**DCP2项目立项阶段（下图"阶段一"标识）：**

**总设输入：**用户需求设计；技术规划，DFX基线和版本DFX需求，安全需求，质量问题需求；其它需求输入。

**总设输出：**部分设计，主要包含技术需求设计、设计目标章节内容。

**DCP3项目计划阶段（下图"阶段二"标识）：**

**总设的输入**：系统需求文档；在文档编写之前，画出一个设计的大体思路，经专家评定后，再动手写，也是一个输入。

**总设的输出**：完整设计，包含所有章节内容。

需求文档里面有的需求，都要在总体设计里面有体现。回溯责任时，如果需求文档里面有，总体设计没体现，则是总体设计人员的责任。

![](media/image3.png){width="6.2652777777777775in"
height="4.0881944444444445in"}

2.  适用范围和评审要求
    ------------------

    1.  ### 适用范围

在每个迭代的需求基线后，产品线架构师根据需求的复杂度，对架构的影响程度，进行决策：1
做一份全新的总体设计；2 在上个迭代的总体设计上进行调整；3
不做总体设计。决策依据可以参考下表：

+-----------------------------------+-----------------------------------+
| 场景                              | 建议                              |
+-----------------------------------+-----------------------------------+
| 本次迭代需求开发将对产品架构进行大面积调整 | 做一份全新的总体设计（无论之前迭代是否有做过总体设计） |
+-----------------------------------+-----------------------------------+
| 1                                 | 如果前置迭代已经做了总体设计，在次基础上刷新总设即可；如果没做，需 |
| 本次迭代需求开发未对原有产品架构大幅改动，而是增加多个模块或者小幅 | 要全新做一份 |
| 度调整原有模块功能（大于两个模块） |                                  |
|                                   |                                   |
|                                   |                                   |
| 2 涉及跨部门配合的多模块协同开发  |                                   |
+-----------------------------------+-----------------------------------+
| 本次迭代需求开发对少量模块有架构上调整，或者是新增了少数几个模块（ | 如果前置迭代已经做了总体设计，在次基础上刷新总设即可；如果没做，直 |
| 不超过两个）                      | 接做概要设计，不做总设            |
+-----------------------------------+-----------------------------------+
| 本次迭代需求开发仅在原有模块上进行了一些零散的改动，不涉及架构层面 | 不做总设 |
| 的变动                            |                                   |
+-----------------------------------+-----------------------------------+

###  评审要求

总体设计评审统一提交电子流，由TMO组织进行TMG评审。（默认TMO-DFX专家参加所有总设评审）

定义和缩写
----------

*定义或解释本文档中使用的所有专用名词和缩略语。*

  -------------- ------------ ------------
  ***缩写名***   ***描述***   ***备注***
                              
                              
                              
                              
                              
  -------------- ------------ ------------

参考和引用
----------

*列出本文档编写过程中参考的其它文档或资料*

产品名称、型号、代号
--------------------

技术需求设计
============

*DCP2项目立项阶段：*

*输入来源：用户需求设计；技术规划，DFX基线和版本DFX需求，安全需求，质量问题需求；其它需求输入。*

*DCP3项目计划阶段：*

*输入来源：系统需求文档；*

1.  架构技术需求设计
    ----------------

    1.  ### 架构需求分析

*涉及架构变动的，需要填此章节内容，包含不限于以下类型项目：*

*(1)新产品、新架构、重大重构版本*

*(2)涉及跨产线的架构融合项目*

#### **业务场景需求分析**

*基于场景分析-\>问题识别-\>技术思路-\>方案选型的分析设计思路，编写下面附件文件内容。*

#### **产品长期演进架构需求分析**

*不仅考虑当前版本需求，还需考虑产品长期演进的潜在需求，分析出架构上的技术要求、约束和方案思路。*

*比如充分考虑过以下方向的演进变化：*

(1) *硬件兼容*

(2) *部署形态，单体、级联、集群、线上线下*

(3) *性能要求，并发、资源消耗、终端接入量*

(4) *可靠性，容灾要求，双机备份、异地备份等*

(5) *......（持续补充）*

  -------- ----------------------- ---------------- ----------------------------------------------------------------------- ----------------------
  *序号*   *当前版本需求*          *长期潜在需求*   *潜在需求的用户场景来源和重要性、优秀级判断*                            *当前需考虑技术问题*
  *1*      *终端管理规模支持5万*   *支持百万*       *三年内要支持的KA客户中，存在终端数量是几十万级别的场景，比如 招行。*   *整体的弹性可扩展*
  *2*                                                                                                                       
  *3*                                                                                                                       
  -------- ----------------------- ---------------- ----------------------------------------------------------------------- ----------------------

#### **解决方案长期演进架构需求分析**

*不仅考虑本产品的单一需求，还需要考虑集成解决方案的潜在需求，分析出架构上的技术要求、约束和方案思路：*

(1) *与XDR的集成解决方案*

(2) *与SASE的集成解决方案*

(3) *与其它安全产品的集成解决方案*

(4) *解决方案级的规范化、标准化，如：API规范、数据格式规范*

(5) *上托管云解决方案*

(6) *......（持续补充）*

  -------- --------------------------------- ----------------------- ------------------------------------------------------------------------- ----------------------------------
  *序号*   *当前版本需求*                    *长期潜在需求*          *潜在需求的用户场景来源和重要性、优秀级判断*                              *当前需考虑技术问题*
  *1*      *aES支持通过SASE对终端进行管控*   *aES支持第三方的联动*   *调研过X行业有X个客户，提过与XXX第三方联动需求，或与客户的SIEM平台联动*   *认证和联动协议考虑业内的通用性*
  *2*                                                                                                                                          
  *3*                                                                                                                                          
  -------- --------------------------------- ----------------------- ------------------------------------------------------------------------- ----------------------------------

#### **中台需求分析**

*不仅考虑当前版本需求，还需考虑长期演进需求，从单一产品和集成解决方案场景出发，评估是否存在中台需求，包含不限于以下中台：*

(1) *PlantOS*

(2) *SangforOS*

(3) *APEX*

    *(4)数据湖*

    *(5) ......（持续补充）*

  -------- ---------------- ------------------ ------------------------------------------------------------------------- --------------------------
  *序号*   *当前版本需求*   *长期潜在需求*     *潜在需求的用户场景来源和重要性、优秀级判断*                              *当前需考虑技术问题*
  *1*      *虚拟机部署*     *支持裸金属部署*   *调研过X行业有X个客户，提过与XXX第三方联动需求，或与客户的SIEM平台联动*   *复用中台能力，降低成本*
  *2*                                                                                                                    
  *3*                                                                                                                    
  -------- ---------------- ------------------ ------------------------------------------------------------------------- --------------------------

### 架构领先性需求分析 

*此章节是否编写要遵循以下策略：*

1.  *涉及构建产品竞争优势，则需要完整按模板要求编写相关内容；*

2.  *仅满足部分主流场景的要求，则可挑重点编写相关内容；*

3.  *只是要求业务功能稳定可用，则不要求填写此章节内容。*

*若不编写，需要写清楚理由，并且与规划和架构师对齐。*

#### **架构现状分析**

*分析当前产品的架构现状，哪些做得好，哪些存在不足或问题。*

#### **全球架构领先性分析**

*各关键技术维度分析全球架构领先性，并与当前产品架构做横向对比。*

##### xxx产品架构分析1

*1、终端轻量化：*

*核心功能驱动化，减少进程数量，减少用户态内核态的切换成本；资源占用用户无感知。*

##### xxx产品架构分析2

*1、终端轻量化：*

*轻量化检测引擎、轻端重云的检测架构*

#### **架构领先性对比分析**

*架构领先带来的业务价值或竞争力的横向对比*

  -------------- ----------------- ----------------- -----------------
  *维度*         *xxx产品1*        *xxx产品2*        *sangfor*
  *终端轻量化*   *性能数据：XXX*   *性能数据：XXX*   *性能数据：XXX*
                                                     
                                                     
  -------------- ----------------- ----------------- -----------------

#### **架构领先性需求分析**

  -------- --------------------------------- ---------------------------------------------------------------------------------------------------------- ----------------------------------------------------
  *序号*   *当前版本架构领先性需求*          *业务场景价值和重要性、优先级判断*                                                                         *当前需考虑技术问题*
  *1*      *通过架构优化，降低20%内存占用*   *提高产品的性价比，当前略输于友商，达成目标后，将在在XXX销售场景取得明显的竞争优势，期望X年内达成目标。*   *在保证检出效果不变的同时，如何减少引擎的内存消耗*
  *2*                                                                                                                                                   
  *3*                                                                                                                                                   
  -------- --------------------------------- ---------------------------------------------------------------------------------------------------------- ----------------------------------------------------

### 架构预期目标

*用户视角、用户可感知的产品预期目标，需要考虑当前版本以及未来演进的目标，起到牵引作用。第二章节，是基于此处目标的进一步细节和补充。*

*用户类型有：*

*（1）价值用户：技术决策者（如IT 架构师 /
安全负责人）、采购决策者（如CIO / 数字化总监）、技术使用者（如平台管理员
/ 审计专员）。*

*（2）效果用户：如终端使用用户（终端类产品）、终端泄密者（DLP类防泄漏产品相关）、攻击者/渗透测试者（如EDR/XDR/AF等防入侵类产品相关）。*

*（3）内部用户：交付实施工程师（关注可运维性、可排障性等）、产品规划团队（关注架构生产力、性能、价值兑现程度）、研发技术支持（关注可排障性等）、测试团队（关注可测试性）、架构师团队（关注可扩展性、先进性等）、XAAS-SRE（关注可靠性、可观测性、可运维性等）等*

+-----------------+-----------------+-----------------+-----------------+
| ***编号***      | ***干系人***    | ***目标项概述*** | ***用户预期解决的关键问题或 |
|                 |                 |                 | 指标***         |
|                 |                 |                 |                 |
|                 |                 |                 | ***（填写后请把对应项字体改 |
|                 |                 |                 | 成黑色和正体）*** |
+-----------------+-----------------+-----------------+-----------------+
| 1               | 价值用户        | 性能参数要求    | 如AF支持100G流量； |
|                 |                 |                 |                 |
|                 |                 |                 |                 |
|                 |                 |                 | aES支持10万终端接入。 |
+-----------------+-----------------+-----------------+-----------------+
| 2               | 价值用户        | 资源开销要求    | 如AF支持100G，16核32 |
|                 |                 |                 | G内存；         |
|                 |                 |                 |                 |
|                 |                 |                 | 如aES终端资源占用要求，不影 |
|                 |                 |                 | 响终端用户的体验性，不导致系统 |
|                 |                 |                 | 卡慢。          |
+-----------------+-----------------+-----------------+-----------------+
| 3               | 价值用户        | 可靠性          | SLA要求4个9（每年最多只有 |
|                 |                 |                 | 约52分钟的停机时间） |
+-----------------+-----------------+-----------------+-----------------+
|                 | 内部用户（SRE） |                 | 如需要有容灾方案，数据0丢失 |
|                 |                 |                 |                 |
|                 |                 |                 |                 |
|                 |                 |                 | 如硬件故障数据重建时间每TB少 |
|                 |                 |                 | 于X分钟         |
|                 |                 |                 |                 |
|                 |                 |                 | 如集群服务故障切换时间少于X秒 |
+-----------------+-----------------+-----------------+-----------------+
| 4               | 效果用户        | 兼容性          | 如老版本要能够升级； |
|                 |                 |                 |                 |
|                 |                 |                 |                 |
|                 |                 |                 | 如兼容所有终端环境，包括操作系 |
|                 |                 |                 | 统和杀软。      |
+-----------------+-----------------+-----------------+-----------------+
| 5               | 内部用户（开发人员） | 架构要求   | 如产品要支持适配各硬件平台、适 |
|                 |                 |                 | 配各系统平台、适配海外等场景， |
|                 |                 |                 | 期望代码改动最小化，甚至无需修 |
|                 |                 |                 | 改；            |
|                 |                 |                 |                 |
|                 |                 |                 | 如要求与XDR/APEX可集成 |
|                 |                 |                 | 部署，资源可复用，最大化降低部 |
|                 |                 |                 | 署成本。        |
+-----------------+-----------------+-----------------+-----------------+
| 6               |                 | 可扩展性        | 如性能可横向扩展，无须改动代码 |
|                 |                 |                 | ；              |
|                 |                 |                 |                 |
|                 |                 |                 | 如功能可扩展，通过插件的方式， |
|                 |                 |                 | 老代码无须改动； |
+-----------------+-----------------+-----------------+-----------------+
| 7               |                 | 可调试性        | 如90%的问题都可以通过日志定 |
|                 |                 |                 | 位；            |
|                 |                 |                 |                 |
|                 |                 |                 | 如终端问题可通过平台进行远程排 |
|                 |                 |                 | 障，不影响终端用户的正常使用体 |
|                 |                 |                 | 验；            |
+-----------------+-----------------+-----------------+-----------------+
| 8               | 内部用户（测试人员） | 可测试性   | 如支持mock、分层测试、模块 |
|                 |                 |                 | 独立测试等；    |
|                 |                 |                 |                 |
|                 |                 |                 | 如要有批量测试模拟； |
+-----------------+-----------------+-----------------+-----------------+
| 9               | 内部用户户（用服人员） | 可运维性 | 如4小时完成部署、1小时内完成 |
|                 |                 |                 | 升级；          |
|                 |                 |                 |                 |
|                 |                 |                 | 如控制台配置策略成功后，要知道 |
|                 |                 |                 | 是否生效；      |
|                 |                 |                 |                 |
|                 |                 |                 | 如终端排障时不影响终端用户正常 |
|                 |                 |                 | 使用。          |
+-----------------+-----------------+-----------------+-----------------+

### 架构方案设计

*根据1.1的架构需求分析，汇总给出技术思路。*

+-------------+-------------+-------------+-------------+-------------+
| 序号        | 架构需求    | 方案思路概述 | 是否已预研 | 是否详细方案选型 |
+-------------+-------------+-------------+-------------+-------------+
| 1           | 终端规模可弹性支持百万 | 数据库方案： | 是 | 是       |
|             |             |             |             |             |
|             |             |             |             |             |
|             |             | 方案1：*数据库短期使 |    |             |
|             |             | 用mongo，长期切换 |       |             |
|             |             | CK*         |             |             |
|             |             |             |             |             |
|             |             | 方案2：*数据库直接使 |    |             |
|             |             | 用CK*       |             |             |
+-------------+-------------+-------------+-------------+-------------+
|             |             | 终端接入模块方案： | 否   | 是          |
|             |             |             |             |             |
|             |             |             |             |             |
|             |             | 方案1：切换https |        |             |
|             |             | 通讯方案    |             |             |
|             |             |             |             |             |
|             |             | 方案2：保留现有自研I |    |             |
|             |             | PC方案，接口抽象，未 |    |             |
|             |             | 来进行快速切换 |          |             |
+-------------+-------------+-------------+-------------+-------------+
| 2           | 终端联动管控方案，当前 | 联动认证方案： | 否 | 是     |
|             | 支持自家产品联动，未来 |  |             |             |
|             | 需要支持第三方联动 |      |             |             |
|             |             | *使用符合行业内技术规 |   |             |
|             |             | 范的联动认证方案，不能 |  |             |
|             |             | 使用自研方案* |           |             |
+-------------+-------------+-------------+-------------+-------------+
|             |             | API协议方案： | 否        | 是          |
|             |             |             |             |             |
|             |             |             |             |             |
|             |             | *使用符合行业内技术规 |   |             |
|             |             | 范的联动认证方案，不能 |  |             |
|             |             | 使用自研方案* |           |             |
+-------------+-------------+-------------+-------------+-------------+
| 3           | *当前仅需支持虚拟机部 | 使用中台底座，选型方案 | 否 | 是 |
|             | 署，未来需要支持裸金属 | ： |           |             |
|             | 部署*       |             |             |             |
|             |             | 1.  platOS  |             |             |
|             |             |             |             |             |
|             |             | 2.  APEX    |             |             |
+-------------+-------------+-------------+-------------+-------------+
|             |             |             |             |             |
+-------------+-------------+-------------+-------------+-------------+

### 预研及中台复用结论

*若有复用中台，1.6章节方案选型需要包含此中台的选型过程，即使只有一个选型方案。*

*若本次设计包含架构需求和特性需求，则《产品技术风险消除checklist》可以使用同一个文件。*

### 架构方案选型

*此章节，需要用方案选型表进行选型。*

*此处简述总体设计的可供选型方案，并说明最终所选的方案。*

*说明：*

*1、合理的方式，应该是如下用打分的方式进行判断*

*2、如果打分有困难，至少应该填写黄底色框，并叙述最终所选择方案的优点、风险和缺点，目的是只有考虑周全的方案才是合理的，凭借个人经验、对评估准则个人有个人看法的，所选择的方案有可能存在重大风险，埋下地雷。*

9.  #### **xxx的方案选型1**

    3.  ##### **业务场景关键问题及技术特征**

*简述业务场景，如DR2.0的遥测数据处理，是对从多终端中采集各种类型的进程行为数据进行加工处理的业务，它为后续的各级检测引擎提供更丰富的语义信息，该业务具有的业务特征如下：*

(1) *强时序性，如CreateProcess必然发生在Process DeleteFile之前。*

(2) *大上下文（Huge
    > Context)，总设技术ControlGraph等涉及进程图等大型状态。*

(3) *多环节性，云端需要经历数据富化、二级引擎、三级引擎等多级处理。*

    4.  ##### **业务规格要求及约束**

*如用户视角的业务规格要求及约束，需与规划和架构师达成一致。*

*如日志规模支持百万级、指定字段检索秒级响应、支持日志分类汇聚。*

*如资源消耗约束、开源协议约束。*

5.  ##### **方案1**

    *方案一的具体介绍。*

6.  ##### **方案2**

*方案二的具体介绍。*

##### **方案\...**

*按需增加更多方案的具体介绍。*

##### **方案选型决策**

*评估准则要基于业务关键技术特征维度，比如说DR
2.0涉及到遥测数据处理，要不要选型微服务？根据总体设计梳理，其业务特征提炼后有几项评估准则：*

1)  *强时序性，如CreateProcess必然发生在Process DeleteFile之前。*

2)  *大上下文（Huge
    > Context)，总设技术ControlGraph等涉及进程图等大型状态。*

3)  *多环节性，云端需要经历数据富化、二级引擎、三级引擎等多级处理。*

    *在这几项业务特征提炼时，微服务化则不能在DR遥测数据处理环节中被选择，否则就会出现
    上一条日志打到DC1，下一条日志打到DC2导致时序异常； 也会导致Huge
    Context频繁在多个微服务引擎间反复读取（如5次Redis/数据库访问），性能极差。最终DR
    2.0遥测处理未选择微服务。*

*评估准则：*

<table>
<tbody>
<tr class="odd">
<td><p>评估准则</p>
<p>(基于业务关键技术特征维度提炼)</p></td>
<td>权重</td>
<td>评估方法</td>
<td>方案1</td>
<td>方案2</td>
<td>方案3</td>
<td>方案4</td>
<td>给分依据说明</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td></td>
<td></td>
<td></td>
<td>打分</td>
<td>加权得分</td>
<td>打分</td>
<td>加权得分</td>
<td>打分</td>
<td>加权得分</td>
<td>打分</td>
<td>加权得分</td>
<td></td>
</tr>
<tr class="odd">
<td><em>评估准则1</em></td>
<td>50%</td>
<td></td>
<td>5</td>
<td>2.5</td>
<td></td>
<td>0</td>
<td></td>
<td>0</td>
<td></td>
<td>0</td>
<td></td>
</tr>
<tr class="even">
<td><em>评估准则2</em></td>
<td>15%</td>
<td></td>
<td>5</td>
<td>0.75</td>
<td></td>
<td>0</td>
<td></td>
<td>0</td>
<td></td>
<td>0</td>
<td></td>
</tr>
<tr class="odd">
<td><em>评估准则3</em></td>
<td>20%</td>
<td></td>
<td>5</td>
<td>1</td>
<td></td>
<td>0</td>
<td></td>
<td>0</td>
<td></td>
<td>0</td>
<td></td>
</tr>
<tr class="even">
<td><em>评估准则4</em></td>
<td>15%</td>
<td></td>
<td>5</td>
<td>0.75</td>
<td></td>
<td>0</td>
<td></td>
<td>0</td>
<td></td>
<td>0</td>
<td></td>
</tr>
<tr class="odd">
<td></td>
<td></td>
<td></td>
<td></td>
<td>0</td>
<td></td>
<td>0</td>
<td></td>
<td>0</td>
<td></td>
<td>0</td>
<td></td>
</tr>
<tr class="even">
<td>最终得分（满分为5分）</td>
<td>5.00</td>
<td></td>
<td>0.00</td>
<td></td>
<td>0.00</td>
<td></td>
<td>0.00</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>

*选型决策：*

  -------------- -------------- -------------------- ----------
  备选方案名称   本方案的优点   本方案的风险和缺点   最终选择
  *方案1*                                            
  *方案2*                                            
  *方案3*                                            
  *方案4*                                            
  -------------- -------------- -------------------- ----------

9.  ##### **方案对业务的约束**

    *所选型方案对业务的影响或约束。比如选型使用机械硬盘及软raid的方案，则业务对磁盘IO速度要求就不能超过XXXMB；比如
    选型XXX架构，则业务约束线上线下不能架构一致。需与规划和架构师达成一致。*

    *一个真实案例：XXX业务使用4张表来存储4种类型的安全日志数据，而后续业务又新增加web页面显示所有类型的安全日志数据，并且有排序相关需求，但由于数据库是使用4张表来存储，无法实现新的业务需求，而研发为了满足这个需求，将4张表数据读到内存，再进一步排序，这导致页面查询在数据量较大场景超过1分钟，完全无法使用。后面通过与规划讨论，通过变更页面交互设计解决该问题，即不做汇总展示数据，而用分类展示。*

    *该案例中，在安全日志的存储方案选型过程中，决策选型了按类型进行分表存储，则应识别出来不能汇总排序的业务约束，并与规划达成一致，防止违背技术约束，导致错误业务设计导致质量问题发生。*

#### **xxx的方案选型2\...**

*按上面流程格式描述*

2.  特性技术需求设计
    ----------------

    7.  ### 特性需求分析

*基于场景分析-\>问题识别-\>技术思路-\>方案选型的分析设计思路，编写下面附件文件内容。*

### 特性预期目标

*用户视角、用户可感知的产品预期目标，需要考虑当前版本以及未来演进的目标，起到牵引作用。第二章节，是基于此处目标的进一步细节和补充。*

*用户类型有：*

*（1）价值用户：技术决策者（如IT 架构师 /
安全负责人）、采购决策者（如CIO / 数字化总监）、技术使用者（如平台管理员
/ 审计专员）。*

*（2）效果用户：如终端使用用户（终端类产品）、终端泄密者（DLP类防泄漏产品相关）、攻击者/渗透测试者（如EDR/XDR/AF等防入侵类产品相关）。*

*（3）内部用户：交付实施工程师（关注可运维性、可排障性等）、产品规划团队（关注架构生产力、性能、价值兑现程度）、研发技术支持（关注可排障性等）、测试团队（关注可测试性）、架构师团队（关注可扩展性、先进性等）、XAAS-SRE（关注可靠性、可观测性、可运维性等）等*

+-----------------+-----------------+-----------------+-----------------+
| ***编号***      | ***干系人***    | ***目标项概述*** | ***用户预期解决的关键问题或 |
|                 |                 |                 | 指标***         |
|                 |                 |                 |                 |
|                 |                 |                 | ***（填写后请把对应项字体改 |
|                 |                 |                 | 成黑色和正体）*** |
+-----------------+-----------------+-----------------+-----------------+
| 1               | 价值用户        | 性能参数要求    | 如AF支持100G流量； |
|                 |                 |                 |                 |
|                 |                 |                 |                 |
|                 |                 |                 | aES支持10万终端接入。 |
+-----------------+-----------------+-----------------+-----------------+
| 2               | 价值用户        | 资源开销要求    | 如AF支持100G，16核32 |
|                 |                 |                 | G内存；         |
|                 |                 |                 |                 |
|                 |                 |                 | 如aES终端资源占用要求，不影 |
|                 |                 |                 | 响终端用户的体验性，不导致系统 |
|                 |                 |                 | 卡慢。          |
+-----------------+-----------------+-----------------+-----------------+
| 3               | 价值用户        | 可靠性          | SLA要求4个9（每年最多只有 |
|                 |                 |                 | 约52分钟的停机时间） |
+-----------------+-----------------+-----------------+-----------------+
|                 | 内部用户（SRE） |                 | 如需要有容灾方案，数据0丢失 |
|                 |                 |                 |                 |
|                 |                 |                 |                 |
|                 |                 |                 | 如硬件故障数据重建时间每TB少 |
|                 |                 |                 | 于X分钟         |
|                 |                 |                 |                 |
|                 |                 |                 | 如集群服务故障切换时间少于X秒 |
+-----------------+-----------------+-----------------+-----------------+
| 4               | 效果用户        | 兼容性          | 如老版本要能够升级； |
|                 |                 |                 |                 |
|                 |                 |                 |                 |
|                 |                 |                 | 如兼容所有终端环境，包括操作系 |
|                 |                 |                 | 统和杀软。      |
+-----------------+-----------------+-----------------+-----------------+
| 5               | 内部用户（开发人员） | 架构要求   | 如产品要支持适配各硬件平台、适 |
|                 |                 |                 | 配各系统平台、适配海外等场景， |
|                 |                 |                 | 期望代码改动最小化，甚至无需修 |
|                 |                 |                 | 改；            |
|                 |                 |                 |                 |
|                 |                 |                 | 如要求与XDR/APEX可集成 |
|                 |                 |                 | 部署，资源可复用，最大化降低部 |
|                 |                 |                 | 署成本。        |
+-----------------+-----------------+-----------------+-----------------+
| 6               |                 | 可扩展性        | 如性能可横向扩展，无须改动代码 |
|                 |                 |                 | ；              |
|                 |                 |                 |                 |
|                 |                 |                 | 如功能可扩展，通过插件的方式， |
|                 |                 |                 | 老代码无须改动； |
+-----------------+-----------------+-----------------+-----------------+
| 7               |                 | 可调试性        | 如90%的问题都可以通过日志定 |
|                 |                 |                 | 位；            |
|                 |                 |                 |                 |
|                 |                 |                 | 如终端问题可通过平台进行远程排 |
|                 |                 |                 | 障，不影响终端用户的正常使用体 |
|                 |                 |                 | 验；            |
+-----------------+-----------------+-----------------+-----------------+
| 8               | 内部用户（测试人员） | 可测试性   | 如支持mock、分层测试、模块 |
|                 |                 |                 | 独立测试等；    |
|                 |                 |                 |                 |
|                 |                 |                 | 如要有批量测试模拟； |
+-----------------+-----------------+-----------------+-----------------+
| 9               | 内部用户户（用服人员） | 可运维性 | 如4小时完成部署、1小时内完成 |
|                 |                 |                 | 升级；          |
|                 |                 |                 |                 |
|                 |                 |                 | 如控制台配置策略成功后，要知道 |
|                 |                 |                 | 是否生效；      |
|                 |                 |                 |                 |
|                 |                 |                 | 如终端排障时不影响终端用户正常 |
|                 |                 |                 | 使用。          |
+-----------------+-----------------+-----------------+-----------------+

### 特性方案设计

*根据1.2.1的特性需求分析，汇总给出技术思路。*

#### **xxx特性方案设计1**

*汇总提炼1.2中的关键信息。*

*表格中"是否详细方案选型"是指是否在1.6章节中做详细的方案选型。*

+-----------+-----------+-----------+-----------+-----------+-----------+
| 序号      | 目标用户  | 场景      | 方案思路概述 | 是否已预研 | 是否详细方案选型 |
+-----------+-----------+-----------+-----------+-----------+-----------+
| 1         | 用户1：标的Dat | 场景1：从Offi | 技术思路1： | 是 | 是    |
|           | a         | ce        |           |           |           |
|           |           | 365获取邮件 |         |           |           |
|           |           |           | O365标准Gra |         |           |
|           |           |           | ph        |           |           |
|           |           |           | API获取邮件 |         |           |
+-----------+-----------+-----------+-----------+-----------+-----------+
| 2         |           |           | 技术思路2： |         |           |
|           |           |           |           |           |           |
|           |           |           |           |           |           |
|           |           |           | 通过IMAP获取O |       |           |
|           |           |           | 365邮件   |           |           |
+-----------+-----------+-----------+-----------+-----------+-----------+
| 3         |           |           |           |           |           |
+-----------+-----------+-----------+-----------+-----------+-----------+

#### **xxx特性方案设计2**

*汇总提炼1.2中的关键信息。*

*表格中"是否详细方案选型"是指是否在1.6章节中做详细的方案选型。*

+-----------+-----------+-----------+-----------+-----------+-----------+
| 序号      | 目标用户  | 场景      | 方案思路概述 | 是否已预研 | 是否详细方案选型 |
+-----------+-----------+-----------+-----------+-----------+-----------+
| 1         | 用户1：标的Dat | 场景1：从Offi | 技术思路1： | 是 | 是    |
|           | a         | ce        |           |           |           |
|           |           | 365获取邮件 |         |           |           |
|           |           |           | O365标准Gra |         |           |
|           |           |           | ph        |           |           |
|           |           |           | API获取邮件 |         |           |
+-----------+-----------+-----------+-----------+-----------+-----------+
| 2         |           |           | 技术思路2： |         |           |
|           |           |           |           |           |           |
|           |           |           |           |           |           |
|           |           |           | 通过IMAP获取O |       |           |
|           |           |           | 365邮件   |           |           |
+-----------+-----------+-----------+-----------+-----------+-----------+
| 3         |           |           |           |           |           |
+-----------+-----------+-----------+-----------+-----------+-----------+

### 预研及中台复用结论

*若有复用中台，1.2.5章节方案选型需要包含此中台的选型过程。*

*若本次设计包含架构需求和特性需求，则《产品技术风险消除checklist》可以使用同一个文件。*

### 特性技术方案选型

*此章节，需要用方案选型表进行选型。*

*此处简述总体设计的可供选型方案，并说明最终所选的方案。*

*说明：*

*1、合理的方式，应该是如下用打分的方式进行判断*

*2、如果打分有困难，至少应该填写黄底色框，并叙述最终所选择方案的优点、风险和缺点，目的是只有考虑周全的方案才是合理的，凭借个人经验、对评估准则个人有个人看法的，所选择的方案有可能存在重大风险，埋下地雷。*

13. #### **xxx的方案选型1**

    10. ##### **业务场景关键问题及技术特征**

*简述业务场景，如DR2.0的遥测数据处理，是对从多终端中采集各种类型的进程行为数据进行加工处理的业务，它为后续的各级检测引擎提供更丰富的语义信息，该业务具有的业务特征如下：*

(4) *强时序性，如CreateProcess必然发生在Process DeleteFile之前。*

(5) *大上下文（Huge
    > Context)，总设技术ControlGraph等涉及进程图等大型状态。*

(6) *多环节性，云端需要经历数据富化、二级引擎、三级引擎等多级处理。*

    11. ##### **业务规格要求及约束**

*如用户视角的业务规格要求及约束，需与规划和架构师达成一致。*

*如日志规模支持百万级、指定字段检索秒级响应、支持日志分类汇聚。*

*如资源消耗约束、开源协议约束。*

12. ##### **方案1**

    *方案一的具体介绍。*

13. ##### **方案2**

*方案二的具体介绍。*

##### **方案\...**

*按需增加更多方案的具体介绍。*

##### **方案选型决策**

*评估准则要基于业务关键技术需求维度（业务特征），比如说DR
2.0涉及到遥测数据处理，要不要选型微服务？根据总体设计梳理，其业务特征提炼后有几项评估准则：*

1)  *强时序性，如CreateProcess必然发生在Process DeleteFile之前。*

2)  *大上下文（Huge
    > Context)，总设技术ControlGraph等涉及进程图等大型状态。*

3)  *多环节性，云端需要经历数据富化、二级引擎、三级引擎等多级处理。*

    *在这几项业务特征提炼时，微服务化则不能在DR遥测数据处理环节中被选择，否则就会出现
    上一条日志打到DC1，下一条日志打到DC2导致时序异常； 也会导致Huge
    Context频繁在多个微服务引擎间反复读取（如5次Redis/数据库访问），性能极差。最终DR
    2.0遥测处理未选择微服务。*

<table>
<tbody>
<tr class="odd">
<td><p>评估准则</p>
<p>(基于业务关键技术需求维度提炼)</p></td>
<td>权重</td>
<td>评估方法</td>
<td>方案1</td>
<td>方案2</td>
<td>方案3</td>
<td>方案4</td>
<td>给分依据说明</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td></td>
<td></td>
<td></td>
<td>打分</td>
<td>加权得分</td>
<td>打分</td>
<td>加权得分</td>
<td>打分</td>
<td>加权得分</td>
<td>打分</td>
<td>加权得分</td>
<td></td>
</tr>
<tr class="odd">
<td><em>评估准则1</em></td>
<td>50%</td>
<td></td>
<td>5</td>
<td>2.5</td>
<td></td>
<td>0</td>
<td></td>
<td>0</td>
<td></td>
<td>0</td>
<td></td>
</tr>
<tr class="even">
<td><em>评估准则2</em></td>
<td>15%</td>
<td></td>
<td>5</td>
<td>0.75</td>
<td></td>
<td>0</td>
<td></td>
<td>0</td>
<td></td>
<td>0</td>
<td></td>
</tr>
<tr class="odd">
<td><em>评估准则3</em></td>
<td>20%</td>
<td></td>
<td>5</td>
<td>1</td>
<td></td>
<td>0</td>
<td></td>
<td>0</td>
<td></td>
<td>0</td>
<td></td>
</tr>
<tr class="even">
<td><em>评估准则4</em></td>
<td>15%</td>
<td></td>
<td>5</td>
<td>0.75</td>
<td></td>
<td>0</td>
<td></td>
<td>0</td>
<td></td>
<td>0</td>
<td></td>
</tr>
<tr class="odd">
<td></td>
<td></td>
<td></td>
<td></td>
<td>0</td>
<td></td>
<td>0</td>
<td></td>
<td>0</td>
<td></td>
<td>0</td>
<td></td>
</tr>
<tr class="even">
<td>最终得分（满分为5分）</td>
<td>5.00</td>
<td></td>
<td>0.00</td>
<td></td>
<td>0.00</td>
<td></td>
<td>0.00</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>

*选型决策：*

  -------------- -------------- -------------------- ----------
  备选方案名称   本方案的优点   本方案的风险和缺点   最终选择
  *方案1*                                            
  *方案2*                                            
  *方案3*                                            
  *方案4*                                            
  -------------- -------------- -------------------- ----------

16. ##### **方案对业务的约束**

    *所选型方案对业务的影响或约束。比如选型使用机械硬盘及软raid的方案，则业务对磁盘IO速度要求就不能超过XXXMB；比如
    选型XXX架构，则业务约束线上线下不能架构一致。需与规划和架构师达成一致。*

#### **xxx的方案选型2\...**

*按上面流程格式描述*

1.  设计目标
    ========

    3.  设计目标细化
        ------------

*此总体设计任务书由部分开发经理/产品架构师填写下发，说明设计需要达到的要求。*

### 目标细化分析

*汇总分析设定架构和特性的设计目标，每个目标的设定都需要有依据支撑。*

### 目标细化结论

*汇总细化架构和特性的设计目标*

+-----------------------+-----------------------+-----------------------+
| ***编号***            | ***目标项概述***      | ***对应的标准要求***  |
|                       |                       |                       |
|                       |                       | ***（填写后请把对应项字体改成黑色和正体 |
|                       |                       | ）***                 |
+-----------------------+-----------------------+-----------------------+
| 1                     | 性能参数要求          | 说明设计需要满足的并发用户数、并发连接数、 |
|                       |                       |                       |
|                       |                       |                       |
|                       |                       | PPS、支持规则数、界面响应速度、新建连接 |
|                       |                       | 速度等要求            |
+-----------------------+-----------------------+-----------------------+
| 2                     | 资源开销要求          | 说明设计需要满足的内存占用、CPU占用、磁 |
|                       |                       | 盘占用、磁盘操作频繁程度、文件描述符、网络 |
|                       |                       | 传输数据量资源等要求  |
+-----------------------+-----------------------+-----------------------+
| 3                     | 可靠性                | 描述本版本需要达到的可靠性目标，比如在冗余 |
|                       |                       | 设计方面的要求，在故障检测、上报、隔离、恢 |
|                       |                       | 复方面的能力目标（时间、覆盖度等）、过载保 |
|                       |                       | 护方面的目标，升级业务中断方面的目标。这部 |
|                       |                       | 分内容要与5.2.1保持相同，可以是5.2 |
|                       |                       | .1里面的子集（核心的目标）或者全部。也可 |
|                       |                       | 以此处直接链接到5.2.1 |
+-----------------------+-----------------------+-----------------------+
| 4                     | 架构要求              | 描述总体架构设计要达到的要求，比如低耦合、 |
|                       |                       | 可扩展等方面的具体要求，需要给出具体的要求 |
|                       |                       | 和建议                |
+-----------------------+-----------------------+-----------------------+
| 5                     | 可运维性              | 描述设计需要达到的可运维性目标，比如安装部 |
|                       |                       | 署的目标是安装包小于100MB，安装时长小 |
|                       |                       | 于5分钟，安装步骤小于5步，安装无需人工干 |
|                       |                       | 预（全自动），比如在日志管理方面的目标（支 |
|                       |                       | 持一键式采集日志，支持按照进程采集日志等等 |
|                       |                       | ）                    |
+-----------------------+-----------------------+-----------------------+
| 6                     | 可测试性              | 描述设计需要达到的可测试性目标，说明系统给 |
|                       |                       | 功能、压力、性能测试及自动化测试提供的机制 |
|                       |                       | 和方法。比如提供统一的模块内部状态获取及调 |
|                       |                       | 试的接口，制订调试接口规范。 |
+-----------------------+-----------------------+-----------------------+
| 7                     | 可扩展性              | 描述设计需要达到的可扩展性目标，比如系统在 |
|                       |                       | 哪些方面需要保留可扩展的能力，并指明扩展方 |
|                       |                       | 式。                  |
+-----------------------+-----------------------+-----------------------+
| 8                     | 可调试性              | 描述设计需要达到的可调试性目标，比如在排障 |
|                       |                       | 定位方面的目标（所有的进程崩溃问题5分钟定 |
|                       |                       | 位，90%的问题可以通过日志进行定位） |
+-----------------------+-----------------------+-----------------------+
| 9                     | 兼容性                | 允许升级配置的版本、允许对接的版本 |
+-----------------------+-----------------------+-----------------------+
| 10                    | 安全性                | 设备具备防护可拦截恶意攻击能力。（如命令注 |
|                       |                       | 入、敏感凭据读取利用等） |
+-----------------------+-----------------------+-----------------------+
| 11                    | 可重用性              | 当前版本可采用的公用代码、可产出的公用代码 |
|                       |                       | 要求版本经理和开发经理、预研部门一起识别和 |
|                       |                       | 定义产出。            |
+-----------------------+-----------------------+-----------------------+
| 12                    | 其它要求              |                       |
+-----------------------+-----------------------+-----------------------+

下表为**中台项目**额外要求（仅中台项目必须填写，同时也要填写上面的表格）

  ------------ -------------------------- ------------------------------------------------------------------------------------------------------
  ***编号***   ***目标项概述***           ***对应的标准要求（填写后请把对应字体改成黑色和正体，可填写具体内容，或仅填写内容所在的章节信息）***
  12           中台的运行环境要求         说明中台的运行环境和条件，例如：运行于什么类型操作系统和版本？对第三方软件、库有无依赖条件？
  13           中台的交付形式             说明以何种形式交付给使用方？是数据中台，还是二进制程序、运行库，还是代码交付？有无手册文档交付。
  14           中台的合入和升级效率       说明中台被使用方合入需要的工作量花费和复杂度，以及后续升级的工作量复杂度，升级时效。
  15           中台对外输入输出具体接口   如果中台涉及该项，请在此备注接口定义所在的具体章节。
  16           测试自动化率               说明中台的测试自动化率目标
  17           中台落地应用DEMO           是否给出中台应用的示例，方便使用者参考。DEMO需在发布时一起交付。
  ------------ -------------------------- ------------------------------------------------------------------------------------------------------

中台技术要求
------------

*如存在可复用中台，优先考虑使用中台，提升研发效率。*

*需列出关键的中台技术要求，并且与中台负责人确认。*

*研发现有中台查询地址：ts.sangfor.com(内网访问)接口人：谢奕勇18959*

*中台复用需要做严谨的技术方案选型，即要在1章节中做选型，这里是汇总并细化技术要求和约束，并且要与中台负责人确认签字。*

+-------------+-------------+-------------+-------------+-------------+
| 使用中台名称 | 技术要求和约束*（下面 | *中台支撑策略* | *中台确认人* |  |
|             | 以数据库中台为例）* |     |             |             |
+-------------+-------------+-------------+-------------+-------------+
| *如果需要使用中台，请 | *技术特征* | ***数据结构化、关系 | *策略一：* |  |
| 明确使用哪些中台。如无 |  | 复杂**：业务涉及大量 |    |             |
| 法识别是否可以使用中台 |  | 的关联操作和复杂查询* | *短期满足可用；长期要 |  |
| ，可与中台接口人联系后 |  |             | 技术领先。* |             |
| 明确。*     |             |             |             |             |
|             |             |             | *策略二：*  |             |
|             |             |             |             |             |
|             |             |             | *确保技术领先以及持续 |   |
|             |             |             | 领先。*     |             |
|             |             |             |             |             |
|             |             |             | *策略三：*  |             |
|             |             |             |             |             |
|             |             |             | *满足主流业务场景即可 |   |
|             |             |             | ，不要求领先。* |         |
+-------------+-------------+-------------+-------------+-------------+
|             |             | ***读多写少：**业 |       |             |
|             |             | 务大量读操作，写操作较 |  |             |
|             |             | 少且主要是批量写数据* |   |             |
+-------------+-------------+-------------+-------------+-------------+
|             |             | ***数据强一致性：* |      |             |
|             |             | *要求每个读操作都能读 |   |             |
|             |             | 到最新写入的数据* |       |             |
+-------------+-------------+-------------+-------------+-------------+
|             |             | ***......** |             |             |
|             |             | *           |             |             |
+-------------+-------------+-------------+-------------+-------------+
|             | *技术目标*  | *架构：如需要支持水平 |   |             |
|             |             | 扩展*       |             |             |
+-------------+-------------+-------------+-------------+-------------+
|             |             | *性能：*    |             |             |
|             |             |             |             |             |
|             |             | *当前版本要求：XXX |      |             |
|             |             | 数据规模条件，XXX查 |     |             |
|             |             | 询性能要达到10毫秒* |     |             |
|             |             |             |             |             |
|             |             |             |             |             |
|             |             | *长期要求：* |            |             |
|             |             |             |             |             |
|             |             |             |             |             |
|             |             | *XXX数据规模条件， |      |             |
|             |             | XXX查询性能要达到1 |      |             |
|             |             | 毫秒*       |             |             |
+-------------+-------------+-------------+-------------+-------------+
|             |             | *资源消耗：* |            |             |
|             |             |             |             |             |
|             |             |             |             |             |
|             |             | *当前版本要求：XXX |      |             |
|             |             | 场景（数据规模、业务读 |  |             |
|             |             | 写频率等业务场景下）， |  |             |
|             |             | 内存占用\<=1024 |         |             |
|             |             | MB，CPU\<=10 |            |             |
|             |             | %(整机)*    |             |             |
|             |             |             |             |             |
|             |             | *长期要求：内存占用\ |    |             |
|             |             | <=500MB，CPU |            |             |
|             |             | \<=5%(整机)* |            |             |
+-------------+-------------+-------------+-------------+-------------+
|             |             | *......*    |             |             |
+-------------+-------------+-------------+-------------+-------------+

硬件方案
========

描述系统的硬件构成，描述支持的基本硬件平台以及所采用的其他功能芯片(比如压缩，加密等芯片。

基本硬件构成
------------

描述系统所使用的基本硬件平台，各个平台的CPU类型，内存大小，是需要开启PAE

专用芯片说明
------------

*简要描述专用芯片的功能、供应商等信息，如果驱动由第三方提供，则说明驱动支持的OS类型以及OS的版本*

3.  软件方案
    ========

    7.  软件总体架构
        ------------

系统的架构视图，重点是系统的软件模块构成，包括模块名、功能说明以及模块之间的层次(依赖)关系。在系统设计之初(在分析系统流程图之前),我们根据需求和经验初步划分软件功能模块，以及模块的依赖关系和通信模型，然后分析
系统流程图，不断的修正系统的模块划分、模块的依赖关系和通信模型，最终得出模块的接口说明文档，而模块以及模块的接口说明文档，是概要设计阶段的工作入口和依据。

采用4+1视图模式进行描述，如果部分视图重要程度不高，可以省略。

逻辑视图：

描述系统的功能需求，即在为用户提供服务方面系统所应该提供的功能

过程视图：

过程架构考虑一些非功能性的需求，如性能和可用性

物理视图：

物理视图主要描述硬件配置。服务于系统工程人员，解决系统的拓扑结构、系统安装、通信等问题。主要考虑如何把软件映射到硬件上，也要考虑系统性能、规模、可靠性等。可以与进程视图一起映射。物理架构主要关注系统非功能性的需求，如可用性、可靠性（容错性），性能（吞吐量）和可伸缩性

开发视图：

开发视图（DevelopmentView），描述了在开发环境中软件的静态组织结构，即关注软件开发环境下实际模块的组织，服务于软件编程人员

场景视图：

场景视图，又称"用例视图"，它综合所有的视图。用于刻画构件之间的相互关系，将四个视图有机地联系起来。可以描述一个特定的视图内的构件关系，也可以描述不同视图间的构件关系

模块功能说明：

模块类型：即内核代码、驱动、控制台程序、服务程序、UI程序、静态库、动态库，等等。

+-----------------+-----------------+-----------------+-----------------+
| **模块名**      | **安装路径及模块类型** | **功能说明** | **关联的需求点** |
+-----------------+-----------------+-----------------+-----------------+
| *libauth*       | */usr/lib/libau | *认证驱动的接口* |                |
|                 | th.so*          |                 |                 |
|                 |                 |                 |                 |
|                 | *动态库*        |                 |                 |
+-----------------+-----------------+-----------------+-----------------+
| *authd*         | */usr/local/san | *认证守护进程，处理各类认证请 | *需求1.2.9:支持radi |
|                 | gfor/authd*     | 求*             | us认证*         |
|                 |                 |                 |                 |
|                 | *daemon程序*    |                 | *需求1.2.10:支持LDA |
|                 |                 |                 | P认证*          |
+-----------------+-----------------+-----------------+-----------------+
|                 |                 |                 |                 |
+-----------------+-----------------+-----------------+-----------------+

模块设计要求：

  ------------ ---------------------------------------------- ----------------------------------------------------
  **模块名**   **设计要求**                                   **设计策略**
               性能指标、资源约束等概设任务书中定义的目标项   明确本模块的设计策略（概要设计/微型设计/不做设计）
  ------------ ---------------------------------------------- ----------------------------------------------------

系统主流程
----------

*系统主流程是指主要业务场景的系统流程。*

*不同项目阶段的编写要求：*

*DCP2立项阶段：需要编写，目标是通过系统主流程的推演，从而进一步识别架构和方案是否存在考虑不周的问题，以及是否有考虑遗漏的问题。*

*DCP3计划阶段：按需进一步完善设计。*

*系统的动态视图，重点描述系统功能的实现过程。通过各模块的交互，实现所有系统功能。通过分析系统流程图，导出各模块的接口。依据用例或系统功能需求编写系统流程图。每个用例需要对应一个系统流程。每个功能需求点都要描述其实现方案（模块）或者流程。*

*对于规模较大的版本，整体架构只需要定义到子系统一级，系统流程只需要描述子系统之间的交互流程和接口即可。针对每个子系统
的设计在子系统概要设计中完成。*

14. ### 系统流程1

    15. #### **对应用例(功能点)编号**

*该系统流程对应需求中的USE CASE或功能点编号。*

*需将该系统流程对应需求的USE
CASE或功能点细化，描述该系统流程运作过程中可能出现的异常场景。*

#### **流程图与步骤说明**

使用UML的顺序图或其他的图型描述该系统流程图的实现，流程图描述的是各个模块协作完成该系统流程图对应的功能。并且*对流程图中的每步进行详细说明。流程图需覆盖上述所有USE
CASE或功能点。*

#### **导出的各模块接口名列表**

*对于系统流程图的每一步骤，都会导出目标模块的一个接口。模块接口分为两种，一种是同步接口(也就是API接口)；另一种是异步接口(也就是消息接口)。接口的描述包括接口名，参数，返回值，前置／后置条件等等，这里只需要描述接口名，不需要描述接口的所有细节，接口的所有细节在　模块设计　一节中详细描述。*

  -------------- ---------------- ------------------------
  **步骤编号**   **目标模块名**   **对应目标模块接口名**
                                  
                                  
  -------------- ---------------- ------------------------

### 系统流程2...

*按上面流程格式描述*

### 系统初始化流程

系统必须包括初始化流程，描述各个模块的资源分配，结构初始化的过程。该流程图一般最后编写。

### 系统退出流程

系统必须包括退出流程，描述各个模块资源销毁的过程。

系统其它流程
------------

*系统其它流程是指非主要业务场景的系统流程，属于辅助或配套的系统流程。*

*不同项目阶段的编写要求：*

*DCP2立项阶段：无须编写。*

*DCP3计划阶段：需要编写。*

*系统的动态视图，重点描述系统功能的实现过程。通过各模块的交互，实现所有系统功能。通过分析系统流程图，导出各模块的接口。依据用例或系统功能需求编写系统流程图。每个用例需要对应一个系统流程。每个功能需求点都要描述其实现方案（模块）或者流程。*

*对于规模较大的版本，整体架构只需要定义到子系统一级，系统流程只需要描述子系统之间的交互流程和接口即可。针对每个子系统
的设计在子系统概要设计中完成。*

18. ### 系统流程1

    18. #### **对应用例(功能点)编号**

*该系统流程对应需求中的USE CASE或功能点编号。*

*需将该系统流程对应需求的USE
CASE或功能点细化，描述该系统流程运作过程中可能出现的异常场景。*

#### **流程图与步骤说明**

使用UML的顺序图或其他的图型描述该系统流程图的实现，流程图描述的是各个模块协作完成该系统流程图对应的功能。并且*对流程图中的每步进行详细说明。流程图需覆盖上述所有USE
CASE或功能点。*

#### **导出的各模块接口名列表**

*对于系统流程图的每一步骤，都会导出目标模块的一个接口。模块接口分为两种，一种是同步接口(也就是API接口)；另一种是异步接口(也就是消息接口)。接口的描述包括接口名，参数，返回值，前置／后置条件等等，这里只需要描述接口名，不需要描述接口的所有细节，接口的所有细节在　模块设计　一节中详细描述。*

  -------------- ---------------- ------------------------
  **步骤编号**   **目标模块名**   **对应目标模块接口名**
                                  
                                  
  -------------- ---------------- ------------------------

### 系统流程2...

*按上面流程格式描述*

数据结构
--------

描述模块间交互所使用的数据结构，比如数据库，共享内存，文件，等等。统一的消息格式可在此描述，只涉及少数模块的消息格式也可在接口描述时说明。

11. 模块设计
    --------

    20. ### 模块名１

        21. #### **模块系统需求**

描述该模块需实现的系统需求，包括功能需求和性能需求。

#### **模块设计约束**

描述总设对该模块设计的约束，比如不能使用信号进行内部通讯，不能使用多线程，必须使用某个公共库，不能有任何阻塞函数调用，必须满足某方面的扩展性等等。

#### **模块职责及边界描述**

描述总设对该模块设计的职责及边界描述，比如什么功能后续应该实现在本模块内，什么功能应该新增一个模块来承载，整个迭代开发的过程中，模块职责和边界必须非常清晰，否则前一个迭代开发的功能在下一个迭代开发时会面临要反复调整的风险。

#### **模块风险识别及对策**

描述当前识别到的该模块可能存在的潜在风险（比如并发性能可能不达标/模块存在较多外依赖，后续开发过程中可能存在较多关联改动影响），同时给出可行的应对措施。

### 模块名２

关键特性设计
============

***重点：DFX相关特性设计，必须指明目标、实现方案或工具等的具体承接模块。***

12. 安全性设计
    ----------

    22. ### 安全兜底机制合入

要求：此项为必填项，要按照产品交付形态来选择安全兜底机制合入，确保产品默认安全能力防护最佳，暴露面最小化，保护产品免受潜在安全威胁。

安全兜底机制不满足时需备案：由安全经理完成不满足项的分析和确认，并向安全研发部吴义和11582抄送研发主管发出备案申请和确认，邮件答复结果上传至该处。

安全兜底机制合入原则见：
[https://wiki.sangfor.com/pages/viewpage.action?pageId=81602986]{.underline}

模板下载处：

[https://wiki.sangfor.com/pages/viewpage.action?pageId=81603752]{.underline}

中的 《 [总体设计-安全兜底机制合入checklist.xlsx](https://docs.atrust.sangfor.com/download/attachments/190536710/%E6%80%BB%E4%BD%93%E8%AE%BE%E8%AE%A1-%E5%AE%89%E5%85%A8%E5%85%9C%E5%BA%95%E6%9C%BA%E5%88%B6%E5%90%88%E5%85%A5checklist.xlsx?version=1&modificationDate=1747972114321&api=v2)》

请填写《总体设计-安全兜底机制合入checklist.xlsx》表格，结果以附件的形式保存在此处。

### 威胁建模分析

威胁建模分析，目的是分析该版本总体设计中涉及到的各个模块实体、数据存储、进程服务、开放端口、交互协议等是否存在相关的安全威胁风险，把风险识别出来并填入如下表格。

采用微软的STRIDE方法来开展威胁建模与安全设计活动，由安全经理完成威胁建模的评审和确认。

威胁建模学习资源：

[https://wiki.sangfor.com/pages/viewpage.action?pageId=81602196]{.underline}

威胁建模分析报告模板：

[https://wiki.sangfor.com/pages/viewpage.action?pageId=81603752]{.underline}中的《*SFRD-SDL-TMSD-1.5\_X产品X.X威胁建模分析
.xlsx*》

### 安全设计

根据上一节威胁建模中识别出的风险，设计相关的安全机制，以确保系统的安全性。整体安全架构设计和各模块的设计都要满足

[[https://wiki.sangfor.com/pages/viewpage.action?pageId=81603752]{.underline}](https://wiki.sangfor.com/pages/viewpage.action?pageId=81603752)

中的《[安全需求识别checklistV1.2-20241125.xlsx](https://docs.atrust.sangfor.com/download/attachments/190536710/%E5%AE%89%E5%85%A8%E9%9C%80%E6%B1%82%E8%AF%86%E5%88%ABchecklistV1.2-20241125.xlsx?version=2&modificationDate=1736331377000&api=v2)》中的红线和L1要求。

最佳安全设计可参考：

[https://wiki.sangfor.com/pages/viewpage.action?pageId=81602113]{.underline}

#### **整体安全架构设计**

描述整体的安全架构设计机制。

#### **模块1安全设计**

详细描述模块1的安全设计机制。

#### **模块2安全设计**

详细描述模块2的安全设计机制。

### 预使用组件版本安全情况

要求：使用Mend扫描器对预计使用的开源组件对应版本进行扫描，不允许使用严重高危漏洞或开源协议风险分数大于等于65分的组件；

指导：Mend扫描指导文档见：[https://wiki.sangfor.com/pages/viewpage.action?pageId=81602677]{.underline}

组件不符合安全要求且无法替换时，需备案：由安全经理对问题组件完成风险分析，并向安全研发部吴义和11582，抄送研发主管发出邮件申请和确认，将扫描结果、分析过程及研发主管的邮件答复结果上传至该处。

13. 可靠性设计
    ----------

    26. ### 能力目标定义

 如果在立项的时候有了比较完善的可靠性需求的话，可以直接继承可靠性需求里面的目标类需求作为目标，但是有些目标（不可直接测试得到的目标）需要在此处进行进一步的分解，比如需求里面仅定义了SLA要到5个9的需求，就需要进一步分解为故障检测率，障自动恢复率，事故人工恢复时长、故障检测时长、故障自动恢复时间等指标。那么如果在立项的时候没有完善的可靠性需求，此处就需要参照[技术规划中的目标定义](https://docs.atrust.sangfor.com/pages/viewpage.action?pageId=122773291)指导进行版本级的可靠性目标（可以多级表达，类似OKR分解）定义。对于目标的定义可以从三个维度（一级维度）进行，一是基于故障管理能力维度，二是基于故障对象维度，三是从业务功能维度，具体指导如下：

1）故障管理维度：主要适用于全新产品，老产品重构版本，因为这样的版本架构是全新的，但是业务功能是繁杂的，所以更容易从可靠性管理能力的维度进行统一定义，可靠性能力的维度主要包含故障检测能力（检测率，检测时间），故障自动恢复能力（恢复率、恢复时长），事故人工恢复时长，过载保护能力，升级业务中断。前面三个指标也可以是某一类故障（例如硬件类故障、进程类故障等等）进行定义，也可以是全系统或者子系统层级的定义。

2）故障对象维度：主要适用于可靠性专项提升版本，因为这样的版本是重点构建某一个或者某几个可靠性机制，所以更适合按照可靠性机制（故障对象）的维度来定义可靠性目标，例如某个版本主要提升硬盘故障管理能力，资源管控能力，那么在定义可靠性目标的时候，就按照硬盘、资源这两个故障对象来定义，通常从故障模式覆盖度和故障管理能力两个方面来定义，比如资源管控的目标是实现核心进程的CPU、内存上限控制，硬盘故障管理的主要目标是实现硬盘卡慢的分钟级故障检测与自动恢复。

3）业务功能维度：主要适用于普通的业务增量开发版本，因为这样的版本重点在于业务特性功能的实现（包括新开发、重构、迁移、整改等等），基于业务功能角度定义目标就非常聚焦了，目标定义的思路是业务对故障的容错能力，具体表达为在什么样的故障场景下业务可以做到什么样的表现，故障场景指的是个种类的故障模式，业务表现指的是业务的中断时长或者业务的性能下降等方面。比如客户端组件更新在暂时性的网络故障、进程故障下仍然可以成功，数据包下载中断后能够实现断点续传等等。

     
然而实际上一个版本可能包含上述三种情况的两种或者三种，那么我们在定义目标的时候可以多种类型的目标叠加在一起，把明显重合部分去除掉。

说明：此表格只是一个参考，大家可以自行定义表格结构。但是无论怎么定义都要保证各层级目标之间的映射关系，最后一个层级的目标必须是可验证的、可衡量的。

  --------------------------------------------------------------------------------------------------------------------- ------------------------------------- ------------------------------------- ----------
  **一级目标**                                                                                                          **二级目标**                          **三级目标**                          **备注**
  目标描述+目标值：例如故障自动检测率达到95%，故障自动恢复率，故障人工恢复时长小于1小时，升级业务中断时间小于10秒等等   目标描述+目标值：对上一级目标的分解   目标描述+目标值：对上一级目标的分解   
                                                                                                                                                                                                    
                                                                                                                                                                                                    
                                                                                                                                                                                                    
                                                                                                                                                                                                    
                                                                                                                                                                                                    
                                                                                                                                                                                                    
                                                                                                                                                                                                    
  --------------------------------------------------------------------------------------------------------------------- ------------------------------------- ------------------------------------- ----------

### 故障场景分析

\* *分析上述定义的可靠性目标范围内的当前的可靠性能力现状，然后得到现状与目标（上一章定义的）之间的差距（依据是[[公司级可靠性需求基线]{.underline}](https://wiki.sangfor.com/pages/viewpage.action?pageId=60513776)或者各自产品可靠性需求基线、[[公司级可靠性设计准则库]{.underline}](https://wiki.sangfor.com/pages/viewpage.action?pageId=60513658)或者各自产品级可靠性设计准则库），这些差距其实就是实现上述可靠性目标的关键障碍，就是本版本需要落实的设计需求，就是要容错/避免的故障场景/故障模式，当然了有些时候可能有不同的需求选择，请参照[技术规划](https://docs.atrust.sangfor.com/pages/viewpage.action?pageId=122773291)中的需求排序原则进行设计需求筛选。

### 业界竞争分析

分析业界同类产品的关键能力指标的情况；物理架构上的可靠性分析、对比、借鉴；软件架构上的可靠性分析、对比、借鉴，以及关键的可靠性机制（例如内存故障检测、系统过载保护等等）分析、对比、借鉴等等

### 实现方案设计

针对上一步确定的设计需求给出实现的技术方案（容错方案），主要包含两个方面的机制，一是冗余设计，二是故障管理。具体指导如下：

1）冗余设计：需要给出冗余设计实现架构图（硬件部件、软件模块、网络连接：主机/节点、服务/组件/部件、网络接口/网络设备等），实现方式（主备、主从、负荷分担等等），实现原理（切换/仲裁、数据同步、心跳等等），需要明确具体的能力指标（切换时间、集群规模等等），切换/同步/仲裁的机制实现(例如给出什么样的场景需要切换，以及如何完成切换）

2）故障管理：需要给出本版本要实现的设计需求的实现方案（描述清楚采用什么样的技术方案，使用哪些可靠性服务来实现，达到什么样的效果，并画出实现流程图。比如对于网络延时，由主机级网络可靠性服务主机间的网络时延检测，将数据上报到系统级可靠性服务进行综合分析定位到发生时延的网口，系统级可靠性服务下发网口隔离与切换请求到故障网口所在的主机级网络可靠性服务，本机网络可靠性服务执行网口隔离与切换，同时向告警服务上报网络延时的告警），且实现方案需要满足公司级或这个产品的可靠性需求基线、可靠性设计准则库中的技术要求。具体的实现方案可以参照下[[可靠性设计技术]{.underline}](https://wiki.sangfor.com/pages/viewpage.action?pageId=60513802)的公共机制的设计。对于全新产品（一种是新产品的首个标准化版本，另一种是老产品的新架构（重构）版本；再一种特殊情况，虽然是成熟产品，但是在可靠性方面全面/大部分重构）而言还要给出故障检测与恢复整体框架(故障容错框架），包括故障检测与恢复的层级，各个层级的功能以及层级之间的交互关系，需要画出实现框架图（所有可靠性服务的部署视图以及每个可靠性服务的功能范围，可靠性服务与系统内其他服务之间的交互关系），具体设计指导请参照[[系统可靠性设计指导中]{.underline}](https://wiki.sangfor.com/pages/viewpage.action?pageId=60513802)的2.3章节内容。

#### XXX冗余设计方案

给出如硬件部件、软件模块、网络连接：主机/节点、服务/组件/部件、网络接口/网络设备等冗余设计的实现架构，实现方式（主备、主从、负荷分担等等），实现原理（切换/仲裁、数据同步、心跳等等），需要明确具体的能力指标（切换时间、集群规模等等），切换/同步/仲裁的机制实现(例如给出什么样的场景需要切换，以及如何完成切换）。

#### XXX故障管理方案设计

给出系统在故障检测、定位、上报、隔离、恢复方面的机制。按照故障的类别分别给出，例如进程类故障、网络类故障、数据类故障、硬盘类故障等等。

具体的故障类型请参照《深信服故障模式库》和《可靠性需求基线》，主要包括硬件类故障，网络类故障，软件类故障，操作运维类故障（人因差错）。

#### 升级不中断业务设计

给出升级不中断业务的实现原理（热升级、滚动式升级等等），画出升级不断业务的实现流程图。

#### 应急恢复方案设计

给出每一类业务中断或者数据丢失场景（例如虚拟机启动失败、虚拟机运行卡慢，系统宕机、数据丢失等等）的关键恢复方案（事故人工恢复方案）。

### 韧性设计

韧性目标：定义系统业务过载控制目标：比如在2倍业务情况下，成功率达到98%；在3倍业务情况下达到95%；在10倍业务情况下，成功率达到93%；产品在被拒绝服务攻击时，处理性能虽然降低，但仍然可以开展业务服务；

韧性设计：给出系统在业务过载保护方面的设计机制，包含但不限于各类业务的优先级设计，各种业务优先的控制实现机制；此外需要确保产品在遇到消耗大量性能攻击时，需要有对应的安全机制，例如：在Apache/Nginx需要设置拒绝服务的超时机制，并且对于同一时间发起大量无效请求的IP进行一段时间的拒绝响应，直至产品能够完全正常响应。

#### 韧性目标定义

  -------------- ------------------- ------------
  **过载场景**   **指标项**          **指标值**
  并发流量超标   2倍流量业务成功率   98%
                                     
                                     
  -------------- ------------------- ------------

#### 过载场景分析

对产品实际使用场景中可能发生过载的情况进行分析，对每一个可能存在的过载场景，需分析其原因，影响，及需要的保障。如：吞吐量过载场景，导致发生过载是因为短时间内用户的大量访问，过量数据会导致转发设备延迟增大，缓存失效，需保证超过设备处理能力的流量能得到合理处理，不至于引起应用无法访问，处理能力范围内的流量依然符合设计要求，体验不出现大幅下降。

#### 过载保护设计

描述针对各类过载场景，如何处理过载的业务，以满足"韧性目标定义"中所定义的要求。

可测试性设计
------------

在可测试性方面的测试场景分析与实现方案的描述，比如提供了哪类/些测试接口（查询信息类接口，故障模拟类接口等等），提供了哪些测试工具手段等等。

可调试性设计
------------

描述系统需要设计哪些对应的机制，来达成总设任务书中的可调试性要求。平台相关的总体设计必须填写此章节，不能跳过。比如在排障定位方面的目标（所有的进程崩溃问题5分钟定位，90%的问题可以通过日志进行定位）。

可运维性设计
------------

在可运维性方面的测试场景分析与实现方案的描述，可运维性的范围主要包含产品的安装部署、日常运维、巡检、日志管理、故障定位与修复、监控告警、更换扩容、升级补丁等等方面。

### 可运维性目标定义

按照范围子领域进行目标定义逐个，比如安装部署的目标是安装包小于100MB，安装时长小于5分钟，安装步骤小于5步，安装无需人工干预（全自动），再比如升级目标是升级时长小于10分钟，升级支持任意阶段回退，支持灰度升级，支持滚动式热升级等等；再比如排障定位的目标是网络类故障在5分钟完成定位等等。

### 可运维性设计方案

基于上面的定义的可运维性目标，给出达成目标所需要的实现方案，最好是图文方式表达，给出实现的关键流程和关键技术等等。

可扩展性设计
------------

描述设计需要达到的可扩展性目标，比如系统在哪些方面需要保留可扩展的能力，并指明扩展方式。

18. 可复用性设计
    ------------

    33. ### 技术规范落地计划

*根据产品线的技术规范基线计划，定义本版本需要遵守、实现、新增、修订的技术规范。具体参考流程说明：*[[https://wiki.sangfor.com/pages/viewpage.action?pageId=31608353]{.underline}](https://wiki.sangfor.com/pages/viewpage.action?pageId=31608353)

*公司已发布的技术规范列表请参考流程中的相关说明。*

*请填写附件《技术规范基线计划》中的表格，结果以附件的形式保存在本总设文档。此计划需通过技术规范委员会评审，具体要求，请参考上述流程中的相关说明。*

### 本版本可采用的公用代码

*通过识别(和预研部门、RDM一起识别)，列出哪些功能点或模块可以使用公用代码。*

### 本版本可产出的公用代码

*要考虑产出公用代码，以方便其它产品或版本来重用。
这样可以持续提高公司的代码重用率，进而降低研发成本，提高效率。*

### 设计文档更新约定

*本版本中，哪些设计文档、哪些模块在后续改了设计方案、代码后，要同步更新设计文档，在此要进行定义。重要模块和需要传承的模块必须要做更新，其它模块属自愿。*

*此类工作，可以申请给予工作量的支持。*

  ----------------------- ------------------------------------ ------------
  **设计文档名/模块名**   **何种情况下需要更新此文档的基线**   **责任人**
                                                               
                                                               
                                                               
  ----------------------- ------------------------------------ ------------

系统隐私设计
------------

隐私目标：定义系统不会出现因自身安全而造成敏感信息泄露的目标：系统在收集用户信息时，不会出现私自收集用户不清楚及用户不同意收集的数据；

隐私设计：给出系统在业务传输过程保护方面的设计机制，包含但不限于各类业务的传输敏感信息时，需要使用安全协议传输，以及对内容进行加密传输；此外需要确保系统在收集信息时，应明确为什么需要收集该信息，还应尝试预判未来是否会使用这些信息用于其他事物，并告知用户是否有这样的计划，提供一份易于阅读的条款或条件的摘要。

软件质量及效能改进设计
----------------------

*描述在本版本中，为提升软件质量，以及提升软件开发效能，采取了哪些措施，在软件设计方面有哪些举措。这些质量或效能改进，对软件设计有什么影响。*

5.  总结
    ====

    21. 与上一个版本的设计变化
        ----------------------

*描述本版本与上一个版本之间发生变化的总体设计(该设计涉及到多个模块交互或修改后影响多个模块)。如果这个版本总体设计没有变化，或者是新产品，可不填此表，但需在此明确说明没有变化。*

*本节可以按章节描述，也可以直接列成一个表格*

37. ### 设计变化项1

    35. #### **设计变化原因**

*为什么该设计需要变更？*

#### **设计变化描述**

*描述具体发生变化的内容。*

#### **设计变化产生的影响**

*该设计变化会造成什么影响？*

### 设计变化项2...

风险问题保证
------------

*风险问题指那些对于达到预定目标没有十足把握的设计问题。*

  ----------------------------------- --------------------------------------------------------------
  **风险点**                          **风险预研结果/风险规避措施**
  例1：处理速度达100MBPS              根据预研文档《xxx》，可以达到要求
  例2：缓存数据耗用内存可能超过800M   如果超过800M，使用最久未使用淘汰算法将部分数据保存在磁盘上。
                                      
                                      
                                      
  ----------------------------------- --------------------------------------------------------------

尚未解决的问题
--------------

说明在总体设计过程中尚未解决而必须在系统完成之前必须解决的各个问题。

如果总体设计阶段没有问题需要遗留到后续阶段完成，本章节可以为空。

6.  变更控制
    ========

    24. 变更列表
        --------

*在编码过程中，可能会有一些设计不合理的地方，需要对原设计做一些调整，需要在这里说明变更的章节、内容、原因，并对变更进行评审确认（至少需要经过版本经理/开发经理的确认）。此章节在编码完对设计文档更新后进行评审确认。*

*需求变更引起的设计变更，在下面加以说明，并对设计变更的结果进行部门内部评审。*

  -------------- -------------- -------------- ------------------------------------------------------------------------------------------
  **变更章节**   **变更内容**   **变更原因**   **变更对对老功能、原有设计的影响**
                                               考虑完全这些影响，要和开发经理、架构师、设计人员、老版本的开发人员进行交流，并最后评审。
                                               
                                               
                                               
                                               
  -------------- -------------- -------------- ------------------------------------------------------------------------------------------
