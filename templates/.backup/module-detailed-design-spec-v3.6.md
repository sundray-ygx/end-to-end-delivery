**XXX模块概要设计说明书**

(内部文档,不得复制)

![](media/image2.png)

深信服科技有限公司

+------+------------------+------+----------+
| 拟制 | zbc\@sangfor.com | 日期 | 20100505 |
|      |                  |      |          |
|      | yjz\@sangfor.com |      |          |
+------+------------------+------+----------+
| 审核 | gdz\@sangfor.com | 日期 | 20100505 |
+------+------------------+------+----------+
| 批准 | yjz\@sangfor.com | 日期 | 20100507 |
+------+------------------+------+----------+

**修订记录**

+-----------------+-----------------+-----------------+-----------------+
| 修订版本号      | 作者            | 日期            | 简要说明        |
+-----------------+-----------------+-----------------+-----------------+
| *V1.0*          | *xxx*           | *20090808*      | *强化了性能部分的要求* |
+-----------------+-----------------+-----------------+-----------------+
| *V1.5*          | *zbc*           | *20120709*      | *增加了自动化测试支持相关的设 |
|                 |                 |                 | 计要求*         |
+-----------------+-----------------+-----------------+-----------------+
| *V1.7*          | *zbc*           | *20121031*      | *去除了目标书中的审核部分* |
+-----------------+-----------------+-----------------+-----------------+
| *V1.8*          | *Lijian/yjz*    | *20130929*      | *增加了4.5跨平台设计和平台 |
|                 |                 |                 | 差异处理章节*   |
+-----------------+-----------------+-----------------+-----------------+
| *V1.9*          | *zbc*           | *20131213*      | *删除了详设章节* |
+-----------------+-----------------+-----------------+-----------------+
| *V2.1*          | *Chenbo*        | *20190612*      | *增加SDL安全、API标准化 |
|                 |                 |                 | 章节、方案选型打分表* |
+-----------------+-----------------+-----------------+-----------------+
| *V2.2*          | *Zbc*           | *20200102*      | *根据设计培训当中各位设计者反 |
|                 |                 |                 | 馈的疑问，做了一些章节说明。* |
|                 |                 |                 |                 |
|                 |                 |                 |                 |
|                 |                 |                 | *把风险分析章节提前到概要说明 |
|                 |                 |                 | 章节之下，方便做完方案设计马上 |
|                 |                 |                 | 进行风险分析。* |
+-----------------+-----------------+-----------------+-----------------+
| *V2.3*          | *Liyaosheng*    | *20200714*      | *引入黑鸭扫描器，替代SCA， |
|                 |                 |                 | 进行预使用组件的漏洞扫描以及合 |
|                 |                 |                 | 规性检测*       |
|                 |                 |                 |                 |
|                 |                 |                 | *2、新增威胁建模与安全设计文 |
|                 |                 |                 | 档，设计需要对模块开展威胁建模 |
|                 |                 |                 | 与安全设计*     |
+-----------------+-----------------+-----------------+-----------------+
| *V2.4*          | *Liyaosheng*    | *20200805*      | *1、优化特性可靠性设计，新增 |
|                 |                 |                 | 模板*           |
+-----------------+-----------------+-----------------+-----------------+
| *V2.5*          | *Liyunlu*       | *20210531*      | *1、替换威胁建模旧文档，添加 |
|                 |                 |                 | 威胁建模模板链接；* |
|                 |                 |                 |                 |
|                 |                 |                 |                 |
|                 |                 |                 | *2、工具接口人更新（雷琼更新 |
|                 |                 |                 | 为张笑尘）*     |
|                 |                 |                 |                 |
|                 |                 |                 | *3、威胁建模方法：STRIP |
|                 |                 |                 | 替换为STRIDE*   |
+-----------------+-----------------+-----------------+-----------------+
| *V2.6*          | *Zbc*           | *20210830*      | *更新4.4.4可测试性机制分 |
|                 |                 |                 | 析及设计，新增可测试性机制设计 |
|                 |                 |                 | 的目的，设计者需要遵守《软件可 |
|                 |                 |                 | 测试性技术规范》的要求，详情请 |
|                 |                 |                 | 参考：<http://docs |
|                 |                 |                 | .sangfor.org/pa |
|                 |                 |                 | ges/viewpage.ac |
|                 |                 |                 | tion?pageId=421 |
|                 |                 |                 | 48775>*         |
+-----------------+-----------------+-----------------+-----------------+
| *V2.7*          | *Zbc*           | *20211231*      | *在第3章中增加API设计的表 |
|                 |                 |                 | 格，方便设计人员采用统一表格形 |
|                 |                 |                 | 式定义API。*    |
|                 |                 |                 |                 |
|                 |                 |                 | *在第0章，增加一个附件《设计 |
|                 |                 |                 | 表格》，里面有设计过程需要用到 |
|                 |                 |                 | 的各种表格*     |
+-----------------+-----------------+-----------------+-----------------+
| *V2.8*          | *陈杰79521*     | *20220307*      | *刷新4.4.8      |
|                 |                 |                 | 可靠性设计章节，模块可靠性设计 |
|                 |                 |                 | 相关要求、指导，模板等等* |
|                 |                 |                 |                 |
|                 |                 |                 |                 |
|                 |                 |                 | *删除第7章，因为其内容已经在 |
|                 |                 |                 | 4.4.8中包含。但是把7.4 |
|                 |                 |                 |                 |
|                 |                 |                 | 维护设计，调整到4.4 |
|                 |                 |                 |                 |
|                 |                 |                 | 作为4.4.9       |
|                 |                 |                 | 可维护性设计，具体的设计要求、 |
|                 |                 |                 | 指导、模板等后续进行刷新* |
+-----------------+-----------------+-----------------+-----------------+
| *V2.9*          | *Longhao*       | *20221008*      | *新增章节4.4    |
|                 |                 |                 | 对软件总体架构的影响* |
+-----------------+-----------------+-----------------+-----------------+
| *V3.0*          | *徐赢17778*     | *20230904*      | *修改安全设计相关要求不再使用 |
|                 |                 |                 | 黑鸭扫描及是否做威胁建模由产线 |
|                 |                 |                 | 自己决策*       |
+-----------------+-----------------+-----------------+-----------------+
| *V3.1*          | *Tanyongjie*    | *20240311*      | *模板线上化，更新FEMA部门 |
|                 |                 |                 | 内容*           |
+-----------------+-----------------+-----------------+-----------------+
| *V3.2*          | *陈杰79521*     | *20240808*      | *1）2.3         |
|                 |                 |                 | 稳定性/可靠性要求修改为可靠性 |
|                 |                 |                 | 要求            |
|                 |                 |                 | 相关的要求描述也随之改变* |
|                 |                 |                 |                 |
|                 |                 |                 |                 |
|                 |                 |                 | *2）4.5.8结构修改以及相 |
|                 |                 |                 | 关的描述指导修改* |
+-----------------+-----------------+-----------------+-----------------+
| *V3.3*          | *谭永杰81778*   | *20250522*      | *1）优化DFX特性设计章节， |
|                 |                 |                 | 和总体设计的DFX维度保持一致 |
|                 | *吴义和11582*   |                 | ，使模块概要设计能承接总体设计 |
|                 |                 |                 | 的DFX特性设计。* |
|                 |                 |                 |                 |
|                 |                 |                 |                 |
|                 |                 |                 | *a.             |
|                 |                 |                 | 将DFX特性章节统一合入关键特 |
|                 |                 |                 | 性设计章节*     |
|                 |                 |                 |                 |
|                 |                 |                 | *b.             |
|                 |                 |                 | 可维护性设计调整为可运维性设计 |
|                 |                 |                 | *               |
|                 |                 |                 |                 |
|                 |                 |                 | *c.             |
|                 |                 |                 | 可扩展可复用设计调整为可扩展性 |
|                 |                 |                 | 设计和可复用性设计* |
|                 |                 |                 |                 |
|                 |                 |                 |                 |
|                 |                 |                 | *2）更新安全性部分内容* |
|                 |                 |                 |                 |
|                 |                 |                 |                 |
|                 |                 |                 | *a.             |
|                 |                 |                 | 新增安全兜底机制合入要求，最佳 |
|                 |                 |                 | 实践等；明确了执行的要求；* |
|                 |                 |                 |                 |
|                 |                 |                 |                 |
|                 |                 |                 | *b.             |
|                 |                 |                 | 明确了不满足时，处置要求和方法 |
|                 |                 |                 | ；*             |
|                 |                 |                 |                 |
|                 |                 |                 | *c.             |
|                 |                 |                 | 刷新了第三方开源组件的工具替换 |
|                 |                 |                 | ，由黑鸭替换为Mend* |
+-----------------+-----------------+-----------------+-----------------+
| *V3.4*          | *谭永杰81778*   | *20250630*      | 1.  *优化设计任务书的模块 |
|                 |                 |                 | 整体目标，补充DFX维度。* |
|                 |                 |                 |                 |
|                 |                 |                 |                 |
|                 |                 |                 | 2.  *优化API接口要求， |
|                 |                 |                 | 明确openAPI规范。* |
+-----------------+-----------------+-----------------+-----------------+
| *V3.6*          | *谭永杰81778*   | *20250912*      | *将docs地址更新为wiki |
|                 |                 |                 | 地址*           |
+-----------------+-----------------+-----------------+-----------------+
| *V3.6*          | *吴义和11582*   | *20251127*      | *1）5.1章节更新，把原模板 |
|                 |                 |                 | 库的地址由原wiki，替换为c |
|                 |                 |                 | ms；*           |
|                 |                 |                 |                 |
|                 |                 |                 | *2）组件选项描述修正，降原扫 |
|                 |                 |                 | 描，改为选项；* |
+-----------------+-----------------+-----------------+-----------------+

目录

0.设计方法参考 7

[1. 介绍 7](\l)

[1.1. 目的 7](\l)

[1.2. 定义和缩写 7](\l)

[1.3. 参考和引用 8](\l)

[2. 设计任务书 8](\l)

[3. 对外接口 10](\l)

[3.1. API接口 11](\l)

[3.2. 消息接口 11](\l)

[4. 概要说明 12](\l)

[4.1. 背景描述 12](\l)

[4.1.1. 工作原理 12](\l)

[4.1.2. 应用场景 12](\l)

[4.1.3. 对手分析 12](\l)

[4.2. 方案选型 12](\l)

[4.3. 静态结构 13](\l)

[4.4. 对软件总体架构的影响 14](\l)

[4.5. 概要流程 14](\l)

[4.5.1. 流程1(改成具体的流程名字) 14](\l)

[4.5.2. 流程x(根据需要可自行添加章节) 14](\l)

[4.6. 关键特性设计 15](\l)

[4.6.1. 安全性设计 15](\l)

[4.6.2. 可靠性设计 16](\l)

[4.6.3. 可测试性设计 19](\l)

[4.6.4. 可调试性设计 19](\l)

[4.6.5. 可运维性设计 19](\l)

[4.6.6. 可扩展性设计 19](\l)

[4.6.7. 可复用性设计 20](\l)

[4.6.8. 系统隐私设计 20](\l)

[4.6.9. 跨平台设计和平台差异处理 20](\l)

[4.7. 方案风险分析 20](\l)

[5. 数据结构设计 21](\l)

[5.1. 配置文件定义 21](\l)

[5.2. 全局数据结构定义 21](\l)

[6. 流程设计 22](\l)

[6.1. 子模块1/类1/主题1 22](\l)

[6.1.1. 静态结构 22](\l)

[6.1.2. 处理流程 22](\l)

[6.1.3. 关键算法描述 22](\l)

[6.1.4. 数据结构定义 23](\l)

[6.1.5. 函数列表 23](\l)

[6.1.6. 设计要点检视 23](\l)

[6.2. 子模块2/类2/主题2 24](\l)

[7. 总结 24](\l)

[7.1. 关联分析 24](\l)

[7.2. 遗留问题解决 24](\l)

[8. 业务逻辑相关的测试用例 25](\l)

[9. 变更控制 25](\l)

[9.1. 变更列表 25](\l)

 0.设计方法参考
==============

*概设的输入：总体设计里面划分好的某个具体模块、该模块需要实现的对外接口、该模块的系统流程；*

*开始撰写前，画出一个方案的大体思路交给专家评定（画一些图示等）。*

*概设的输出：设计该模块的全局的数据结构（包括结构体定义）、接口流程图、实现接口的所有内部函数（功能、流程图）*

*如果一个模块比较大，还可以划分小的模块来并行设计，可以在"概要说明"章节里面再划分子模块，分别分配给不同的人员进行设计，再合并成一份文档，但必须有一个人负责模块的总体概要设计，对本模块概要设计负总责。*

+----------------------+----------------------+
| *模块设计方法参考：* | *模块设计特性参考：* |
|                      |                      |
| *设计常用表格： *    |                      |
+----------------------+----------------------+

1.  介绍
    ====

    1.  目的
        ----

*简要介绍该设计要解决的问题（满足用户什么需求或者解决现有设计什么问题）。*

定义和缩写
----------

*定义或解释本文档中使用的所有专用名词和缩略语。*

参考和引用
----------

*列出本文档编写过程中参考的其它文档或资料*

1.  *参考需求文档的哪些章节*

2.  *参考总体设计文档的哪些章节*

3.  *参考的其他文档*

设计任务书
==========

*本设计目标书在设计开始前由总体设计人员填写下发给概要设计人员，责任追溯时，如果任务书不完整有遗漏，则为总体设计人员的责任。*

*概要设计人员遵照任务书要求完成设计，需自行检查是否达到任务书的要求，在"自检"这一列填写是否通过（如对于需求点，需指明相关描述所在的章节号）。*

*性能目标和整体目标不允许写"与XX相同"一类，如果与别的项目（或版本）相同，就把别的项目（或版本）的指标复制到这里。*

+-------------+-------------+-------------+-------------+-------------+
| 1.          |             |             |             |             |
| 需求跟踪（必须覆盖需求 |  |             |             |             |
| 矩阵中与本模块相关的所 |  |             |             |             |
| 有需求点）  |             |             |             |             |
+-------------+-------------+-------------+-------------+-------------+
| **编号**    | **需求点名称** | **需求点说明/验收条 | **自检** |     |
|             |             | 件**        |             |             |
+-------------+-------------+-------------+-------------+-------------+
| 1.1         | *（有多个功能点，就依 | *从功能要求（能完成什 | *写明该需求点具体在哪 |  |
|             | 次COPY，实际编写需 | 么任务，达成用户什么期 | 个章节描述* |  |
|             | 求列表时请把注释和例子 | 望），性能要求（包括资 |  |  |
|             | 删除）*     | 源开销），稳定可靠性要 |  |             |
|             |             | 求等方面描述该需求点完 |  |             |
|             |             | 成后需要达成的要求。本 |  |             |
|             |             | 描述要求简洁、准确，可 |  |             |
|             |             | 作为设计验收的chec |      |             |
|             |             | klist。*    |             |             |
+-------------+-------------+-------------+-------------+-------------+
| 1.2         | *例子（AC上网加速中 | 1.用户可以启用或禁用 | 通过，见6.1.2 |  |
|             | 的需求点）：能够启用、 | 上网加速，启用时能够提 |  |  |
|             | 禁用整个上网加速系统； | 升内网用户的上网速度， |  |  |
|             | *           | 禁用时对系统性能无任何 |  |             |
|             |             | 影响；      |             |             |
|             |             |             |             |             |
|             |             | 2.启动系统时间不超过 |    |             |
|             |             | 3.5s，禁用系统不超 |      |             |
|             |             | 过3s        |             |             |
|             |             |             |             |             |
|             |             | 3.异常关机、配置文件 |    |             |
|             |             | 被破坏情况下仍能正常启 |  |             |
|             |             | 动系统；    |             |             |
+-------------+-------------+-------------+-------------+-------------+
|             |             |             |             |             |
+-------------+-------------+-------------+-------------+-------------+
| 2.          |             |             |             |             |
| 模块整体目标 |            |             |             |             |
+-------------+-------------+-------------+-------------+-------------+
| **编号**    | **目标项概述** | **对应的评审标准** | **自检** |      |
+-------------+-------------+-------------+-------------+-------------+
| 2.1         | 性能        | 并发用户数  |             |             |
+-------------+-------------+-------------+-------------+-------------+
|             |             | 并发连接数  |             |             |
+-------------+-------------+-------------+-------------+-------------+
|             |             | PPS（每秒处理包个数 |     |             |
|             |             | ）          |             |             |
+-------------+-------------+-------------+-------------+-------------+
|             |             | 支持规则数  |             |             |
+-------------+-------------+-------------+-------------+-------------+
|             |             | 界面响应速度 |            |             |
+-------------+-------------+-------------+-------------+-------------+
|             |             | 新建连接速度 |            |             |
+-------------+-------------+-------------+-------------+-------------+
|             |             | 其它        |             |             |
+-------------+-------------+-------------+-------------+-------------+
| 2.2         | 资源开销    | 内存占用    |             |             |
+-------------+-------------+-------------+-------------+-------------+
|             |             | DISK占用    |             |             |
+-------------+-------------+-------------+-------------+-------------+
|             |             | 其它        |             |             |
+-------------+-------------+-------------+-------------+-------------+
| 2.3         | 安全性要求  | 防止被越权使用或者成为 |  |             |
|             |             | 攻击点      |             |             |
+-------------+-------------+-------------+-------------+-------------+
| 2.4         | 可靠性要求  | 本业务模块的可靠性要求 | *定义本模块的可靠性能 |  |
|             |             | （也即可靠性能力目标） | 力目标（目标要可验证可 |  |
|             |             |             | 衡量）*     |             |
+-------------+-------------+-------------+-------------+-------------+
| 2.5         | 可测试性要求 | 可测试性目标或需求 |     |             |
+-------------+-------------+-------------+-------------+-------------+
| 2.6         | 可调试性要求 | 可调试性目标或需求 |     |             |
+-------------+-------------+-------------+-------------+-------------+
| 2.7         | 可运维性要求 | 可运维性目标或需求 |     |             |
+-------------+-------------+-------------+-------------+-------------+
| 2.8         | 可扩展性要求 | 可扩展性目标或需求 |     |             |
+-------------+-------------+-------------+-------------+-------------+
| 2.9         | 可复用性要求 | 可复用性目标或需求 |     |             |
+-------------+-------------+-------------+-------------+-------------+
| 2.10        | 兼容性      | 允许升级配置的版本 |      |             |
+-------------+-------------+-------------+-------------+-------------+
|             |             | 允许对接的版本 |          |             |
+-------------+-------------+-------------+-------------+-------------+
| 2.11        | 其它        |             |             |             |
+-------------+-------------+-------------+-------------+-------------+
| 3.流程要求  |             |             |             |             |
+-------------+-------------+-------------+-------------+-------------+
| 该文档是否需要外部评审 | *按设计流程要求* |  |        |             |
| ？          |             |             |             |             |
+-------------+-------------+-------------+-------------+-------------+
| 审核人签名  | 　          | 时间        | 　          |             |
+-------------+-------------+-------------+-------------+-------------+

对外接口
========

*描述本模块对外提供的软件接口，即是该模块的需要实现的需求功能之一*

*需要提供哪些对外接口，是从总体设计里面分解模块得到的，这里可以拷贝总体里面该模块的外部接口列表。*

*如果本模块支持自动化测试，需要实现对应的自动化测试接口，也需在"对外接口"中明确下来。*

*模块的对外接口，需要遵守公司定义的API规范。如果现有规范无法覆盖需求，需要组织干系方讨论需求，提取新的规范接口并评审。*

API接口
-------

*如果未对外提供API接口，本章节可以忽略。*

*Api接口：以api或rpc等形式提供的外部接口。 *

*如果是产品级对外的openAPI，或者产品之间的openAPI，统一使用swagger格式归档。格式规范：https://wiki.sangfor.com/pages/viewpage.action?pageId=64519005*

*如果模块之间的API，不强约束。可以采用如下表格。*

  -------- -------------------- ------- ------ --------------------
  名称     *create\_listener*                  
  功能     *创建侦听socket*                    
           参数名               类型    方向   说明
           *port*               *int*   *in*   *Socket侦听的端口*
  参数     *... ...*                           
  返回值   *Socket的描述符*                    
  -------- -------------------- ------- ------ --------------------

消息接口
--------

*如果未对外提供消息接口，本章节可以忽略。*

*消息接口：以进程/实体间传递的消息为接口*

  ------------- ---------------------------------- --------------
  名称          *msg\_hdr*                         
  说明          *该二进制消息的用途，注意事项等*   
  字段名        类型/长度(单位bit)                 说明
  *head*        *CH*                               *通用数据头*
  *src\_ip*     *32*                               *源IP*
  *dst\_ip*     *32*                               *目的虚拟IP*
  *src\_port*   *16*                               *源端口*
  *dst\_port*   *16*                               *目的端口*
  *buff*        *变长*                             *载荷*
                                                   
  ------------- ---------------------------------- --------------

4.  概要说明
    ========

    6.  背景描述
        --------

        1.  ### 工作原理

> *描述本模块的主要工作原理，关键需求的设计思路。*

### 应用场景

*对本模块在客户处的应用场景进行分析。客户应用本模块解决什么问题，客户在哪些场合、有哪些方式来应用本模块，使用过程中有哪些操作，会发生哪些事件，需要得到什么处理结果？比如：在京东购书，主场景是用户登录app，搜索图书，下单，付款，快递上门。过程中可能发生登录失败，付款不成功，等各种各样的事件。*

*场景分析的目的是分析清楚模块运行过程中会发生什么事件，分析的结果用以评估各方案在实际运行过程中，能否正常应对这些事件，会不会发生问题。*

*可以采用用例分析（use
case）方法对场景进行分析，也可以用事件流分析方法对场景进行分析，参考：*[[http://200.200.1.35/designing/aim/scene-analysis.html]{.underline}](http://200.200.1.35/designing/aim/scene-analysis.html)*。*

### 对手分析

*如果竞争对手有类似功能，本节对竞争对手的功能实现进行分析，说明对手的方案的优缺点，以及借鉴的地方。如果业界其它产品中有类似功能或方案，选择较为突出的进行分析，并说明借鉴的地方。对手分析的目的不是模仿对手，而是为了更全面的了解该领域需要面对的问题和前人已经使用过的解决方案，保证设计过程不要踩坑，做无用功。*

方案选型
--------

*此章节，需要使用方案选型表对核心需求项的多个可行方案进行选型，确定最终采用的实现方案。*

*此处简述本设计的可供选型方案，并说明最终所选的方案，以及选择该方案的原因。**此章节需最先完成，并且方案选型表讨论通过，才能展开下一步的设计工作。参考：***[[http://200.200.1.35/designing/decision/scheme\_select.html]{.underline}](http://200.200.1.35/designing/decision/scheme_select.html)

*说明：*

*1、合理的方式，应该是如下用打分的方式进行判断*

*2、如果打分有困难，至少应该填写黄底色框，并叙述最终所选择方案的优点、风险和缺点，目的是只有考虑周全的方案才是合理的，凭借个人经验、对评估准则个人有个人看法的，所选择的方案有可能存在重大风险，埋下地雷。*

  ----------------------- ------ ---------- ------- ---------- ------- ---------- ------ ---------- ------ ----------
  评估准则                权重   评估方法   方案1   方案2      方案3   方案4                               
                                            打分    加权得分   打分    加权得分   打分   加权得分   打分   加权得分
  *评估准则1*             50%               5       2.5                0                 0                 0
  *评估准则2*             15%               5       0.75               0                 0                 0
  *评估准则3*             20%               5       1                  0                 0                 0
  *评估准则4*             15%               5       0.75               0                 0                 0
                                                    0                  0                 0                 0
  最终得分（满分为5分）   5.00              0.00               0.00               0.00                     
  ----------------------- ------ ---------- ------- ---------- ------- ---------- ------ ---------- ------ ----------

  -------------- -------------- -------------------- ----------
  备选方案名称   本方案的优点   本方案的风险和缺点   最终选择
  *方案1*                                            
  *方案2*                                            
  *方案3*                                            
  *方案4*                                            
  -------------- -------------- -------------------- ----------

静态结构
--------

*本章节描述模块中各软件单元（子模块或类）之间的结构关系，使用静态视图方式描述（比如类图、结构图等）。即整个模块可以分解为哪些软件单元，这些软件单元相互之间是什么关系，以及他们是怎么协作完成整体工作任务的。*

*本章节还需描述那些作为流程间协作纽带的公共数据结构，比如连接跟踪模块的连接表。本章对数据结构进行概要描述，主要描述数据结构设计意图以及与其它数据结构之间的关系，帮助理解围绕该数据结构设计的概要流程。详细定义可以放在后续章节给出。*

对软件总体架构的影响
--------------------

*本章节描述本次新增及调整模块对软件总体架构的影响点。*

+-----------------------------------+-----------------------------------+
| 情况分类                          | 是否对总设有影响                  |
+-----------------------------------+-----------------------------------+
| *1                                | *是/否*                           |
| 本次新增或调整的模块对总体架构是否有影响* |                           |
+-----------------------------------+-----------------------------------+
| *2                                | *是/否*                           |
| 本次新增或调整的模块对总体架构有一定程度的影响，但涉及的模块少于3 |   |
| 个（如调整了某个基础模块对外提供服务的方式，由socket通信改为 |        |
| 了rpc调用），请在本章节描述具体的架构改动内容；* |                    |
+-----------------------------------+-----------------------------------+
| *3                                | *是/否*                           |
| 本次新增或调整的模块对总体架构有较大影响，需要对原有软件架构进行较 |  |
| 大调整或者重新设计，请重新做设计策略。《XXX版本设计策略说明书. |      |
| docx》模板：*                     |                                   |
|                                   |                                   |
| *https://cms.atrust.sangfor.com/p |                                   |
| ages/viewpage.action?pageId=46981 |                                   |
| 063*                              |                                   |
+-----------------------------------+-----------------------------------+

概要流程
--------

说明本模块的基本设计概念和处理流程动态视图，尽量使用图表的形式，并描述其具体步骤。本节描述的流程一般是那些涉及到多个子模块(或类)的流程。

### 流程1(改成具体的流程名字)

> *描述。*

### 流程x(根据需要可自行添加章节)

> *描述。*

关键特性设计
------------

***重点：存在总体设计时，模块概要设计的DFX特性设计，必须承接总体设计DFX特性设计的目标、实现方案或工具等。***

6.  ### 安全性设计

    1.  #### 安全兜底机制覆盖

*要求：此项为必填项，根据产品已合入的兜底项来确定要满足的安全项要求，确保产品默认安全能力防护最佳，暴露面最小化，保护产品免受潜在安全威胁。*

*安全兜底机制不满足时需备案：由安全经理完成不满足项的分析和确认，并向安全研发部吴义和11582抄送研发主管发出备案申请和确认，邮件答复结果上传至该处。*

*模板下载处：*

*[https://cms.atrust.sangfor.com/pages/viewpage.action?pageId=196484511]{.underline}中的《 模块概要设计-安全兜底机制合入checklist.xlsx》*

*请填写《模块概要设计-安全兜底机制合入checklist.xlsx》表格，结果以附件的形式保存在此处。*

#### 威胁建模分析（由产线安全经理判断是否需要执行）

威胁建模分析，目的是分析该版本总体设计中涉及到的各个模块实体、数据存储、进程服务、开放端口、交互协议等是否存在相关的安全威胁风险，把风险识别出来并填入如下表格，

采用微软的STRIDE方法来开展威胁建模与安全设计活动，由安全经理完成威胁建模的评审和确认。

威胁建模学习资源：

*[https://wiki.sangfor.com/pages/viewpage.action?pageId=81602196]{.underline}*

威胁建模分析报告模板：

*[https://cms.atrust.sangfor.com/pages/viewpage.action?pageId=196484511]{.underline}*中的

《*SFRD-SDL-TMSD-1.5\_X产品X.X威胁建模分析 .xlsx*》

#### 安全设计

*根据上一节威胁建模中识别出的风险，设计相关的安全机制，以确保系统的安全性。整体安全架构设计和各模块的设计都要满足[https://cms.atrust.sangfor.com/pages/viewpage.action?pageId=186937372]{.underline}中的《安全基线检视表V1.2.xlsx》中的涉及项。*

*最佳安全设计可参考：*

*[https://wiki.sangfor.com/pages/viewpage.action?pageId=81602113]{.underline}*

##### 模块1安全设计

*详细描述模块1的安全设计机制。*

##### 模块2安全设计

*详细描述模块2的安全设计机制。*

#### 预使用组件版本合规性及版本漏洞情况（必做）

*要求：使用的开源组件对应版本，不允许有严重高危/可利用漏洞或开源协议风险分数大于等于65分的组件；*

*指导：Mend扫描指导文档见：[https://cms.atrust.sangfor.com/pages/viewpage.action?pageId=196484586]{.underline}*

*组件不符合安全要求且无法替换时，需备案：由安全经理对问题组件完成风险分析，并向安全研发部吴义和11582，抄送研发主管发出邮件申请和确认，将扫描结果、分析过程及研发主管的邮件答复结果上传至该处。*

### 可靠性设计

\*       
基于可靠性工程的角度来进行的，基于故障容错的思路来开展的，不包含代码功能实现缺陷、业务逻辑的不合理、业务条件的不满足导致的特性失效。主要包含下面三个方面的内容，其中前两个内容主要依赖于系统内的公共机制来辅助实现或者依赖特性功能自身实现，第三个内容依赖FMEA分析来进行：*

***1 承载载体可靠***

\* 基于该特性的实现，分析该特性的承载载体，基于可靠性需求基线、可靠性设计准则库中的要求给出这些载体的可靠性方案。此处在系统可靠性设计（例如总体设计说明书）中如果已经包含，则不用重复。通常情况下特性的载体体现为进程/服务及相关联的数据和文件，以及特有的硬件部件（例如FPGA、加密卡等）、开源软件（例如数据库Mongodb等等）、自研中间件等*

*1) 进程/服务故障的检测、告警上报、自动恢复，部分依赖于系统可靠性的公共机制。重点考虑2个方面*

*1.1）服务自身故障的自动恢复：虽然有进程故障管理的公共机制，但是仍然需要考虑是否满足本特性的需要，比如进程故障管理公共机制里面没有包含对进程D状态的检测与恢复，二本特性从实现上来讲比较容易出现进程D状态，那就要给进程故障管理公共机制提出对进程D状态进行检测与自动恢复的需求并配合共同实现*

*1.2）关联的数据的要求：则进程故障过程不能丢失数据（具备持久化能力）、不能残留数据（垃圾数据清理能力或者再利用能力）、进程本身也不能有残留*

*2)服务的冗余机制：用于主机级以及服务级故障的容错，比如主备集群，主从式集群，负荷分担集群（依赖负载均衡器）等等，典型的例子如k8s基于kube-vip的K8S
Master
Node集群等等；不仅要组集群，还需要做到故障切换过程可靠（应切能切，不误切）和不中断业务，集群节点之间的数据同步/数据一致性，其他根据集群特点需要考虑的范围等等*

*3)数据、文件：通用的数据、文件的故障的检测与恢复机制，包含但不限于数据与文件的系统内备份以及系统外备份
、数据一致性校验等*

*4)特定硬件部件：要有硬件冗余机制，要保证硬件冗余切换过程可靠（应切能切，不误切）以及不中断业务，硬件故障（损坏、卡慢等等）检测与告警上报*

*5)开源组件、自研中间件：要有双机或者集群机制，还需要做到故障切换过程可靠（应切能切，不误切）和不中断业务，集群节点之间的数据同步/数据一致性，其他根据集群特点需要考虑的范围等等，组件、中间件所涵盖的故障模式的故障检测与告警上报（例如Etcd服务启动失败等等）*

***2  周边无影响***

\* 
 基于该特性的实现，分析该特性的资源使用（包含但不限于CPU、内存、硬盘空间、硬盘IO、网络带宽、业务资源等等），明确该特性与其他特性之间的资源隔离机制。此处在系统可靠性设计（例如总体设计说明书）中如果已经包含，则不用重复。主要考虑的是功能特性（包含所有的承载载体：服务、数据文件、特有硬件、中间件等等）在保证自身功能实现的前提下不会对其他等特性产生不利的影响，最大的通用的不利影响主要体现在因为自身对资源的过度占用（无论是业务行为还是缺陷导致的）而导致其他功能特性甚至整个系统因为资源被强占而出现业务性能下降或者中断。因此需要对该功能特性的资源占用进行上限控制（可以是静态的也可以是动态的）。包含但不限于CPU、内存、硬盘空间、硬盘IO、网络带宽、文件目录上限等等资源，当然实现这些资源的上限控制机制，主要体现在两个方面，一方面是功能实现自身的的控制（比如控制了业务处理的规格限制也一定程度上控制了资源的占用），另一个方面是需要通过公用的机制对功能特性的资源占用上限进行控制。当然也可能会有其他方面的不利影响，需要根据业务模块自身而定。*

***3
业务流程可靠**：功能特性所实现的每一个业务都是可靠性的，主要是基于业界的FMEA工程方法进行，其核心思想是分析每个功能特性中的每个功能点的处理流程中会发生什么样的故障以及如何避免这些故障带来的功能不可用。主要包含如下四方面的分析内容：*

***1）功能定义**：将功能特性分解为若干个子业务/功能，然后定义每个子业务/功能的功能要求；画出每个子业务/功能的时序流程图，明确业务流程中的关键动作（例如写文件、写缓存、读数据库等等），每个流程的流程图，参照如下的截图进行*

![](media/image6.png)

***2） 失效分析**：定义每个子业务/功能的失效模式（上一个步骤的功能要求的反面），然后基于时序流程图中的关键动作分析产生失效的原因（其实就是关键动作执行失败、执行卡慢）*

***3） 行动排序**：上面完成了失效模式、失效影响、失效原因的分析后，下一步就是要采取一些措施来避免失效模式的发生或者降低失效影响。但是由于资源、技术、时间或者其他的固有原因，必须要对这些失效场景进行优先级排序。业界在FMEA种使用AP（行动优先级）（提供了1000多种等的组合）作为落实改进措施的优先级依据，其依赖于三个因素，首先是严重程度（S），其次是发生频度（O），最后是可探测度（D），将改进措施定义为三个优先级：高（H）、中（M）、低（L）*

***4） 改进措施**：给出避免失效（消除故障、检测并自动恢复故障）或者降低失效发生概率、影响程度的方案*

*FMEA相关指导和链接如下：*

*FMEA分析指导：[[特性设计指导中]{.underline}](https://docs.atrust.sangfor.com/pages/viewpage.action?pageId=351885051)的2.3*

*FMEA分析模板：[[公司级FMEA分析模板]{.underline}](https://docs.atrust.sangfor.com/pages/viewpage.action?pageId=212302936)*

*可靠性需求基线：*

*[[公司级可靠性需求基线]{.underline}](https://docs.atrust.sangfor.com/pages/viewpage.action?pageId=122772969)可靠性设计准则：[[公司级可靠性设计准则]{.underline}](https://docs.atrust.sangfor.com/pages/viewpage.action?pageId=167438827)*

### 可测试性设计

1）分析本模块中哪些业务流程是测试难度较高（比如逻辑复杂，容易测试不完全），或者依赖性较高（依赖环境或依赖其它模块，比如依赖特殊硬件，特殊内核版本，比如依赖北研数据面）；

2）对测试难度较高的业务流程给出测试方案，对依赖性较高的业务流程给出解耦方法；

3）给出降低测试复杂度的方法，包括测试方法的改进，以及对本模块设计方面的改进；

可测试性机制设计的目的是降低后续测试的难度，提高测试工作效率和质量，尽早发现问题。为了提升可测试性设计的质量，设计者需要遵守《软件可测试性技术规范》的要求，详情请参考：https://wiki.sangfor.com/pages/viewpage.action?pageId=64519121

### 可调试性设计

分析本模块中哪些业务流程是调试难度较高的流程（比如依赖高并发、大流量、海量数据的流程，比如依赖条件复杂或者苛刻，很难跑到的流程，比如很难分析结果正确性的流程，等等），给出具体调试方法（比如录制数据重放以重现错误，比如利用调试接口诊断某类错误），和降低调试难度的方法（比如记录内部状态，定时进行数据有效性自检，添加校验值自动校验数据正确性，增加调试接口等等）。

分析本模块在客户场景可能出现的故障，给出供技术支持人员诊断错误的方法和工具。

### 可运维性设计

分析本模块为了方便运维而在程序内部设计中作出的安排，可运维性的范围主要包含产品的安装部署、日常运维、巡检、日志管理、故障定位与修复、监控告警、更换扩容、升级补丁等等方面。

### 可扩展性设计

分析本模块后续可能的扩展要求，以及为了方便后续扩展要求实现而采用的机制。

12. ### 可复用性设计

    5.  #### 本模块可采用的公用代码

列出哪些功能点或模块可以使用公用代码。

#### 本模块可产出的公用代码

要考虑产出公用代码，以方便其它产品或版本来重用。

### 系统隐私设计

隐私目标：定义系统不会出现因自身安全而造成敏感信息泄露的目标：系统在收集用户信息时，不会出现私自收集用户不清楚及用户不同意收集的数据；

隐私设计：给出系统在业务传输过程保护方面的设计机制，包含但不限于各类业务的传输敏感信息时，需要使用安全协议传输，以及对内容进行加密传输；此外需要确保系统在收集信息时，应明确为什么需要收集该信息，还应尝试预判未来是否会使用这些信息用于其他事物，并告知用户是否有这样的计划，提供一份易于阅读的条款或条件的摘要。

### 跨平台设计和平台差异处理

*该模块目前及以后可能运行在哪些平台上，如x86，ARM，MIPS等，32位系统还是64位系统，在差异处理上做统一的规范约定。如果对未来的规划不清楚，尽可能设计成跨平台的。跨平台是整个设计过程都要去考虑的事情，包括对外接口设计，数据结构定义，流程设计，函数详细设计等。*

*请在这里描述一下该模块跨平台时有哪些地方需要注意，比如对外通讯接口是否平台无关，数据结构的设计是否能适应32位和64位系统变迁，是否能自适应大小端。这里设计的目的是要用统一的一套代码完成需求，而不要维护多套代码。可以像linux内核那样，把平台无关的流程提炼成公共文件，平台相关的代码写到不同的文件。*

方案风险分析
------------

*对本章描述的方案进行整体风险分析，找到所有可能存在风险的关键环节，对每一个风险，需要给出解决方法（包括消除、规避、缓解、后续跟进等）。对于现阶段无法消除的风险，需要整理为列表，作为后续跟进的事项。*

*对于有风险没有把握的设计，需要有预研结果做保证或者有备用方案。万一此路不通，可以选择备用方案。*

  ----------------------------------- --------------------------------------------------------------
  风险点                              风险预研结果/风险规避措施
  例1：处理速度达100MBPS              根据预研文档《xxx》，可以达到要求
  例2：缓存数据耗用内存可能超过800M   如果超过800M，使用最久未使用淘汰算法将部分数据保存在磁盘上。
                                      
                                      
                                      
  ----------------------------------- --------------------------------------------------------------

5.  数据结构设计
    ============

    13. 配置文件定义
        ------------

> *定义相应的配置文件格式，存储方式，存储路径，各字段代表什么意义。如果是存储在数据库中，需说明数据库名，表名。*

  ----------------- ---------------------- ------------------- ---------------------------------
  **名称**          **作用**               **默认值**          **取值范围**
  *max\_username*   *最大的用户名字长度*   *256*               *字符串，长度范围\[16,1024)*
  *log\_fname*      *日志文件名*           */var/log/ac.txt*   *文件路径名，合法的linux文件名*
                                                               
  ----------------- ---------------------- ------------------- ---------------------------------

> *如果需要在原有配置文件基础上升级，需描述配置的升级流程。*

全局数据结构定义
----------------

*描述全局数据结构设计，须描述每一个字段的名称和作用。全局数据结构包括：*

1.  *在多个软件单元之间传递（比如通过函数参数）的数据结构；*

2.  *全局变量；*

3.  *通讯用的消息；*

+-----------------+-----------------+-----------------+-----------------+
| 结构说明        | *IP组，存放一组服务器的IP |       |                 |
|                 | *               |                 |                 |
+-----------------+-----------------+-----------------+-----------------+
| 结构定义        | *struct         |                 |                 |
|                 | ip\_group{*     |                 |                 |
|                 |                 |                 |                 |
|                 | *size\_t cnt;*  |                 |                 |
|                 |                 |                 |                 |
|                 | *unsigned int   |                 |                 |
|                 | ips\[0\];*      |                 |                 |
|                 |                 |                 |                 |
|                 | *};*            |                 |                 |
+-----------------+-----------------+-----------------+-----------------+
| 字段说明        | 字段名          | 取值范围        | 说明            |
+-----------------+-----------------+-----------------+-----------------+
|                 | *cnt*           | *\[0,4K\]*      | *ips数组的长度，即里面存放 |
|                 |                 |                 | 的整数个数*     |
+-----------------+-----------------+-----------------+-----------------+
|                 | *ips*           | *网络字节序的IP地址数组，数 | *IP地址数组* |
|                 |                 | 组长度为cnt指定长度* |            |
+-----------------+-----------------+-----------------+-----------------+
|                 |                 |                 |                 |
+-----------------+-----------------+-----------------+-----------------+

流程设计
========

描述模块内部各软件单元的组织结构，接口，以及逻辑，算法实现等。这里指的软件单元可以是一个子模块，也可以是C++的一个类。

15. 子模块1/类1/主题1
    -----------------

    15. ### 静态结构

*描述本子模块的职责定义，以及本子模块由哪些更细化的软件单元组成。*

### 处理流程

*描述子模块内部各函数之间的交互逻辑。*

### 关键算法描述

*分析本子模块中哪些算法流程是关键流程，会影响到模块整体的关键性能。有性能（或效果）要求的算法必须在此阐述。每个算法须描述最常见的场景及性能最差的场景，并说明在这两个场景下可达到的性能指标。如果最差场景不能达到性能要求，需分析该场景在用户处出现的几率，以及出现该场景对用户造成的负面影响。*

### 数据结构定义

*描述函数间传递的数据结构或者进程/实体间传递的消息。*

### 函数列表

*描述本模块中需要实现的函数。对于每个函数，需要描述函数的名字，函数功能，参数的类型和作用、取值范围，返回值的类型和作用、取值范围，以及该函数的其它前后置约束条件（比如需要访问的全局变量）。*

+-----------------+-----------------+-----------------+-----------------+
| **函数名**      | **函数功能**    | **参数及返回值** | **说明（包括其它前置/后置约 |
|                 |                 |                 | 束条件，等）**  |
+-----------------+-----------------+-----------------+-----------------+
| *generate*      | *生成测试案例*  | *\[in\]const    |                 |
|                 |                 | value\_t\*      |                 |
|                 |                 | val：输入模板，必须为有效的 |     |
|                 |                 | value\_t；*     |                 |
|                 |                 |                 |                 |
|                 |                 | *\[out\]vector\ |                 |
|                 |                 | <value\_t\*\>\* |                 |
|                 |                 | ptests：保存输出的案例， |        |
|                 |                 | 调用者负责释放。约束条件：pt |    |
|                 |                 | ests            |                 |
|                 |                 | &&              |                 |
|                 |                 | ptests-\>size() |                 |
|                 |                 | == 0*           |                 |
+-----------------+-----------------+-----------------+-----------------+
|                 |                 |                 |                 |
+-----------------+-----------------+-----------------+-----------------+

### 设计要点检视

*本表格作为一个设计要点的检查列表，帮助设计人员回顾相关要点具体是怎么考虑的，是否已经满足需要。相关要点必须体现在本章的各个子章节中（比如结构、流程、函数列表等），表格填写内容仅仅作为一个总结。*

  ----------------------- --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  **可维护/可调试措施**   *分析开发过程可能遇到的调试难题，描述设计中所提供的解决方案。需要说明针对这些调试难题，给开发调试、维护人员具体提供了哪些排错手段。怎么帮助开发、维护人员更快定位，排除错误。*
  **可测试性**            *分析测试过程可能遇到的测试难题，描述设计中所提供的解决方案。需要说明针对这些测试难题，给测试人员提供了哪些测试支持。怎么保证更易于测试本模块。*
  **自动化测试支持**      *分析该子模块如何进行自动化测试，怎么保证自动化测试能够更好验证本子模块/类的功能。*
  **可扩展性**            *分析将来版本最有可能发生扩展的特性，说明针对这些扩展保留的设计支持；*
  **稳定性保证措施**      *分析软件运行过程中，该子模块容易发生哪些类型异常，给出异常检测，异常恢复措施*
  **工作量估算**          *对实现本节设计内容需要的工作量进行估算，按人天算。设计需要消除风险，让风险可控。风险可控的典型标志就是可以较为准确的估算出工作量*
  ----------------------- --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

子模块2/类2/主题2
-----------------

*按上面格式模板描述下一个子模块或者类*

7.  总结
    ====

    17. 关联分析
        --------

对老模板/老版本/相关联产品的影响，请做分析。可以和对应的模块责任人架构师做交流

遗留问题解决
------------

说明在总体设计过程中尚未解决的各个问题的解决方案。

说明在上一个版本未解决的应该在本模块中解决的各个遗留问题的解决方案；

业务逻辑相关的测试用例
======================

此部分内容在详细设计模板中也有。如果一个模块概设、详设都做，此章节在其中一个文档中完成即可。

设计完成后，鉴于测试人员可能对模块设计的内部逻辑、流程、数据流向不清楚，用例质量会得不到保证。

为了提高测试用例的质量，尽早尽全地覆盖到关键实现，要求开发人员撰写内部逻辑、流程、数据流向相关的测试用例。

如果对测试用例的设计不太清楚，至少要描述出测试步骤和验证点。

此部分可以放到编码结束后补充填写。

如果给测试人员讲的很清楚，测试版本经理认为不用写，可以不写。

9.  变更控制
    ========

    19. 变更列表
        --------

*在编码过程中，可能会有一些设计不合理的地方，需要对原设计做一些调整，需要在这里说明变更的章节、内容、原因，并对变更进行评审确认（至少需要经过版本经理/开发经理的确认）。此章节在编码完对设计文档更新后进行评审确认。*

*需求变更引起的设计变更，也在下面加以说明，并对设计变更的结果进行部门内部评审。*

  -------------- -------------- -------------- ------------------------------------------------------------------------------------------
  **变更章节**   **变更内容**   **变更原因**   **变更对对老功能、原有设计的影响**
                                               考虑完全这些影响，要和开发经理、架构师、设计人员、老版本的开发人员进行交流，并最后评审。
                                               
                                               
                                               
                                               
  -------------- -------------- -------------- ------------------------------------------------------------------------------------------
