# 通用单元测试 Checklist

> 本文档提供语言无关的单元测试审查维度框架
> 适用于没有特定 checklist 的编程语言

## 审查维度说明

本文档提供**测试代码的通用审查维度和框架**。基于这些维度对测试进行深度分析，识别问题和改进空间。这些维度适用于大多数编程语言和测试框架。

---

## 维度 1: 测试结构

### 1.1 AAA 模式遵循

**维度说明**: 测试是否遵循 Arrange-Act-Assert 模式

**审查要点**:
- [ ] 测试代码是否清晰划分为三个阶段
- [ ] Arrange 阶段是否准备完整的测试数据
- [ ] Act 阶段是否只执行被测试的单一操作
- [ ] Assert 阶段是否验证所有关键行为

**深度分析方向**:
- 测试结构是否清晰易读
- 是否有混淆 Arrange/Act/Assert 边界的代码
- 是否有缺失的 Assert（只调用不验证）

---

### 1.2 测试命名规范

**维度说明**: 测试函数/方法命名是否清晰描述测试意图

**审查要点**:
- [ ] 测试名称是否描述被测试的功能
- [ ] 测试名称是否描述测试场景
- [ ] 测试名称是否描述预期结果
- [ ] 是否避免使用模糊的测试名称

**深度分析方向**:
- 测试失败时，名称是否能快速定位问题
- 是否需要查看测试代码才能理解测试目的

---

### 1.3 测试文件组织

**维度说明**: 测试文件和目录结构是否合理

**审查要点**:
- [ ] 测试文件是否与源文件分离
- [ ] 测试目录结构是否镜像源代码
- [ ] 测试文件命名是否符合约定

---

## 维度 2: 测试覆盖

### 2.1 快乐路径覆盖

**维度说明**: 正常场景是否都有测试覆盖

**审查要点**:
- [ ] 主要功能路径是否都有测试
- [ ] 核心业务逻辑是否被测试
- [ ] 常见使用场景是否覆盖
- [ ] 公共 API 是否被测试

**深度分析方向**:
- 识别未测试的核心功能
- 评估缺失测试的风险等级

---

### 2.2 边界条件测试

**维度说明**: 边界值、空值、极值等特殊场景是否测试

**审查要点**:
- [ ] null/nil/None/undefined 处理是否测试
- [ ] 零值、负值是否测试
- [ ] 最大/最小边界值是否测试
- [ ] 空集合/空数组/空字符串是否测试
- [ ] 单元素集合是否测试

**深度分析方向**:
- 识别可能导致问题的边界场景
- 边界测试是否充分

---

### 2.3 错误场景覆盖

**维度说明**: 异常、错误输入是否被测试

**审查要点**:
- [ ] 异常/错误抛出是否被测试
- [ ] 错误码/错误返回是否被测试
- [ ] 无效输入是否被测试
- [ ] 失败场景是否被测试
- [ ] 资源不可用是否被测试

**深度分析方向**:
- 错误处理逻辑是否正确
- 错误类型是否准确
- 错误信息是否有意义

---

## 维度 3: 测试隔离

### 3.1 测试独立性

**维度说明**: 测试之间是否相互独立，无共享状态

**审查要点**:
- [ ] 测试执行顺序是否影响结果
- [ ] 是否避免测试之间的数据依赖
- [ ] 是否避免使用静态/全局状态
- [ ] 每个测试是否清理自己的状态

**深度分析方向**:
- 识别有依赖关系的测试
- 并行执行测试的可行性

---

### 3.2 资源清理

**维度说明**: 测试资源是否正确清理

**审查要点**:
- [ ] 临时文件是否删除
- [ ] 数据库连接是否关闭
- [ ] 网络连接是否关闭
- [ ] Mock 是否清理
- [ ] 环境变量是否恢复

---

## 维度 4: 断言质量

### 4.1 断言完整性

**维度说明**: 断言是否验证所有关键行为

**审查要点**:
- [ ] 是否验证返回值
- [ ] 是否验证副作用（如状态变化、数据库写入）
- [ ] 是否验证异常（在错误场景）
- [ ] 是否验证输出（stdout/stderr）
- [ ] 是否避免过弱断言（如 assert True）

**深度分析方向**:
- 识别缺失的断言
- 识别无意义的断言

---

### 4.2 断言准确性

**维度说明**: 断言是否准确验证预期行为

**审查要点**:
- [ ] 断言条件是否准确反映业务需求
- [ ] 是否避免过于宽泛的断言
- [ ] 是否使用精确匹配（避免模糊匹配）
- [ ] 断言失败信息是否清晰

**深度分析方向**:
- 断言是否可能误报
- 断言是否可能漏报

---

### 4.3 断言可读性

**维度说明**: 断言是否易于理解

**审查要点**:
- [ ] 断言语义是否清晰
- [ ] 复杂断言是否有注释说明
- [ ] 自定义断言是否有清晰命名

---

## 维度 5: Mock 和隔离

### 5.1 外部依赖隔离

**维度说明**: 是否正确隔离外部依赖

**审查要点**:
- [ ] 数据库操作是否被隔离
- [ ] 网络 API 调用是否被隔离
- [ ] 文件系统操作是否被隔离
- [ ] 时间相关的函数是否被隔离
- [ ] 系统调用是否被隔离

**深度分析方向**:
- Mock 是否隔离了真正的外部依赖
- Mock 行为是否符合真实场景

---

### 5.2 Mock 使用合理性

**维度说明**: Mock 的使用是否合理

**审查要点**:
- [ ] 是否避免过度 mock
- [ ] 是否避免测试 mock 本身
- [ ] Mock 返回值是否符合真实场景
- [ ] 是否验证 mock 调用（如需要）
- [ ] Mock 是否在测试后清理

**深度分析方向**:
- 识别过度 mock 的测试
- 识别缺少 mock 的集成测试

---

## 维度 6: 测试数据管理

### 6.1 测试数据组织

**维度说明**: 测试数据是否易于管理

**审查要点**:
- [ ] 重复的测试数据是否提取
- [ ] 是否使用工厂/构建器创建测试数据
- [ ] 测试数据是否与测试逻辑分离
- [ ] 复杂测试数据是否使用数据文件

---

### 6.2 测试数据多样性

**维度说明**: 测试数据是否覆盖多样场景

**审查要点**:
- [ ] 是否使用参数化测试
- [ ] 测试数据是否覆盖边界组合
- [ ] 是否测试等价类划分
- [ ] 是否测试典型值和边界值

---

## 维度 7: 测试可维护性

### 7.1 测试代码质量

**维度说明**: 测试代码本身是否易于维护

**审查要点**:
- [ ] 测试代码是否遵循编码规范
- [ ] 是否避免测试代码重复
- [ ] 测试是否有清晰的文档/注释
- [ ] 复杂测试是否有说明
- [ ] 测试辅助函数是否提取

**深度分析方向**:
- 测试代码的复杂度
- 测试的可读性

---

### 7.2 测试执行效率

**维度说明**: 测试执行时间是否合理

**审查要点**:
- [ ] 慢速测试是否识别
- [ ] 是否避免不必要的 I/O 操作
- [ ] 是否使用 mock 加速测试
- [ ] 是否支持并行执行
- [ ] 测试套件总时间是否合理

**深度分析方向**:
- 识别性能瓶颈测试
- 优化建议

---

### 7.3 测试可读性

**维度说明**: 测试是否易于理解

**审查要点**:
- [ ] 测试意图是否清晰
- [ ] 测试逻辑是否简洁
- [ ] 变量命名是否有意义
- [ ] 是否避免过度抽象

---

## 维度 8: 异步测试

### 8.1 异步操作测试

**维度说明**: 异步操作是否被正确测试

**审查要点**:
- [ ] 异步调用是否正确等待
- [ ] 异步异常是否被捕获和测试
- [ ] 并发操作是否被测试
- [ ] 竞态条件是否被考虑

---

### 8.2 超时处理

**维度说明**: 超时是否被正确处理

**审查要点**:
- [ ] 测试超时是否设置
- [ ] 超时场景是否被测试
- [ ] 超时后的清理是否正确

---

## 维度 9: 测试覆盖率

### 9.1 覆盖率目标

**维度说明**: 测试覆盖率是否达到 80% 以上

**审查要点**:
- [ ] 语句覆盖率是否 ≥ 80%
- [ ] 分支覆盖率是否 ≥ 80%
- [ ] 函数覆盖率是否 ≥ 80%
- [ ] 行覆盖率是否 ≥ 80%

**深度分析方向**:
- 识别关键路径的测试覆盖缺口
- 低覆盖代码的风险评估

---

### 9.2 覆盖率质量

**维度说明**: 覆盖率是否真实反映测试质量

**审查要点**:
- [ ] 是否避免为了覆盖率而编写无意义测试
- [ ] 未覆盖代码是否有合理理由（如死代码）
- [ ] 覆盖率报告是否定期生成和审查
- [ ] 覆盖率趋势是否监控

---

### 9.3 覆盖率配置

**维度说明**: 覆盖率工具是否正确配置

**审查要点**:
- [ ] 覆盖率工具是否正确配置
- [ ] 覆盖率排除规则是否合理
- [ ] 是否配置了覆盖率阈值失败
- [ ] 覆盖率报告格式是否合适

---

## 维度 10: 安全测试

### 10.1 输入验证测试

**维度说明**: 输入验证是否被测试

**审查要点**:
- [ ] 恶意输入是否被测试
- [ ] SQL 注入是否被测试
- [ ] XSS 攻击是否被测试
- [ ] 命令注入是否被测试

---

### 10.2 敏感数据测试

**维度说明**: 敏感数据处理是否被测试

**审查要点**:
- [ ] 密码是否不记录在日志
- [ ] 敏感数据是否不暴露在错误消息
- [ ] 加密数据是否被正确处理

---

## 维度 11: 性能测试

### 11.1 性能关键路径

**维度说明**: 性能关键代码是否有测试

**审查要点**:
- [ ] 算法复杂度是否被测试
- [ ] 大数据量是否被测试
- [ ] 性能退化是否被检测

---

### 11.2 资源使用

**维度说明**: 资源使用是否被测试

**审查要点**:
- [ ] 内存泄漏是否被测试
- [ ] 文件句柄泄漏是否被测试
- [ ] 连接泄漏是否被测试

---

## 维度 12: 集成测试

### 12.1 API 测试

**维度说明**: API 端点是否被测试

**审查要点**:
- [ ] 请求/响应是否被验证
- [ ] 状态码是否被验证
- [ ] 错误响应是否被测试
- [ ] 内容类型是否被验证

---

### 12.2 数据库测试

**维度说明**: 数据库操作是否被测试

**审查要点**:
- [ ] CRUD 操作是否被测试
- [ ] 事务是否被测试
- [ ] 数据库约束是否被验证
- [ ] 数据库迁移是否被测试

---

## 质量评估矩阵

| 维度 | 权重 | 评估标准 | 评分 (1-5) |
|-----|------|---------|-----------|
| 测试结构 | 10% | AAA模式清晰、命名规范、组织合理 | |
| 测试覆盖 | 25% | 快乐/边界/错误场景完整 | |
| 测试隔离 | 15% | 独立无依赖、资源清理完整 | |
| 断言质量 | 15% | 完整、准确、可读 | |
| Mock 合理性 | 10% | 正确隔离、不过度 | |
| 测试数据管理 | 5% | 组织良好、多样性 | |
| 可维护性 | 10% | 代码清晰、执行高效 | |
| 覆盖率 | 10% | ≥80% | |

**总分**: ___ / 5

**质量等级**:
- 4.5-5.0: 优秀 - 测试质量卓越
- 4.0-4.4: 良好 - 测试质量优秀，有小幅改进空间
- 3.5-3.9: 合格 - 测试质量达标，有明显改进空间
- 3.0-3.4: 需改进 - 测试存在较多问题
- < 3.0: 不合格 - 测试质量严重不足

---

## 审查结果汇总模板

```markdown
# 测试质量审查报告（通用）

## 审查概述
- 编程语言: [语言名称]
- 测试框架: [框架名称]
- 审查时间: YYYY-MM-DD HH:MM
- 审查测试文件: X个
- 审查测试用例: Y个

## 审查框架
基于 `templates/testing/testing-checklist-generic.md` 提供的通用审查维度：
1. 测试结构 (AAA模式、命名规范、文件组织)
2. 测试覆盖 (快乐路径、边界条件、错误场景)
3. 测试隔离 (独立性、资源清理)
4. 断言质量 (完整性、准确性、可读性)
5. Mock 和隔离 (外部依赖隔离、使用合理性)
6. 测试数据管理 (组织、多样性)
7. 测试可维护性 (代码质量、执行效率、可读性)
8. 异步测试 (异步操作、超时处理)
9. 覆盖率 (目标、质量、配置)
10. 安全测试 (输入验证、敏感数据)
11. 性能测试 (性能关键路径、资源使用)
12. 集成测试 (API、数据库)

## 各维度深度审查

### 1. 测试结构维度
**分析结果**: ___
**问题列表**: ___
**改进建议**: ___

### 2. 测试覆盖维度
**分析结果**: ___
... [其他维度]

## 覆盖率分析
- 语句覆盖率: XX%
- 分支覆盖率: XX%
- 函数覆盖率: XX%
- 未覆盖关键路径: [列表]

## 总体评估与优先级
- 质量等级: ___
- 总分: X.X / 5.0
- 高优先级问题: [列表]
- 中优先级问题: [列表]
- 低优先级问题: [列表]

## 改进计划
1. [ ] [具体行动项]
2. [ ] [具体行动项]
3. [ ] [具体行动项]
```
