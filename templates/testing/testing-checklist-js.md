# JavaScript/TypeScript 单元测试 Checklist

> 本文档提供 JavaScript/TypeScript 单元测试的审查维度框架
> 基于 Jest、Vitest、Testing Library 等最佳实践

## 审查维度说明

本文档不是简单的检查表，而是提供**测试代码的审查维度和框架**。基于这些维度对测试进行深度分析，识别问题和改进空间。

**相关 Skill**: `javascript-typescript:javascript-testing-patterns`

---

## 维度 1: 测试结构

### 1.1 AAA 模式遵循

**维度说明**: 测试是否遵循 Arrange-Act-Assert 模式

**审查要点**:
- [ ] 测试代码是否清晰划分为三个阶段
- [ ] Arrange 阶段是否准备完整的测试数据
- [ ] Act 阶段是否只执行被测试的单一操作
- [ ] Assert 阶段是否验证所有关键行为

**深度分析方向**:
- 测试结构是否清晰易读
- 是否有混淆 Arrange/Act/Assert 边界的代码
- 是否有缺失的 Assert（只调用不验证）

**相关模式**: javascript-testing-patterns - "Test Structure (AAA Pattern)"

---

### 1.2 测试命名规范

**维度说明**: 测试函数/方法命名是否清晰描述测试意图

**审查要点**:
- [ ] 测试名称是否遵循 `should/doX_whenY` 模式
- [ ] 测试名称是否能独立表达测试意图
- [ ] 是否避免使用模糊的测试名称（如 test1, it_works）

**深度分析方向**:
- 测试失败时，名称是否能快速定位问题
- 是否需要查看测试代码才能理解测试目的

---

## 维度 2: 测试覆盖

### 2.1 快乐路径覆盖

**维度说明**: 正常场景是否都有测试覆盖

**审查要点**:
- [ ] 主要功能路径是否都有测试
- [ ] 核心业务逻辑是否被测试
- [ ] 常见使用场景是否覆盖

**深度分析方向**:
- 识别未测试的核心功能
- 评估缺失测试的风险等级

---

### 2.2 边界条件测试

**维度说明**: 边界值、空值、极值等特殊场景是否测试

**审查要点**:
- [ ] null/undefined 处理是否测试
- [ ] 零值、负值是否测试
- [ ] 最大/最小边界值是否测试
- [ ] 空数组/空对象是否测试

**深度分析方向**:
- 识别可能导致问题的边界场景
- 边界测试是否充分

---

### 2.3 错误场景覆盖

**维度说明**: 异常、错误输入是否被测试

**审查要点**:
- [ ] Promise rejection 是否被测试
- [ ] Error throw 是否被测试
- [ ] 错误输入是否被测试
- [ ] 失败场景是否被测试

**深度分析方向**:
- 错误处理逻辑是否正确
- 错误类型是否准确
- 错误信息是否有意义

---

## 维度 3: Testing Library 使用

### 3.1 用户行为导向

**维度说明**: 是否测试用户行为而非实现细节

**审查要点**:
- [ ] 是否测试用户可见的行为
- [ ] 是否避免测试内部状态
- [ ] 是否避免测试 className
- [ ] 是否避免测试组件方法

**深度分析方向**:
- 测试是否过于关注实现细节
- 测试在重构时的脆弱性

**相关模式**: javascript-testing-patterns - "Testing Library Patterns"

---

### 3.2 查询策略

**维度说明**: 是否使用正确的查询策略

**审查要点**:
- [ ] 优先使用 getByRole（用户可见）
- [ ] 其次使用 getByLabelText、getByPlaceholderText
- [ ] 谨慎使用 getByTestId（最后选择）
- [ ] 避免使用 queryBy（用于断言不存在）

**深度分析方向**:
- 查询选择器是否符合可访问性
- 测试是否在 UI 变更时保持稳定

---

### 3.3 等待策略

**维度说明**: 异步操作是否正确等待

**审查要点**:
- [ ] 是否使用 waitFor 而非硬编码延迟
- [ ] 是否使用 findBy 系列查询
- [ ] 是否合理设置超时时间
- [ ] 是否避免 wait() 无参数等待

**深度分析方向**:
- 测试是否有不稳定的等待问题
- 测试是否在不同环境下稳定执行

---

## 维度 4: Mock 和隔离

### 4.1 Jest Mocks 使用

**维度说明**: 是否正确使用 Jest mock 功能

**审查要点**:
- [ ] 是否使用 jest.fn() 创建 mock 函数
- [ ] 是否使用 jest.spyOn() 监控函数调用
- [ ] 是否使用 jest.mock() 模拟模块
- [ ] Mock 是否在测试后清理

**深度分析方向**:
- Mock 是否隔离了真正的依赖
- Mock 返回值是否符合真实场景

**相关模式**: javascript-testing-patterns - "Mocking with Jest"

---

### 4.2 Mock 使用合理性

**维度说明**: Mock 的使用是否合理

**审查要点**:
- [ ] 是否避免过度 mock
- [ ] Mock 返回值是否符合真实场景
- [ ] 是否验证 mock 调用（expect().toHaveBeenCalled()）
- [ ] 是否使用 toHaveBeenCalledWith 验证参数

**深度分析方向**:
- 识别过度 mock 的测试
- 识别缺少 mock 的集成测试

---

### 4.3 模块 Mock

**维度说明**: 模块 mock 是否正确

**审查要点**:
- [ ] jest.mock 路径是否正确
- [ ] Mock 实现是否合理
- [ ] 是否使用 __mocks__ 目录
- [ ] 是否使用 doMock 动态 mock

---

## 维度 5: 快照测试

### 5.1 快照测试合理性

**维度说明**: 快照测试是否用于合适的场景

**审查要点**:
- [ ] 快照是否用于 UI 组件
- [ ] 是否避免过度依赖快照
- [ ] 快照是否定期审查和更新
- [ ] 快照失败是否被正确处理

**深度分析方向**:
- 快照测试是否有意义
- 快照更新是否经过审查

**相关模式**: javascript-testing-patterns - "Snapshot Testing"

---

### 5.2 快照质量

**维度说明**: 快照内容是否有价值

**审查要点**:
- [ ] 快照是否包含关键信息
- [ ] 是否使用内联快照（{inline: true}）
- [ ] 是否避免快照过多动态内容

---

## 维度 6: React 组件测试

### 6.1 组件渲染测试

**维度说明**: 组件是否被正确测试

**审查要点**:
- [ ] 是否测试组件渲染
- [ ] 是否测试 props 传递
- [ ] 是否测试条件渲染
- [ ] 是否测试列表渲染

**深度分析方向**:
- 组件测试覆盖是否完整
- 测试是否关注用户可见行为

**相关模式**: javascript-testing-patterns - "React Testing Patterns"

---

### 6.2 用户交互测试

**维度说明**: 用户交互是否被正确测试

**审查要点**:
- [ ] 是否使用 fireEvent 或 userEvent
- [ ] 是否测试点击、输入等交互
- [ ] 是否测试交互后的状态变化
- [ ] 是否测试表单提交

**深度分析方向**:
- 交互测试是否模拟真实用户行为
- 是否使用 userEvent 优先（更真实）

---

### 6.3 Hooks 测试

**维度说明**: 自定义 Hooks 是否被正确测试

**审查要点**:
- [ ] 是否使用 @testing-library/react-hooks
- [ ] 是否测试 hooks 的返回值
- [ ] 是否测试 hooks 的状态更新
- [ ] 是否测试 hooks 的清理

**相关模式**: javascript-testing-patterns - "Testing Hooks"

---

## 维度 7: 异步测试

### 7.1 Promise 测试

**维度说明**: 异步操作是否被正确测试

**审查要点**:
- [ ] 是否正确使用 async/await
- [ ] Promise rejection 是否被测试
- [ ] 是否使用 rejects/toResolve 匹配器
- [ ] 是否避免测试完成前的断言

**深度分析方向**:
- 异步测试是否稳定
- 是否有竞态条件

---

### 7.2 Timer 测试

**维度说明**: 定时器相关代码是否被正确测试

**审查要点**:
- [ ] 是否使用 jest.useFakeTimers()
- [ ] 是否使用 jest.advanceTimersByTime()
- [ ] 测试后是否恢复真实定时器
- [ ] 是否正确处理 setTimeout/setInterval

---

### 7.3 异步回调测试

**维度说明**: 异步回调是否被正确测试

**审查要点**:
- [ ] 回调中的断言是否被执行
- [ ] 是否使用 done 参数（不推荐）
- [ ] 是否返回 Promise（推荐）

---

## 维度 8: 测试隔离

### 8.1 测试独立性

**维度说明**: 测试之间是否相互独立

**审查要点**:
- [ ] 测试执行顺序是否影响结果
- [ ] 是否避免测试之间的数据依赖
- [ ] 每个测试是否清理自己的状态
- [ ] beforeEach/afterEach 是否正确使用

**深度分析方向**:
- 识别有依赖关系的测试
- 并行执行测试的可行性

---

### 8.2 Mock 隔离

**维度说明**: Mock 是否正确隔离

**审查要点**:
- [ ] beforeEach 中是否清理 mock
- [ ] 是否使用 jest.clearAllMocks()
- [ ] 是否使用 jest.resetAllMocks()

---

## 维度 9: 测试断言

### 9.1 断言完整性

**维度说明**: 断言是否验证所有关键行为

**审查要点**:
- [ ] 是否验证返回值
- [ ] 是否验证副作用（如状态变化、DOM 更新）
- [ ] 是否验证异常（在错误场景）
- [ ] 是否避免过弱断言（如 expect(true).toBe(true)）

**深度分析方向**:
- 识别缺失的断言
- 识别无意义的断言

---

### 9.2 匹配器选择

**维度说明**: 是否使用合适的匹配器

**审查要点**:
- [ ] 原始值使用 toBe/toEqual
- [ ] 对象使用 toEqual（深度比较）
- [ ] 数组使用 toContain/toHaveLength
- [ ] 字符串使用 toMatch/toContain
- [ ] 数字使用 toBeGreaterThan/toBeLessThan
- [ ] 浮点数使用 toBeCloseTo

---

### 9.3 自定义匹配器

**维度说明**: 是否合理使用自定义匹配器

**审查要点**:
- [ ] 复杂断言是否封装为自定义匹配器
- [ ] 自定义匹配器是否有清晰的名称
- [ ] 自定义匹配器是否有良好的错误消息

---

## 维度 10: 测试覆盖率

### 10.1 覆盖率目标

**维度说明**: 测试覆盖率是否达到 80% 以上

**审查要点**:
- [ ] 语句覆盖率是否 ≥ 80%
- [ ] 分支覆盖率是否 ≥ 80%
- [ ] 函数覆盖率是否 ≥ 80%
- [ ] 行覆盖率是否 ≥ 80%

**深度分析方向**:
- 识别关键路径的测试覆盖缺口
- 低覆盖代码的风险评估

---

### 10.2 覆盖率配置

**维度说明**: 覆盖率工具是否正确配置

**审查要点**:
- [ ] collectCoverageFrom 是否正确配置
- [ ] 覆盖率排除规则是否合理
- [ ] 是否配置了覆盖率阈值失败
- [ ] 覆盖率 reporters 是否配置

---

### 10.3 覆盖率质量

**维度说明**: 覆盖率是否真实反映测试质量

**审查要点**:
- [ ] 是否避免为了覆盖率而编写无意义测试
- [ ] 未覆盖代码是否有合理理由
- [ ] 覆盖率报告是否定期审查

---

## 维度 11: 测试可维护性

### 11.1 测试代码质量

**维度说明**: 测试代码本身是否易于维护

**审查要点**:
- [ ] 测试代码是否遵循编码规范
- [ ] 是否避免测试代码重复
- [ ] 测试是否有清晰的注释
- [ ] 复杂测试是否有说明

**深度分析方向**:
- 测试代码的复杂度
- 测试的可读性

---

### 11.2 测试执行效率

**维度说明**: 测试执行时间是否合理

**审查要点**:
- [ ] 慢速测试是否识别并优化
- [ ] 是否避免不必要的 DOM 操作
- [ ] 是否使用 mock 加速测试
- [ ] 是否使用 maxWorkers 并行执行

---

### 11.3 测试组织结构

**维度说明**: 测试文件和目录结构是否合理

**审查要点**:
- [ ] 测试文件是否与源文件并列（*.test.ts）
- [ ] 或使用 __tests__ 目录
- [ ] 测试目录结构是否镜像源代码
- [ ] 相关测试是否组织在一起

---

## 维度 12: 测试配置

### 12.1 Jest/Vitest 配置

**维度说明**: 测试框架配置是否合理

**审查要点**:
- [ ] testMatch 是否正确配置
- [ ] testEnvironment 是否正确设置
- [ ] setupFilesAfterEnv 是否配置
- [ ] moduleNameMapper 是否配置路径别名

---

### 12.2 测试环境配置

**维度说明**: 测试环境是否正确配置

**审查要点**:
- [ ] 环境变量是否正确设置
- [ ] 是否使用测试专用配置
- [ ] 是否避免使用生产配置

---

## 维度 13: TypeScript 特定

### 13.1 类型安全测试

**维度说明**: 是否利用 TypeScript 类型系统

**审查要点**:
- [ ] 测试代码是否有完整类型注解
- [ ] 是否使用 as const 提高类型推断
- [ ] Mock 类型是否正确
- [ ] 是否使用 typeof 提取类型

---

### 13.2 类型测试

**维度说明**: 复杂类型是否被测试

**审查要点**:
- [ ] 是否使用 expectTypeOf 测试类型
- [ ] 联合类型是否被测试
- [ ] 泛型类型是否被测试

---

## 维度 14: 前端特定

### 14.1 表单测试

**维度说明**: 表单是否被正确测试

**审查要点**:
- [ ] 是否测试表单验证
- [ ] 是否测试表单提交
- [ ] 是否测试表单重置
- [ ] 是否测试错误显示

---

### 14.2 路由测试

**维度说明**: 路由是否被正确测试

**审查要点**:
- [ ] 是否使用 MemoryRouter 测试路由
- [ ] 是否测试导航
- [ ] 是否测试路由参数
- [ ] 是否测试路由保护

---

### 14.3 状态管理测试

**维度说明**: 状态管理是否被正确测试

**审查要点**:
- [ ] Redux store 是否被测试
- [ ] Context 是否被测试
- [ ] 状态更新是否被测试
- [ ] 状态选择器是否被测试

---

## 维度 15: 集成测试

### 15.1 API 集成测试

**维度说明**: API 调用是否被正确测试

**审查要点**:
- [ ] 是否使用 MSW (Mock Service Worker)
- [ ] API 请求是否被 mock
- [ ] API 响应是否被测试
- [ ] 错误响应是否被测试

**相关模式**: javascript-testing-patterns - "API Integration Tests"

---

### 15.2 数据库集成测试

**维度说明**: 数据库操作是否被正确测试

**审查要点**:
- [ ] 是否使用测试数据库
- [ ] 事务是否正确回滚
- [ ] 测试数据是否正确清理

---

## 质量评估矩阵

| 维度 | 权重 | 评估标准 | 评分 (1-5) |
|-----|------|---------|-----------|
| 测试结构 | 10% | AAA模式清晰、命名规范 | |
| 测试覆盖 | 20% | 快乐/边界/错误场景完整 | |
| Testing Library | 15% | 用户行为导向、正确查询 | |
| Mock 隔离 | 15% | 正确隔离、不过度 | |
| 测试隔离 | 10% | 独立无依赖 | |
| 断言质量 | 10% | 完整、准确 | |
| 覆盖率 | 10% | ≥80% | |
| 可维护性 | 10% | 代码清晰、高效 | |

**总分**: ___ / 5

**质量等级**:
- 4.5-5.0: 优秀 - 测试质量卓越
- 4.0-4.4: 良好 - 测试质量优秀，有小幅改进空间
- 3.5-3.9: 合格 - 测试质量达标，有明显改进空间
- 3.0-3.4: 需改进 - 测试存在较多问题
- < 3.0: 不合格 - 测试质量严重不足

---

## 与 Skill 的集成映射

| 维度 | javascript-testing-patterns Skill | 关键模式 |
|-----|-----------------------------------|---------|
| 测试结构 | ✅ | AAA Pattern |
| Testing Library | ✅ | Testing Library Patterns |
| Mock 隔离 | ✅ | Mocking with Jest |
| 快照测试 | ✅ | Snapshot Testing |
| React 组件 | ✅ | React Testing Patterns |
| Hooks 测试 | ✅ | Testing Hooks |
| 异步测试 | ✅ | Async Testing |
| 集成测试 | ✅ | API Integration Tests |

---

## 审查结果汇总模板

```markdown
# JavaScript/TypeScript 测试质量审查报告

## 审查概述
- 编程语言: JavaScript / TypeScript
- 测试框架: Jest / Vitest
- 审查时间: YYYY-MM-DD HH:MM
- 审查测试文件: X个
- 审查测试用例: Y个

## 审查框架
基于 `templates/testing/testing-checklist-js.md` 提供的审查维度：
1. 测试结构 (AAA模式、命名规范)
2. 测试覆盖 (快乐路径、边界条件、错误场景)
3. Testing Library (用户行为导向、查询策略、等待策略)
4. Mock 和隔离 (Jest mocks、使用合理性、模块mock)
5. 快照测试 (合理性、质量)
6. React 组件 (渲染、交互、Hooks)
7. 异步测试 (Promise、Timer、回调)
8. 测试隔离 (独立性、Mock隔离)
9. 断言质量 (完整性、匹配器选择)
10. 覆盖率 (语句、分支、函数、行)
11. 可维护性 (代码质量、执行效率、组织结构)
12. 测试配置 (Jest/Vitest配置、环境配置)
13. TypeScript 特定 (类型安全、类型测试)
14. 前端特定 (表单、路由、状态管理)
15. 集成测试 (API、数据库)

## 各维度深度审查

### 1. 测试结构维度
**分析结果**: ___
**集成 Skill**: javascript-testing-patterns (AAA Pattern)
**问题列表**: ___
**改进建议**: ___

### 2. 测试覆盖维度
**分析结果**: ___
... [其他维度]

## 覆盖率分析
- 语句覆盖率: XX%
- 分支覆盖率: XX%
- 函数覆盖率: XX%
- 行覆盖率: XX%
- 未覆盖关键路径: [列表]

## 总体评估与优先级
- 质量等级: ___
- 总分: X.X / 5.0
- 高优先级问题: [列表]
- 中优先级问题: [列表]
- 低优先级问题: [列表]

## 改进计划
1. [ ] [具体行动项]
2. [ ] [具体行动项]
3. [ ] [具体行动项]

## Skill 集成记录
- 调用的 Skills: javascript-typescript:javascript-testing-patterns
- 获取的最佳实践: [总结]
```
