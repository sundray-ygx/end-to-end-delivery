# Java 单元测试 Checklist

> 本文档提供 Java 单元测试的审查维度框架
> 基于 JUnit、Mockito、AssertJ 等最佳实践

## 审查维度说明

本文档不是简单的检查表，而是提供**测试代码的审查维度和框架**。基于这些维度对测试进行深度分析，识别问题和改进空间。

---

## 维度 1: 测试结构

### 1.1 AAA 模式遵循

**维度说明**: 测试是否遵循 Arrange-Act-Assert 模式

**审查要点**:
- [ ] 测试代码是否清晰划分为三个阶段
- [ ] given/when/then 注解是否正确使用
- [ ] Arrange 阶段是否准备完整的测试数据
- [ ] Act 阶段是否只执行被测试的单一操作
- [ ] Assert 阶段是否验证所有关键行为

---

### 1.2 测试命名规范

**维度说明**: 测试方法命名是否清晰描述测试意图

**审查要点**:
- [ ] 测试名称是否遵循 should[ExpectedBehavior]When[StateUnderTest] 模式
- [ ] @DisplayName 是否提供描述性名称
- [ ] 测试名称是否能独立表达测试意图

---

## 维度 2: 测试覆盖

### 2.1 快乐路径覆盖

**维度说明**: 正常场景是否都有测试覆盖

**审查要点**:
- [ ] 主要功能路径是否都有测试
- [ ] 核心业务逻辑是否被测试
- [ ] 公共 API 是否被测试

---

### 2.2 边界条件测试

**维度说明**: 边界值、空值、极值等特殊场景是否测试

**审查要点**:
- [ ] null 处理是否测试
- [ ] 空集合是否测试
- [ ] 零值、负值是否测试
- [ ] 最大/最小边界值是否测试

---

### 2.3 错误场景覆盖

**维度说明**: 异常、错误输入是否被测试

**审查要点**:
- [ ] 异常抛出是否被测试 (assertThrows)
- [ ] 错误输入是否被测试
- [ ] 失败场景是否被测试
- [ ] 异常类型是否被验证

---

## 维度 3: JUnit 特性

### 3.1 断言使用

**维度说明**: 是否使用正确的断言方法

**审查要点**:
- [ ] 是否使用 AssertJ 而非 JUnit 断言
- [ ] 断言消息是否有描述性
- [ ] 是否避免过弱断言

---

### 3.2 参数化测试

**维度说明**: 是否使用 @ParameterizedTest 减少重复

**审查要点**:
- [ ] 相同逻辑不同数据的测试是否参数化
- [ ] @ValueSource/@EnumSource/@MethodSource 是否正确使用
- [ ] 参数化测试用例是否有清晰的命名

---

### 3.3 测试生命周期

**维度说明**: 测试生命周期方法是否正确使用

**审查要点**:
- [ ] @BeforeEach/@AfterEach 是否正确使用
- [ ] @BeforeAll/@AfterAll 是否用于静态初始化
- [ ] 资源是否在 @AfterEach 中清理

---

## 维度 4: Mockito 使用

### 4.1 Mock 创建

**维度说明**: 是否正确创建和使用 mock

**审查要点**:
- [ ] 是否使用 @Mock 注解
- [ ] 是否使用 @ExtendWith(MockitoExtension.class)
- [ ] Mock 是否在 @BeforeEach 中初始化

---

### 4.2 Stub 配置

**维度说明**: Mock stub 是否正确配置

**审查要点**:
- [ ] when().thenReturn() 是否正确使用
- [ ] 是否使用链式 stub
- [ ] 是否使用 ArgumentMatchers
- [ ] stub 返回值是否符合真实场景

---

### 4.3 验证

**维度说明**: Mock 调用是否被验证

**审查要点**:
- [ ] 是否使用 verify() 验证调用
- [ ] 是否使用 times(n) 验证调用次数
- [ ] 是否验证调用参数
- [ ] 是否验证调用顺序（inOrder）

---

## 维度 5: 测试隔离

### 5.1 测试独立性

**维度说明**: 测试之间是否相互独立

**审查要点**:
- [ ] 测试执行顺序是否影响结果
- [ ] 是否避免使用静态状态
- [ ] @DirtiesContext 是否正确使用（Spring）

---

### 5.2 Mock 隔离

**维度说明**: Mock 是否正确隔离

**审查要点**:
- [ ] @MockBean 是否正确使用（Spring）
- [ ] 是否使用 @MockBean 而非 @Mock（需要时）
- [ ] Mock 是否在测试后重置

---

## 维度 6: 断言质量

### 6.1 断言完整性

**维度说明**: 断言是否验证所有关键行为

**审查要点**:
- [ ] 是否验证返回值
- [ ] 是否验证副作用（如状态变化）
- [ ] 是否验证异常（在错误场景）
- [ ] 是否避免过弱断言

---

### 6.2 AssertJ 使用

**维度说明**: 是否充分利用 AssertJ

**审查要点**:
- [ ] 是否使用 assertThat
- [ ] 是否使用流式断言
- [ ] 是否使用自定义断言
- [ ] 断言描述是否清晰

---

### 6.3 软断言

**维度说明**: 是否使用软断言报告所有失败

**审查要点**:
- [ ] 是否使用 SoftAssertions
- [ ] 是否在需要时报告所有失败而非立即失败

---

## 维度 7: Spring 测试

### 7.1 @SpringBootTest 使用

**维度说明**: 集成测试是否正确使用 @SpringBootTest

**审查要点**:
- [ ] 是否仅在集成测试使用
- [ ] 是否使用 webEnvironment.MOCK（默认）
- [ ] 是否限制加载的上下文（classes/properties）

---

### 7.2 MockMvc 使用

**维度说明**: Web 层是否正确测试

**审查要点**:
- [ ] 是否使用 MockMvc
- [ ] 是否测试 HTTP 请求/响应
- [ ] 是否验证 JSON 响应
- [ ] 是否测试异常处理

---

### 7.3 @MockBean 使用

**维度说明**: Spring bean mock 是否正确

**审查要点**:
- [ ] 是否使用 @MockBean 替换 bean
- [ ] 是否验证 mock 调用
- [ ] 是否避免过度 mock

---

## 维度 8: 异步测试

### 8.1 异步代码测试

**维度说明**: 异步操作是否被正确测试

**审查要点**:
- [ ] 是否使用 @AwaitTimeout
- [ ] 是否使用 CompletableFuture.get()
- [ ] 异步异常是否被测试

---

### 8.2 线程池测试

**维度说明**: 线程池提交的任务是否被测试

**审查要点**:
- [ ] 是否使用同步线程池进行测试
- [ ] 任务执行是否被验证
- [ ] 异常处理是否被测试

---

## 维度 9: 测试数据

### 9.1 测试数据构建

**维度说明**: 测试数据是否易于构建

**审查要点**:
- [ ] 是否使用建造者模式构建测试数据
- [ ] 是否使用测试数据工厂
- [ ] 复杂对象是否使用 @DataJpaTest

---

### 9.2 Testcontainers

**维度说明**: 集成测试是否使用 Testcontainers

**审查要点**:
- [ ] 是否使用真实数据库容器
- [ ] 容器是否在测试后停止
- [ ] 是否使用共享容器（@Container）

---

## 维度 10: 测试覆盖率

### 10.1 覆盖率目标

**维度说明**: 测试覆盖率是否达到 80% 以上

**审查要点**:
- [ ] 语句覆盖率是否 ≥ 80%
- [ ] 分支覆盖率是否 ≥ 80%
- [ ] 是否使用 JaCoCo 检查

---

### 10.2 覆盖率配置

**维度说明**: 覆盖率工具是否正确配置

**审查要点**:
- [ ] JaCoCo Maven 插件是否配置
- [ ] 覆盖率排除规则是否合理
- [ ] 是否配置了覆盖率阈值失败

---

## 维度 11: 可维护性

### 11.1 测试代码质量

**维度说明**: 测试代码本身是否易于维护

**审查要点**:
- [ ] 测试代码是否遵循编码规范
- [ ] 是否避免测试代码重复
- [ ] 测试辅助方法是否提取

---

### 11.2 测试执行效率

**维度说明**: 测试执行时间是否合理

**审查要点**:
- [ ] 是否使用 @DirtiesContext 限制上下文重置
- [ ] 是否使用 @Transactional 回滚数据
- [ ] 是否并行执行测试（junit.jupiter.execution.parallel.enabled）

---

## 维度 12: Java 特定

### 12.1 异常测试

**审查要点**:
- [ ] 是否使用 assertThrows
- [ ] 异常类型是否被验证
- [ ] 异常消息是否被验证

---

### 12.2 Lambda 测试

**审查要点**:
- [ ] Lambda 表达式是否被测试
- [ ] Lambda 中的异常是否被处理

---

### 12.3 Stream 测试

**审查要点**:
- [ ] Stream 操作是否被测试
- [ ] 空 Stream 是否被测试
- [ ] 并行 Stream 是否被测试

---

## 质量评估矩阵

| 维度 | 权重 | 评估标准 | 评分 (1-5) |
|-----|------|---------|-----------|
| 测试结构 | 10% | AAA模式清晰、命名规范 | |
| 测试覆盖 | 20% | 快乐/边界/错误场景完整 | |
| JUnit 特性 | 15% | 断言、参数化、生命周期 | |
| Mockito 使用 | 15% | 正确创建、stub、验证 | |
| 测试隔离 | 10% | 独立无依赖 | |
| 断言质量 | 10% | 完整、准确 | |
| 覆盖率 | 10% | ≥80% | |
| 可维护性 | 10% | 代码清晰、高效 | |

**总分**: ___ / 5

---

## 审查结果汇总模板

```markdown
# Java 测试质量审查报告

## 审查概述
- 编程语言: Java
- 测试框架: JUnit 5 / Mockito / AssertJ
- 审查时间: YYYY-MM-DD HH:MM
- 审查测试文件: X个
- 审查测试用例: Y个

## 审查框架
基于 `templates/testing/testing-checklist-java.md` 提供的审查维度：
1. 测试结构 (AAA模式、命名规范)
2. 测试覆盖 (快乐路径、边界条件、错误场景)
3. JUnit 特性 (断言、参数化、生命周期)
4. Mockito 使用 (创建、stub、验证)
5. 测试隔离 (独立性、Mock隔离)
6. 断言质量 (完整性、AssertJ使用)
7. Spring 测试 (@SpringBootTest、MockMvc、@MockBean)
8. 异步测试 (异步代码、线程池)
9. 测试数据 (构建、Testcontainers)
10. 覆盖率 (目标、配置)
11. 可维护性 (代码质量、执行效率)
12. Java 特定 (异常、Lambda、Stream)

## 各维度深度审查

### 1. 测试结构维度
**分析结果**: ___
**问题列表**: ___
**改进建议**: ___

### 2. 测试覆盖维度
**分析结果**: ___
... [其他维度]

## 覆盖率分析
- 语句覆盖率: XX%
- 分支覆盖率: XX%
- 未覆盖关键路径: [列表]

## 总体评估与优先级
- 质量等级: ___
- 总分: X.X / 5.0
- 高优先级问题: [列表]
- 中优先级问题: [列表]
- 低优先级问题: [列表]

## 改进计划
1. [ ] [具体行动项]
2. [ ] [具体行动项]
3. [ ] [具体行动项]
```
