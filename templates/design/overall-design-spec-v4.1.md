# XXX版本总体设计说明书 v4.1

[公司名称]

---

## 修订记录

| 修订版本号 | 作者 | 日期 | 简要说明 |
|---------|------|------|---------|
| V4.1 | [作者] | [日期] | [简要说明] |

---

## 目录

- [0 引言](#0-引言)
  - [0.1 目的](#01-目的)
  - [0.2 适用范围和评审要求](#02-适用范围和评审要求)
  - [0.3 定义和缩写](#03-定义和缩写)
  - [0.4 参考和引用](#04-参考和引用)
  - [0.5 产品名称、型号、代号](#05-产品名称型号代号)
- [1 技术需求设计](#1-技术需求设计)
  - [1.1 架构技术需求设计](#11-架构技术需求设计)
  - [1.2 特性技术需求设计](#12-特性技术需求设计)
- [2 设计目标](#2-设计目标)
- [3 硬件方案](#3-硬件方案)
- [4 软件方案](#4-软件方案)
- [5 关键特性设计](#5-关键特性设计)
- [6 总结](#6-总结)
- [7 变更控制](#7-变更控制)

---

# 0 引言

## 0.1 目的

简要介绍该说明书的目的和使用该规格书的对象。

**DCP2项目立项阶段：**

**总设输入：** 用户需求设计；技术规划，DFX基线和版本DFX需求，安全需求，质量问题需求。

**总设输出：** 部分设计，主要包含技术需求设计、设计目标章节内容。

**DCP3项目计划阶段：**

**总设输入：** 系统需求文档

**总设输出：** 完整设计，包含所有章节内容。

## 0.2 适用范围和评审要求

### 0.2.1 适用范围

在每个迭代的需求基线后，产品线架构师根据需求的复杂度，对架构的影响程度，进行决策：

| 场景 | 建议 |
|-----|------|
| 本次迭代需求开发将对产品架构进行大面积调整 | 做一份全新的总体设计 |
| 本次迭代需求开发未对原有产品架构大幅改动 | 在上个迭代的总体设计上进行调整 |
| 本次迭代需求开发仅在原有模块上进行零散改动 | 不做总设 |

### 0.2.2 评审要求

总体设计评审统一提交电子流，由TMO组织进行TMG评审。

## 0.3 定义和缩写

定义或解释本文档中使用的所有专用名词和缩略语。

| 缩写名 | 描述 | 备注 |
|-------|------|------|
| | | |

## 0.4 参考和引用

列出本文档编写过程中参考的其它文档或资料。

## 0.5 产品名称、型号、代号

---

# 1 技术需求设计

**输入来源：**
- DCP2阶段：用户需求设计；技术规划，DFX基线和版本DFX需求，安全需求，质量问题需求
- DCP3阶段：系统需求文档

## 1.1 架构技术需求设计

### 架构需求分析

涉及架构变动的项目需要填此章节内容，包含：
- 新产品、新架构、重大重构版本
- 涉及跨产线的架构融合项目

#### 业务场景需求分析

基于场景分析→问题识别→技术思路→方案选型的分析设计思路编写。

#### 产品长期演进架构需求分析

考虑产品长期演进的潜在需求，分析架构上的技术要求、约束和方案思路。

演进方向：硬件兼容、部署形态、性能要求、可靠性等。

| 序号 | 当前版本需求 | 长期潜在需求 | 潜在需求的用户场景来源和重要性 | 当前需考虑技术问题 |
|-----|-------------|-------------|----------------------------|-----------------|
| 1 | | | | |

#### 解决方案长期演进架构需求分析

考虑集成解决方案的潜在需求，分析架构上的技术要求、约束和方案思路。

| 序号 | 当前版本需求 | 长期潜在需求 | 潜在需求的用户场景来源和重要性 | 当前需考虑技术问题 |
|-----|-------------|-------------|----------------------------|-----------------|
| 1 | | | | |

#### 中台需求分析

评估是否存在中台需求：PlantOS、SangforOS、APEX、数据湖等。

| 序号 | 当前版本需求 | 长期潜在需求 | 潜在需求的用户场景来源和重要性 | 当前需考虑技术问题 |
|-----|-------------|-------------|----------------------------|-----------------|
| 1 | | | | |

### 架构领先性需求分析

涉及构建产品竞争优势时，需要完整按模板编写相关内容。

#### 架构现状分析

分析当前产品的架构现状，哪些做得好，哪些存在不足或问题。

#### 全球架构领先性分析

各关键技术维度分析全球架构领先性，并与当前产品架构做横向对比。

#### 架构领先性需求分析

| 序号 | 当前版本架构领先性需求 | 业务场景价值和重要性 | 当前需考虑技术问题 |
|-----|---------------------|------------------|-----------------|
| 1 | | | |

### 架构预期目标

用户视角、用户可感知的产品预期目标。

| 编号 | 干系人 | 目标项概述 | 用户预期解决的关键问题或指标 |
|-----|--------|----------|------------------------|
| 1 | 价值用户 | 性能参数要求 | 如支持100G流量 |
| 2 | 价值用户 | 资源开销要求 | 16核32G内存 |
| 3 | 价值用户 | 可靠性 | SLA要求4个9 |
| 4 | 内部用户（SRE） | 可靠性 | 容灾方案，数据0丢失 |
| 5 | 效果用户 | 兼容性 | 老版本升级 |

### 架构方案设计

根据架构需求分析，汇总给出技术思路。

| 序号 | 架构需求 | 方案思路概述 | 是否已预研 | 是否详细方案选型 |
|-----|---------|------------|----------|-------------|
| 1 | | | | |

### 预研及中台复用结论

若有复用中台，方案选型需要包含此中台的选型过程。

### 架构方案选型

用方案选型表进行选型，说明最终所选的方案。

#### xxx的方案选型1

##### 业务场景关键问题及技术特征

简述业务场景及业务特征。

##### 业务规格要求及约束

用户视角的业务规格要求及约束。

##### 方案1

方案一的具体介绍。

##### 方案2

方案二的具体介绍。

##### 方案选型决策

| 评估准则 | 权重 | 方案1打分 | 方案1加权得分 | 方案2打分 | 方案2加权得分 |
|---------|------|----------|-------------|----------|-------------|
| 评估准则1 | 50% | 5 | 2.5 | | |
| 评估准则2 | 15% | 5 | 0.75 | | |
| 最终得分（满分5） | | | 5.00 | | |

| 备选方案名称 | 本方案的优点 | 本方案的风险和缺点 | 最终选择 |
|-------------|-------------|-----------------|---------|
| 方案1 | | | |
| 方案2 | | | |

##### 方案对业务的约束

所选型方案对业务的影响或约束。

## 1.2 特性技术需求设计

### 特性需求分析

基于场景分析→问题识别→技术思路→方案选型的分析设计思路编写。

### 特性预期目标

用户视角、用户可感知的产品预期目标。

| 编号 | 干系人 | 目标项概述 | 用户预期解决的关键问题或指标 |
|-----|--------|----------|------------------------|
| 1 | 价值用户 | 性能参数要求 | |
| 2 | 内部用户 | 可扩展性 | |

### 特性方案设计

根据特性需求分析，汇总给出技术思路。

#### xxx特性方案设计1

| 序号 | 目标用户 | 场景 | 方案思路概述 | 是否已预研 | 是否详细方案选型 |
|-----|---------|------|------------|----------|-------------|
| 1 | | | | | |

### 预研及中台复用结论

若有复用中台，方案选型需要包含此中台的选型过程。

### 特性技术方案选型

用方案选型表进行选型，说明最终所选的方案。

#### xxx的方案选型1

##### 业务场景关键问题及技术特征

简述业务场景及业务特征。

##### 业务规格要求及约束

用户视角的业务规格要求及约束。

##### 方案1

方案一的具体介绍。

##### 方案2

方案二的具体介绍。

##### 方案选型决策

| 评估准则 | 权重 | 方案1打分 | 方案1加权得分 | 方案2打分 | 方案2加权得分 |
|---------|------|----------|-------------|----------|-------------|
| 评估准则1 | 50% | 5 | 2.5 | | |
| 最终得分（满分5） | | | 5.00 | | |

| 备选方案名称 | 本方案的优点 | 本方案的风险和缺点 | 最终选择 |
|-------------|-------------|-----------------|---------|
| 方案1 | | | |

---

# 2 设计目标

此总体设计任务书由开发经理/产品架构师填写下发，说明设计需要达到的要求。

## 目标细化分析

汇总分析设定架构和特性的设计目标，每个目标的设定都需要有依据支撑。

## 目标细化结论

汇总细化架构和特性的设计目标。

| 编号 | 目标项概述 | 对应的标准要求 |
|-----|----------|-------------|
| 1 | 性能参数要求 | 并发用户数、并发连接数、PPS、支持规则数等 |
| 2 | 资源开销要求 | 内存占用、CPU占用、磁盘占用等 |
| 3 | 可靠性 | 冗余设计、故障检测恢复、过载保护等 |
| 4 | 架构要求 | 低耦合、可扩展等 |
| 5 | 可运维性 | 安装部署、日志管理等 |
| 6 | 可测试性 | 测试机制和方法 |
| 7 | 可扩展性 | 扩展能力保留 |
| 8 | 可调试性 | 排障定位目标 |
| 9 | 兼容性 | 允许升级配置的版本 |
| 10 | 安全性 | 防护攻击能力 |
| 11 | 可重用性 | 公用代码 |

## 中台技术要求

如存在可复用中台，优先考虑使用中台。

| 使用中台名称 | 技术要求和约束 | 中台支撑策略 | 中台确认人 |
|-------------|--------------|------------|----------|
| | | | |

---

# 3 硬件方案

描述系统的硬件构成，描述支持的基本硬件平台以及所采用的其他功能芯片。

## 基本硬件构成

描述系统所使用的基本硬件平台，各个平台的CPU类型，内存大小。

## 专用芯片说明

简要描述专用芯片的功能、供应商等信息。

---

# 4 软件方案

## 软件总体架构

系统的架构视图，重点是系统的软件模块构成，包括模块名、功能说明以及模块之间的层次关系。

采用4+1视图模式进行描述：逻辑视图、过程视图、物理视图、开发视图、场景视图。

### 模块功能说明

| 模块名 | 安装路径及模块类型 | 功能说明 | 关联的需求点 |
|-------|-----------------|---------|------------|
| libauth | /usr/lib/libauth.so<br>动态库 | 认证驱动的接口 | |
| authd | /usr/local/sangfor/authd<br>daemon程序 | 认证守护进程，处理各类认证请求 | 需求1.2.9 |

### 模块设计要求

| 模块名 | 设计要求 | 设计策略 |
|-------|---------|---------|
| | | |

## 系统主流程

系统主流程是指主要业务场景的系统流程。

### 系统流程1

#### 对应用例(功能点)编号

该系统流程对应需求中的USE CASE或功能点编号。

#### 流程图与步骤说明

使用UML的顺序图描述该系统流程图的实现。

#### 导出的各模块接口名列表

| 步骤编号 | 目标模块名 | 对应目标模块接口名 |
|---------|----------|---------------|
| | | |

### 系统初始化流程

描述各个模块的资源分配，结构初始化的过程。

### 系统退出流程

描述各个模块资源销毁的过程。

## 系统其它流程

系统其它流程是指非主要业务场景的系统流程。

## 数据结构

描述模块间交互所使用的数据结构。

## 模块设计

### 模块名１

#### 模块系统需求

描述该模块需实现的系统需求。

#### 模块设计约束

描述总设对该模块设计的约束。

#### 模块职责及边界描述

描述模块职责及边界。

#### 模块风险识别及对策

描述潜在风险及应对措施。

---

# 5 关键特性设计

## 安全性设计

### 安全兜底机制合入

按照产品交付形态选择安全兜底机制合入，确保产品默认安全能力防护最佳。

### 威胁建模分析

采用STRIDE方法开展威胁建模与安全设计活动。

### 安全设计

根据威胁建模中识别出的风险，设计相关的安全机制。

#### 整体安全架构设计

描述整体的安全架构设计机制。

#### 模块安全设计

详细描述各模块的安全设计机制。

### 预使用组件版本安全情况

使用扫描器对预计使用的开源组件对应版本进行扫描。

## 可靠性设计

### 能力目标定义

定义版本级的可靠性目标，从故障管理能力维度、故障对象维度、业务功能维度进行。

| 一级目标 | 二级目标 | 三级目标 | 备注 |
|---------|---------|---------|------|
| | | | |

### 故障场景分析

分析可靠性能力现状与目标之间的差距。

### 业界竞争分析

分析业界同类产品的关键能力指标。

### 实现方案设计

针对确定的设计需求给出实现的技术方案。

#### XXX冗余设计方案

给出冗余设计的实现架构、实现方式、实现原理。

#### XXX故障管理方案设计

给出故障检测、定位、上报、隔离、恢复方面的机制。

#### 升级不中断业务设计

给出升级不中断业务的实现原理。

#### 应急恢复方案设计

给出业务中断或数据丢失场景的恢复方案。

### 韧性设计

#### 韧性目标定义

| 过载场景 | 指标项 | 指标值 |
|---------|-------|-------|
| 并发流量超标 | 2倍流量业务成功率 | 98% |

#### 过载场景分析

分析可能发生过载的情况。

#### 过载保护设计

描述针对各类过载场景的处理机制。

## 可测试性设计

在可测试性方面的测试场景分析与实现方案的描述。

## 可调试性设计

描述系统需要设计的对应机制来达成可调试性要求。

## 可运维性设计

在可运维性方面的测试场景分析与实现方案的描述。

### 可运维性目标定义

按照范围子领域进行目标定义。

### 可运维性设计方案

给出达成目标所需要的实现方案。

## 可扩展性设计

描述设计需要达到的可扩展性目标。

## 可复用性设计

### 技术规范落地计划

根据产品线的技术规范基线计划，定义本版本需要遵守的技术规范。

### 本版本可采用的公用代码

列出哪些功能点或模块可以使用公用代码。

### 本版本可产出的公用代码

考虑产出公用代码，以便其它产品重用。

### 设计文档更新约定

定义哪些设计文档、哪些模块在后续改动后要同步更新。

| 设计文档名/模块名 | 何种情况下需要更新此文档的基线 | 责任人 |
|-----------------|--------------------------|-------|
| | | |

## 系统隐私设计

隐私目标：系统在收集用户信息时不会私自收集用户不知道的数据。

隐私设计：传输敏感信息时使用安全协议，对内容进行加密传输。

## 软件质量及效能改进设计

描述在本版本中为提升软件质量和效能所采取的措施。

---

# 6 总结

## 与上一个版本的设计变化

描述本版本与上一个版本之间发生变化的总体设计。

### 设计变化项1

#### 设计变化原因

为什么该设计需要变更？

#### 设计变化描述

描述具体发生变化的内容。

#### 设计变化产生的影响

该设计变化会造成什么影响？

## 风险问题保证

| 风险点 | 风险预研结果/风险规避措施 |
|-------|----------------------|
| 例1：处理速度达100MBPS | 根据预研文档可以达到要求 |
| 例2：缓存数据可能超过800M | 使用最久未用淘汰算法 |

## 尚未解决的问题

说明在总体设计过程中尚未解决而必须在系统完成之前必须解决的问题。

---

# 7 变更控制

## 变更列表

| 变更章节 | 变更内容 | 变更原因 | 变更对老功能、原有设计的影响 |
|---------|---------|---------|------------------------|
| | | | |
