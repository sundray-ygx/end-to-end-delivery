---
description: 执行架构设计阶段 - 生成多个方案、进行权衡分析、输出实施蓝图
argument-hint: (可选) 方案选择偏好
---

# /design - 架构设计阶段

执行端到端交付流程的第三阶段：架构设计。

**前置条件**: 必须先完成 Discovery 和 Exploration 阶段

## 使用方式

```bash
# 启动架构设计阶段
/design

# 指定方案偏好
/design "偏向最小变更方案"

# 从现有设计继续
/design --resume
```

## 阶段目标

提供高质量的架构设计方案和详细的实施蓝图。

## ⚠️ 前置条件检查

**执行架构设计前，必须确认以下条件已满足：**

### 必需的前置阶段
- [ ] **Discovery 阶段已完成** - 需求文档已生成
  - 检查: `ls docs/requirements/`
  - 应包含: 需求规格文档、验收标准
- [ ] **Exploration 阶段已完成** - 代码库分析已生成
  - 检查: `ls docs/exploration/`
  - 应包含: 代码库探索报告、关键文件清单

### 验收标准
- [ ] 需求清晰明确，无歧义
- [ ] 验收标准已定义
- [ ] 复杂度评估已完成
- [ ] 代码库上下文已理解

**如果前置条件未满足，请先执行：**
```bash
# 需求发现阶段
/discovery "功能需求描述"

# 代码库探索阶段
/exploration
```

---

## 工作流程

### 1. 设计准备
```markdown
## 设计准备

**输入**:
- 需求规格: [来自 discovery 阶段]
- 代码库分析: [来自 exploration 阶段]
- 约束条件: [已识别的约束]

**设计目标**:
- 功能完整
- 性能达标
- 可维护性强
- 实施可行
```

### 2. 方案生成

生成 3 个架构方案:

#### 方案 A: 最小变更方案
- 特点: 快速实施、风险低
- 适用: 小功能、时间紧迫
- 优势: 实施快速
- 劣势: 可能引入技术债务

#### 方案 B: 清晰架构方案
- 特点: 高可维护性
- 适用: 核心功能、长期维护
- 优势: 易于测试和扩展
- 劣势: 实施时间较长

#### 方案 C: 务实平衡方案
- 特点: 速度与质量平衡
- 适用: 大多数场景
- 优势: 实用的设计
- 劣势: 需要权衡

### 3. 权衡分析

对每个方案进行详细分析:
- 优势与劣势
- 技术风险评估
- 实施成本估算
- 长期影响分析

### 4. 推荐方案

基于以下因素给出推荐:
- 需求复杂度
- 时间压力
- 团队能力
- 长期规划

### 5. 实施蓝图

针对推荐方案输出详细蓝图:
- 组件设计
- 数据流设计
- 集成点
- 实施阶段
- 成功标准

## 阶段输出

```markdown
# [Feature Name] 架构设计

## 方案对比

### 方案 A: 最小变更方案
- 优势: ...
- 劣势: ...
- 实施成本: X 小时
- 技术风险: 低/中/高

### 方案 B: 清晰架构方案
- 优势: ...
- 劣势: ...
- 实施成本: X 小时
- 技术风险: 低/中/高

### 方案 C: 务实平衡方案
- 优势: ...
- 劣势: ...
- 实施成本: X 小时
- 技术风险: 低/中/高

## 推荐方案

**推荐**: 方案 X

**理由**:
1. 理由 1
2. 理由 2
3. 理由 3

## 实施蓝图

### 组件设计
- Component 1: [职责、接口、依赖]
- Component 2: [职责、接口、依赖]

### 数据流
[数据流图]

### 实施阶段
- 阶段 1: [任务]
- 阶段 2: [任务]
- 阶段 3: [任务]

### 成功标准
- [ ] 标准 1
- [ ] 标准 2
```

## 质量门禁

完成架构设计前，确认:
- [ ] 3 个方案已生成
- [ ] 权衡分析完成
- [ ] 推荐方案明确
- [ ] 实施蓝图详细
- [ ] 风险已识别
- [ ] 用户已确认方案

---

## 📋 模板格式验证（强制执行）

**生成文档后，必须执行以下验证**：

### 验证步骤

#### 步骤1：读取模板文件
```markdown
根据复杂度评估结果，读取对应的模板文件：

**高复杂度**：
Read templates/design/overall-design-spec-v4.1.md

**中复杂度**：
Read templates/design/module-detailed-design-spec-v3.6.md

**低复杂度**：
Read templates/design/module-mini-design-spec-v1.4.md
```

#### 步骤2：对比文档结构
```markdown
对比生成的标准化文档与模板：
1. 检查所有一级标题是否存在
2. 检查章节顺序是否正确
3. 检查格式规范是否遵循
```

#### 步骤3：验证结果确认
```markdown
## 模板格式验证报告

### AI设计文档
- 状态：✅ 已生成
- 文件：docs/03_架构设计文档.md

### 标准化设计文档
- 模板类型：[总体设计/模块详细设计/模块微型设计]
- 状态：[✅验证通过 / ❌验证失败]
- 文件：docs/04_XXX.md

### 验证结果详情
- 一级标题完整性：[X/Y]
- 章节顺序正确性：[是/否]
- 格式规范符合性：[符合/不符合]

### 验证结论
[ ] 通过 - 可以进入下一阶段
[ ] 失败 - 需要重新生成标准化文档
```

**不通过验证不得进入下一阶段**

---

## 下一阶段

架构设计完成后，进入实施执行阶段:
```bash
/implement
```
