---
description: 执行代码库探索阶段 - 映射结构、识别模式、分析相关功能、标注关键文件（v3.0 集成 iterative-retrieval）
argument-hint: (可选) 探索范围
---

# /exploration - 代码库探索阶段 v3.0

执行端到端交付流程的第二阶段：代码库探索。

**前置条件**: 必须先完成 Discovery 阶段

## v3.0 新特性

### iterative-retrieval 渐进式检索模式
解决子代理上下文限制问题，通过渐进式细化代码库理解：

```
DISPATCH → EVALUATE → REFINE → LOOP
  ↓          ↓           ↓      ↑
分发检索    评估结果    细化查询 最多3次循环
```

**工作流程**:
1. **DISPATCH** - 根据需求分发初始检索任务
2. **EVALUATE** - 评估检索结果是否充分
3. **REFINE** - 细化检索查询，深入探索
4. **LOOP** - 最多循环 3 次，渐进式理解代码库

## 使用方式

```bash
# 启动代码库探索阶段
/exploration

# 探索特定范围
/exploration "user authentication"
```

## 阶段目标

快速理解代码库上下文，为架构设计提供基础。

## 工作流程

### 1. 结构扫描
```
活动:
  1. 使用 Glob 查找项目结构
  2. 使用 LS 识别目录组织方式
  3. 使用 Grep 搜索关键模式
  4. 构建代码库心智模型
```

### 2. 深度探索
基于需求发现阶段的功能需求，进行有针对性的探索：

**探索维度:**
1. **类似功能搜索** - 查找相似的功能实现
2. **架构层次分析** - 分层架构、依赖关系
3. **数据流追踪** - 数据流转路径
4. **依赖关系映射** - 内部和外部依赖

### 3. 关键文件识别
为后续阶段提供**必须阅读**的文件清单

### 4. 模式提取
识别并记录代码库中的模式：
- 架构模式
- 代码模式
- 约定模式

## 阶段输出

```markdown
# 代码库探索报告

## 项目概览
- **项目类型**: [类型]
- **技术栈**: [列表]
- **架构风格**: [风格]

## 结构地图
[可视化或层次化的目录结构]

## 架构洞察
### 分层架构
- [层次描述]

### 关键模式
- [模式名称]: [应用位置]

## 相关功能分析
### 功能 A: [名称]
- **位置**: `path/to/file`
- **实现方式**: [简述]
- **可借鉴点**: [列表]

## 必读文件清单
### 优先级 P0 (必须阅读)
- [ ] `file1.ts` - [原因]
- [ ] `file2.ts` - [原因]

### 优先级 P1 (应该阅读)
- [ ] `file3.ts` - [原因]
- [ ] `file4.ts` - [原因]

## 技术债务与风险
- [债务描述] - [位置] - [影响]
- [风险描述] - [位置] - [缓解建议]
```

## 质量门禁

完成代码库探索前，确认:
- [ ] 代码库结构已映射
- [ ] 现有模式已识别
- [ ] 关键文件已标注
- [ ] 技术债务已记录

## 下一阶段

代码库探索完成后，进入架构设计阶段:
```bash
/design
```
