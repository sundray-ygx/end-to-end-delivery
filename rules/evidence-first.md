# 证据优先规则 (Evidence First Rules)

端到端交付流程的核心原则：所有结论必须基于验证证据。

## 铁律

```
NO COMPLETION CLAIMS WITHOUT FRESH VERIFICATION EVIDENCE
```

---

## 核心原则

### 证据优先于断言
```markdown
❌ 错误: "应该能通过测试"
✅ 正确: "测试全部通过 (34/34), 覆盖率 95%"

❌ 错误: "看起来构建成功了"
✅ 正确: "构建成功 (exit 0), 输出文件: dist/"

❌ 错误: "我确信没有问题"
✅ 正确: "所有验证通过: build ✓, type-check ✓, lint ✓, tests ✓"
```

### 重新验证优先于信任记忆
```markdown
❌ 错误: "上次运行是通过的"
✅ 正确: [重新运行] "测试通过 (34/34)"

❌ 错误: "之前验证过了"
✅ 正确: [重新验证] "验证通过"
```

### 完整验证优先于部分检查
```markdown
❌ 错误: "linter 通过了，应该没问题"
✅ 正确: [运行完整验证] "build ✓, lint ✓, tests ✓"

❌ 错误: "部分测试通过了"
✅ 正确: [运行所有测试] "34/34 测试通过"
```

---

## 验证命令

### 构建验证
```bash
# 运行并捕获完整输出
npm run build 2>&1

# 检查退出码
echo $?  # 应该是 0

# 报告格式
"构建成功 (exit 0), 输出: dist/"
```

### 类型检查
```bash
# TypeScript
npx tsc --noEmit 2>&1

# 报告格式
"类型检查通过 (0 errors)"
```

### 代码规范
```bash
# ESLint
npm run lint 2>&1

# 报告格式
"代码规范通过 (0 errors, 0 warnings)"
```

### 测试验证
```bash
# 运行测试
npm test 2>&1

# 带覆盖率
npm test -- --coverage 2>&1

# 报告格式
"测试通过 (34/34), 覆盖率: 95%"
```

### 安全扫描
```bash
# 检查硬编码密钥
grep -rn "sk-" --include="*.ts" . 2>/dev/null

# 报告格式
"安全扫描通过 (0 个硬编码密钥)"
```

---

## 禁止的表述

### 模糊词
```markdown
❌ "应该"
❌ "可能"
❌ "大概"
❌ "看起来"
❌ "似乎"
```

### 未经验证的断言
```markdown
❌ "我已经测试过了"
❌ "上次是工作的"
❌ "应该没问题"
❌ "我确信"
```

### 基于信任的结论
```markdown
❌ "Agent 报告成功"
❌ "之前验证通过了"
❌ "根据我的经验"
```

---

## 正确的表述

### 带证据的断言
```markdown
✅ [运行 npm test] "测试通过 (34/34)"
✅ [运行 npm run build] "构建成功 (exit 0)"
✅ [运行 npx tsc] "类型检查通过 (0 errors)"
✅ [运行 npm run lint] "代码规范通过 (0 errors, 0 warnings)"
```

### 带数据的报告
```markdown
✅ "测试通过 (34/34), 覆盖率: 95%"
✅ "构建成功, 输出文件: dist/main.js"
✅ "类型检查通过, 0 个错误"
✅ "代码规范通过, 0 个错误, 0 个警告"
```

### 带来源的引用
```markdown
✅ "根据测试输出: [完整输出], 所有测试通过"
✅ "根据构建日志: [日志片段], 构建成功"
✅ "根据类型检查输出: [输出片段], 0 个错误"
```

---

## 验证流程

### 标准流程
```markdown
1. IDENTIFY: 确定要验证什么
2. RUN: 运行验证命令
3. CAPTURE: 捕获完整输出
4. ANALYZE: 分析输出结果
5. REPORT: 基于证据报告结果
```

### 示例
```markdown
## 验证测试

### 1. IDENTIFY
验证所有测试是否通过

### 2. RUN
```bash
npm test 2>&1
```

### 3. CAPTURE
```
Test Suites: 1 passed, 1 total
Tests:       34 passed, 34 total
```

### 4. ANALYZE
- 测试套件: 1/1 通过 ✓
- 测试用例: 34/34 通过 ✓

### 5. REPORT
✅ 所有测试通过 (34/34)
```

---

## 违规后果

### 轻微违规
- 警告提醒
- 重新验证

### 严重违规
- 阻止继续
- 记录问题
- 反思改进

### 核心违规
- 重新开始
- 全面审查
- 流程改进

---

## 检查清单

### 声明任何状态前
- [ ] 运行了验证命令
- [ ] 捕获了完整输出
- [ ] 分析了输出结果
- [ ] 基于证据报告

### 声明完成前
- [ ] 所有验证通过
- [ ] 有明确的证据
- [ ] 没有遗留问题

### 声明成功前
- [ ] 测试全部通过
- [ ] 覆盖率达标
- [ ] 质量门禁通过

---

## 自我检查

### 在声称"完成"前
```markdown
## 检查问题
1. 我运行验证命令了吗？
2. 我有明确的输出证据吗？
3. 我是基于证据说的吗？
4. 我有遗漏的问题吗？
```

### 在声称"通过"前
```markdown
## 检查问题
1. 所有测试都通过了吗？
2. 覆盖率达标了吗？
3. 所有验证都通过了吗？
4. 我有证据支持吗？
```

---

## 引用

### 来源
- superpowers: verification-before-completion
- everything-claude-code: verification-loop

### 相关规则
- phase-gates.md
- quality-standards.md

---

**记住**: 证据优先不是负担，而是对质量的承诺。诚实比任何东西都重要。没有证据，就没有结论。

**违反证据优先原则就是违反对用户的信任。**
