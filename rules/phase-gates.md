# 阶段门禁规则 (Phase Gates Rules)

端到端交付流程的各阶段质量门禁标准。

## Discovery 阶段门禁

### 必须满足
- [ ] 需求清晰明确，无歧义
- [ ] 验收标准可测试
- [ ] 目标用户明确
- [ ] 使用场景清晰

### 应该满足
- [ ] 约束条件已识别
- [ ] 风险已评估
- [ ] 用户已确认

### 阻止进入下一阶段
- 需求模糊不清
- 验收标准不明确
- 目标不明确

---

## Exploration 阶段门禁

### 必须满足
- [ ] 代码库结构已映射
- [ ] 相关功能已分析
- [ ] 关键文件已标注

### 应该满足
- [ ] 现有模式已识别
- [ ] 技术债务已记录
- [ ] 集成点已说明

### 阻止进入下一阶段
- 代码库理解不完整
- 关键文件未标注

---

## Design 阶段门禁

### 必须满足
- [ ] 3 个方案已生成
- [ ] 权衡分析完成
- [ ] 推荐方案明确
- [ ] 实施蓝图详细

### 应该满足
- [ ] 风险已识别
- [ ] 成功标准明确
- [ ] 用户已确认方案

### 阻止进入下一阶段
- 方案不明确
- 实施蓝图不详细

---

## Implementation 阶段门禁

### 必须满足
- [ ] 严格遵循 TDD 流程
- [ ] 所有测试通过
- [ ] 测试覆盖率 ≥ 80%
- [ ] 代码符合项目规范

### 应该满足
- [ ] 代码自审完成
- [ ] 审查问题已修复
- [ ] 提交信息清晰

### 阻止进入下一阶段
- 有测试失败
- 覆盖率不足 80%
- 代码规范不通过

---

## Verification 阶段门禁

### 必须满足
- [ ] 构建成功
- [ ] 类型检查通过
- [ ] 代码规范通过
- [ ] 所有测试通过
- [ ] 测试覆盖率 ≥ 80%
- [ ] 安全扫描通过
- [ ] 无阻塞性问题

### 应该满足
- [ ] 无非阻塞性问题
- [ ] 变更符合预期

### 阻止进入下一阶段
- 任何验证失败
- 存在阻塞性问题

---

## Delivery 阶段门禁

### 必须满足
- [ ] 所有阶段完成
- [ ] 质量门禁通过
- [ ] 交付文档完整
- [ ] 价值已验证

### 应该满足
- [ ] 模式已提取
- [ ] 知识已沉淀
- [ ] PR/发布准备就绪

### 闭环完成
- 价值已交付
- 团队已学习
- 流程已改进

---

## 门禁强制执行

### 自动检查
```bash
# 每个阶段结束时自动运行检查
/phase:verify --gate-check
```

### 手动确认
```markdown
## 阶段门禁确认

**当前阶段**: [阶段名称]

**门禁检查**:
- [ ] 检查项 1
- [ ] 检查项 2
- [ ] 检查项 3

**门禁状态**: ✅ PASS / ❌ FAIL

**如果通过**: 可以进入下一阶段
**如果失败**: 必须修复问题后重新检查
```

### 紧急情况
```markdown
## 紧急情况处理

如果需要紧急绕过某个门禁:

1. 评估风险
2. 记录原因
3. 制定缓解措施
4. 获得批准
5. 创建技术债务
```

---

**记住**: 质量门禁不是为了阻碍，而是为了确保质量。遵守门禁就是遵守对质量的承诺。
